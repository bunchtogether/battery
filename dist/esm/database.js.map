{"version":3,"sources":["../../src/database.js"],"names":["merge","unset","EventEmitter","makeLogger","localJobEmitter","jobEmitter","logger","JobDoesNotExistError","Error","constructor","message","name","CleanupDoesNotExistError","QUEUE_ERROR_STATUS","QUEUE_PENDING_STATUS","QUEUE_COMPLETE_STATUS","QUEUE_EMPTY_STATUS","JOB_ABORTED_STATUS","JOB_COMPLETE_STATUS","JOB_PENDING_STATUS","JOB_ERROR_STATUS","JOB_CLEANUP_STATUS","JOB_CLEANUP_AND_REMOVE_STATUS","databasePromise","request","self","indexedDB","open","onupgradeneeded","e","store","target","result","createObjectStore","keyPath","autoIncrement","createIndex","unique","error","db","Promise","resolve","reject","onerror","onsuccess","event","getReadWriteAuthObjectStore","database","transaction","objectStore","onabort","errorObject","getReadOnlyAuthObjectStore","getReadWriteQueueDataObjectStore","getReadOnlyQueueDataObjectStore","getReadWriteJobsObjectStoreAndTransactionPromise","promise","oncomplete","getReadOnlyJobsObjectStoreAndTransactionPromise","getReadWriteJobsObjectStore","getReadOnlyJobsObjectStore","getReadWriteCleanupsObjectStore","getReadOnlyCleanupsObjectStore","clearQueueDataDatabase","clear","clearJobsDatabase","emit","clearCleanupsDatabase","clearDatabase","removeJobsWithQueueIdAndTypeFromDatabase","queueId","type","index","getAllKeys","IDBKeyRange","only","id","deleteRequest","delete","deleteEvent","removeQueueIdFromJobsDatabase","removeQueueIdFromCleanupsDatabase","openCursor","cursor","primaryKey","continue","removeQueueIdFromDatabase","removeCompletedExpiredItemsFromDatabase","maxAge","getAll","bound","Date","now","status","updateJobInDatabase","transform","get","newValue","value","putRequest","put","getJobFromDatabase","updateCleanupInDatabase","removePathFromCleanupDataInDatabase","path","attempt","startAfter","data","Object","assign","updateCleanupValuesInDatabase","TypeError","combinedData","removeJobFromDatabase","removeCleanupFromDatabase","getCleanupFromDatabase","getQueueDataFromDatabase","queueData","undefined","updateQueueDataInDatabase","markJobStatusInDatabase","markJobCompleteInDatabase","markJobPendingInDatabase","markJobErrorInDatabase","markJobCleanupInDatabase","markJobAbortedInDatabase","markJobCleanupAndRemoveInDatabase","markJobAsAbortedOrRemoveFromDatabase","markJobStartAfterInDatabase","toLocaleString","markCleanupStartAfterInDatabase","markQueueForCleanupInDatabase","jobs","push","warn","updateRequest","update","event2","incrementJobAttemptInDatabase","incrementCleanupAttemptInDatabase","bulkEnqueueToDatabase","items","delay","Array","isArray","i","length","args","ids","created","enqueueToDatabase","restoreJobToDatabaseForCleanupAndRemove","dequeueFromDatabase","getContiguousIds","sort","a","b","points","Infinity","dequeueFromDatabaseNotIn","includes","getRequest","getJobsFromDatabase","getCompletedJobsCountFromDatabase","getCompletedJobsFromDatabase","storeAuthDataInDatabase","getAuthDataFromDatabase","authData","removeAuthDataFromDatabase","getQueueStatus","abortedRequest","completeRequest","pendingRequest","errorRequest","cleanupRequest","cleanupAndRemoveRequest","abortedCountPromise","completeCountPromise","pendingCountPromise","errorCountPromise","cleanupCountPromise","cleanupAndRemoveCountPromise","abortedCount","completeCount","pendingCount","errorCount","cleanupCount","cleanupAndRemoveCount","all"],"mappings":"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","sourcesContent":["// @flow\n\nimport merge from 'lodash/merge';\nimport unset from 'lodash/unset';\nimport EventEmitter from 'events';\nimport makeLogger from './logger';\n\n// Local job emitter is for this process only,\n// jobEmitter is bridged when a MessagePort is open\nexport const localJobEmitter = new EventEmitter();\nexport const jobEmitter = new EventEmitter();\n\nconst logger = makeLogger('Jobs Database');\n\nexport class JobDoesNotExistError extends Error {\n  constructor(message:string) {\n    super(message);\n    this.name = 'JobDoesNotExistError';\n  }\n}\n\nexport class CleanupDoesNotExistError extends Error {\n  constructor(message:string) {\n    super(message);\n    this.name = 'CleanupDoesNotExistError';\n  }\n}\n\nexport type Job = {\n  id: number,\n  queueId:string,\n  type:string,\n  args:Array<any>,\n  attempt: number,\n  created: number,\n  status: number,\n  startAfter: number\n};\n\n\ntype Cleanup = {\n  id: number,\n  queueId:string,\n  data: Object,\n  attempt: number,\n  startAfter: number\n};\n\nexport const QUEUE_ERROR_STATUS = 0;\nexport const QUEUE_PENDING_STATUS = 1;\nexport const QUEUE_COMPLETE_STATUS = 2;\nexport const QUEUE_EMPTY_STATUS = 3;\n\nexport const JOB_ABORTED_STATUS = 2;\nexport const JOB_COMPLETE_STATUS = 1;\nexport const JOB_PENDING_STATUS = 0;\nexport const JOB_ERROR_STATUS = -1;\nexport const JOB_CLEANUP_STATUS = -2;\nexport const JOB_CLEANUP_AND_REMOVE_STATUS = -3;\n\nexport const databasePromise = (async () => {\n  const request = self.indexedDB.open('battery-queue-02', 1);\n\n  request.onupgradeneeded = function (e) {\n    try {\n      const store = e.target.result.createObjectStore('jobs', { keyPath: 'id', autoIncrement: true });\n      store.createIndex('statusIndex', 'status', { unique: false });\n      store.createIndex('queueIdIndex', 'queueId', { unique: false });\n      store.createIndex('queueIdTypeIndex', ['queueId', 'type'], { unique: false });\n      store.createIndex('statusQueueIdIndex', ['queueId', 'status'], { unique: false });\n      store.createIndex('createdIndex', 'created', { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      e.target.result.createObjectStore('queue-data', { keyPath: 'queueId' });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      const store = e.target.result.createObjectStore('cleanups', { keyPath: 'id' });\n      store.createIndex('queueIdIndex', 'queueId', { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      e.target.result.createObjectStore('auth-data', { keyPath: 'id' });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n  };\n\n  const db = await new Promise((resolve, reject) => {\n    request.onerror = () => {\n      reject(new Error('Unable to open database'));\n    };\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n  });\n\n  return db;\n})();\n\nasync function getReadWriteAuthObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['auth-data'], 'readwrite');\n  const objectStore = transaction.objectStore('auth-data');\n  transaction.onabort = (event) => {\n    logger.error('Read-write auth transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write auth transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyAuthObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['auth-data'], 'readonly');\n  const objectStore = transaction.objectStore('auth-data');\n  transaction.onabort = (event) => {\n    logger.error('Read-only auth transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only auth transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadWriteQueueDataObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['queue-data'], 'readwrite');\n  const objectStore = transaction.objectStore('queue-data');\n  transaction.onabort = (event) => {\n    logger.error('Read-write queue data transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write queue data transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyQueueDataObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['queue-data'], 'readonly');\n  const objectStore = transaction.objectStore('queue-data');\n  transaction.onabort = (event) => {\n    logger.error('Read-only queue data transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only queue data transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadWriteJobsObjectStoreAndTransactionPromise() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['jobs'], 'readwrite');\n  const objectStore = transaction.objectStore('jobs');\n  const promise = new Promise((resolve, reject) => {\n    transaction.onabort = (event) => {\n      logger.error('Read-write jobs transaction was aborted');\n      logger.errorObject(event);\n      reject(new Error('Read-write jobs transaction was aborted'));\n    };\n    transaction.onerror = (event) => {\n      logger.error('Error in read-write jobs transaction');\n      logger.errorObject(event);\n      reject(new Error('Error in read-write jobs transaction'));\n    };\n    transaction.oncomplete = () => {\n      resolve();\n    };\n  });\n  return [objectStore, promise];\n}\n\nasync function getReadOnlyJobsObjectStoreAndTransactionPromise() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['jobs'], 'readonly');\n  const objectStore = transaction.objectStore('jobs');\n  const promise = new Promise((resolve, reject) => {\n    transaction.onabort = (event) => {\n      logger.error('Read-only jobs transaction was aborted');\n      logger.errorObject(event);\n      reject(new Error('Read-only jobs transaction was aborted'));\n    };\n    transaction.onerror = (event) => {\n      logger.error('Error in read-only jobs transaction');\n      logger.errorObject(event);\n      reject(new Error('Error in read-only jobs transaction'));\n    };\n    transaction.oncomplete = () => {\n      resolve();\n    };\n  });\n  return [objectStore, promise];\n}\n\nasync function getReadWriteJobsObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['jobs'], 'readwrite');\n  const objectStore = transaction.objectStore('jobs');\n  transaction.onabort = (event) => {\n    logger.error('Read-write jobs transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write jobs transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyJobsObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['jobs'], 'readonly');\n  const objectStore = transaction.objectStore('jobs');\n  transaction.onabort = (event) => {\n    logger.error('Read-only jobs transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only jobs transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadWriteCleanupsObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['cleanups'], 'readwrite');\n  const objectStore = transaction.objectStore('cleanups');\n  transaction.onabort = (event) => {\n    logger.error('Read-write cleanups transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write cleanups transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyCleanupsObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['cleanups'], 'readonly');\n  const objectStore = transaction.objectStore('cleanups');\n  transaction.onabort = (event) => {\n    logger.error('Read-only cleanups transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only cleanups transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function clearQueueDataDatabase() {\n  const store = await getReadWriteQueueDataObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing queue data database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing queue data database'));\n    };\n  });\n}\n\nasync function clearJobsDatabase() {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing jobs database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing jobs database'));\n    };\n  });\n  localJobEmitter.emit('jobsClear');\n  jobEmitter.emit('jobsClear');\n}\n\nasync function clearCleanupsDatabase() {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing cleanups database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing cleanups database'));\n    };\n  });\n}\n\nexport async function clearDatabase() {\n  await clearJobsDatabase();\n  await clearCleanupsDatabase();\n  await clearQueueDataDatabase();\n}\n\nexport async function removeJobsWithQueueIdAndTypeFromDatabase(queueId:string, type:string) {\n  const [store, promise] = await getReadWriteJobsObjectStoreAndTransactionPromise();\n  const index = store.index('queueIdTypeIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only([queueId, type]));\n  request.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      const deleteRequest = store.delete(id);\n      deleteRequest.onsuccess = function () {\n        localJobEmitter.emit('jobDelete', id, queueId);\n        jobEmitter.emit('jobDelete', id, queueId);\n      };\n      deleteRequest.onerror = function (deleteEvent) {\n        logger.error(`Request error while removing job ${id} in queue ${queueId} and type ${type} from jobs database`);\n        logger.errorObject(deleteEvent);\n      };\n    }\n  };\n  request.onerror = function (event) {\n    logger.error(`Request error while removing jobs with queue ${queueId} and type ${type} from jobs database`);\n    logger.errorObject(event);\n  };\n  await promise;\n}\n\nexport async function removeQueueIdFromJobsDatabase(queueId:string) {\n  const [store, promise] = await getReadWriteJobsObjectStoreAndTransactionPromise();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only(queueId));\n  request.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      const deleteRequest = store.delete(id);\n      deleteRequest.onsuccess = function () {\n        localJobEmitter.emit('jobDelete', id, queueId);\n        jobEmitter.emit('jobDelete', id, queueId);\n      };\n      deleteRequest.onerror = function (deleteEvent) {\n        logger.error(`Request error while removing job ${id} in queue ${queueId} from jobs database`);\n        logger.errorObject(deleteEvent);\n      };\n    }\n  };\n  request.onerror = function (event) {\n    logger.error(`Request error while removing queue ${queueId} from jobs database`);\n    logger.errorObject(event);\n  };\n  await promise;\n}\n\nasync function removeQueueIdFromCleanupsDatabase(queueId:string) {\n  const store = await getReadWriteCleanupsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        store.delete(cursor.primaryKey);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing queue ${queueId} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while removing queue ${queueId} from jobs database`));\n    };\n  });\n}\n\nexport async function removeQueueIdFromDatabase(queueId:string) {\n  await removeQueueIdFromJobsDatabase(queueId);\n  await removeQueueIdFromCleanupsDatabase(queueId);\n}\n\nexport async function removeCompletedExpiredItemsFromDatabase(maxAge:number) {\n  const [store, promise] = await getReadWriteJobsObjectStoreAndTransactionPromise();\n  const index = store.index('createdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.bound(0, Date.now() - maxAge));\n  request.onsuccess = function (event) {\n    for (const { id, queueId, status } of event.target.result) {\n      if (status !== JOB_COMPLETE_STATUS) {\n        continue;\n      }\n      const deleteRequest = store.delete(id);\n      deleteRequest.onsuccess = function () {\n        localJobEmitter.emit('jobDelete', id, queueId);\n        jobEmitter.emit('jobDelete', id, queueId);\n      };\n      deleteRequest.onerror = function (deleteEvent) {\n        logger.error(`Request error while removing job ${id} in queue ${queueId} from completed exired items from jobs database`);\n        logger.errorObject(deleteEvent);\n      };\n    }\n  };\n  request.onerror = function (event) {\n    logger.error('Request error while removing completed exired items from jobs database');\n    logger.errorObject(event);\n  };\n  await promise;\n}\n\nexport async function updateJobInDatabase(id:number, transform:(Job | void) => Job | void | false):Promise<Job | void> {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      let newValue;\n      const value = request.result;\n      try {\n        newValue = transform(value);\n      } catch (error) {\n        reject(error);\n        return;\n      }\n      if (typeof newValue === 'undefined') {\n        resolve();\n      } else if (newValue === false) {\n        if (typeof value !== 'undefined') {\n          const { queueId, type } = value;\n          const deleteRequest = store.delete(id);\n          deleteRequest.onsuccess = function () {\n            localJobEmitter.emit('jobDelete', id, queueId);\n            jobEmitter.emit('jobDelete', id, queueId);\n            resolve();\n          };\n          deleteRequest.onerror = function (event) {\n            logger.error(`Delete request error while updating job ${id} in queue ${queueId} and type ${type} in jobs database`);\n            logger.errorObject(event);\n            reject(new Error(`Delete request error while updating job ${id} in queue ${queueId} and type ${type} from jobs database`));\n          };\n        }\n      } else {\n        const putRequest = store.put(newValue);\n        const { queueId, type, status } = newValue;\n        putRequest.onsuccess = function () {\n          localJobEmitter.emit('jobUpdate', id, queueId, type, status);\n          jobEmitter.emit('jobUpdate', id, queueId, type, status);\n          resolve();\n        };\n        putRequest.onerror = function (event) {\n          logger.error(`Put request error while updating job ${id} in queue ${queueId} and type ${type} in jobs database`);\n          logger.errorObject(event);\n          reject(new Error(`Put request error while updating job ${id} in queue ${queueId} and type ${type} from jobs database`));\n        };\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while updating ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while updating ${id}`));\n    };\n  });\n}\n\nexport async function getJobFromDatabase(id:number):Promise<Job | void> {\n  const store = await getReadOnlyJobsObjectStore();\n  const request = store.get(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id}`));\n    };\n  });\n}\n\nexport async function updateCleanupInDatabase(id:number, transform:(Cleanup | void) => Object):Promise<Cleanup | void> {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      let newValue;\n      try {\n        newValue = transform(request.result);\n      } catch (error) {\n        reject(error);\n        return;\n      }\n      if (typeof newValue === 'undefined') {\n        resolve();\n      } else {\n        const putRequest = store.put(newValue);\n        putRequest.onsuccess = function () {\n          resolve();\n        };\n        putRequest.onerror = function (event) {\n          logger.error(`Put request error while updating ${id} cleanup`);\n          logger.errorObject(event);\n          reject(new Error(`Put request error while updating ${id} cleanup`));\n        };\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while updating ${id} cleanup`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while updating ${id} cleanup`));\n    };\n  });\n}\n\nexport async function removePathFromCleanupDataInDatabase(id:number, path:Array<string>) {\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      return;\n    }\n    const { queueId, attempt, startAfter } = value;\n    const data = Object.assign({}, value.data);\n    unset(data, path);\n    return { // eslint-disable-line consistent-return\n      id,\n      queueId,\n      attempt,\n      startAfter,\n      data,\n    };\n  });\n}\n\n\nexport async function updateCleanupValuesInDatabase(id:number, queueId:string, data:Object) {\n  if (typeof id !== 'number') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (typeof data !== 'object') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"data\" argument type \"${typeof data}\"`);\n  }\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    const combinedData = typeof value === 'undefined' ? data : merge({}, value.data, data);\n    return {\n      id,\n      queueId,\n      attempt: 0,\n      startAfter: Date.now(),\n      data: combinedData,\n    };\n  });\n}\n\nexport async function removeJobFromDatabase(id:number) {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing job ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing job ${id}`));\n    };\n  });\n}\n\nexport async function removeCleanupFromDatabase(id:number) {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing cleanup data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing cleanup data for ${id}`));\n    };\n  });\n}\n\nexport async function getCleanupFromDatabase(id:number):Promise<Cleanup | void> {\n  const store = await getReadOnlyCleanupsObjectStore();\n  const request = store.get(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id}`));\n    };\n  });\n}\n\nexport async function getQueueDataFromDatabase(queueId:string) {\n  const store = await getReadOnlyQueueDataObjectStore();\n  const request = store.get(queueId);\n  const queueData = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting queue ${queueId} data`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting queue ${queueId} data`));\n    };\n  });\n  return typeof queueData !== 'undefined' ? queueData.data : undefined;\n}\n\nexport async function updateQueueDataInDatabase(queueId:string, data:Object) {\n  const value = await getQueueDataFromDatabase(queueId);\n  const store = await getReadWriteQueueDataObjectStore();\n  const request = store.put({\n    queueId,\n    data: merge({}, value, data),\n  });\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while updating queue ${queueId} data`);\n      logger.errorObject(event);\n      reject(new Error(`Error while updating queue ${queueId} data`));\n    };\n  });\n}\n\nexport function markJobStatusInDatabase(id:number, status:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to mark job ${id} as status ${status} in database, job does not exist`);\n    }\n    value.status = status; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport function markJobCompleteInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_COMPLETE_STATUS);\n}\n\nexport function markJobPendingInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_PENDING_STATUS);\n}\n\nexport function markJobErrorInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_ERROR_STATUS);\n}\n\nexport function markJobCleanupInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_CLEANUP_STATUS);\n}\n\nexport function markJobAbortedInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_ABORTED_STATUS);\n}\n\nexport function markJobCleanupAndRemoveInDatabase(id:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to mark job ${id} as status ${JOB_CLEANUP_AND_REMOVE_STATUS} in database, job does not exist`);\n    }\n    if (value.status === JOB_PENDING_STATUS) {\n      return false;\n    }\n    if (value.status === JOB_ABORTED_STATUS) {\n      return false;\n    }\n    value.status = JOB_CLEANUP_AND_REMOVE_STATUS; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport function markJobAsAbortedOrRemoveFromDatabase(id:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      return;\n    }\n    if (value.status === JOB_ERROR_STATUS) {\n      value.status = JOB_ABORTED_STATUS; // eslint-disable-line no-param-reassign\n      return value; // eslint-disable-line consistent-return\n    }\n    if (value.status === JOB_CLEANUP_STATUS) {\n      value.status = JOB_ABORTED_STATUS; // eslint-disable-line no-param-reassign\n      return value; // eslint-disable-line consistent-return\n    }\n    if (value.status === JOB_CLEANUP_AND_REMOVE_STATUS) {\n      return false; // eslint-disable-line consistent-return\n    }\n    throw new Error(`Unable to mark job ${id} as aborted or remove after cleanup, unable to handle status ${value.status}`);\n  });\n}\n\nexport function markJobStartAfterInDatabase(id:number, startAfter:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to mark job ${id} start-after time to ${new Date(startAfter).toLocaleString()} in database, job does not exist`);\n    }\n    if (startAfter < value.startAfter) {\n      return;\n    }\n    value.startAfter = startAfter; // eslint-disable-line no-param-reassign\n    return value; // eslint-disable-line consistent-return\n  });\n}\n\nexport function markCleanupStartAfterInDatabase(id:number, startAfter:number) {\n  return updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      throw new CleanupDoesNotExistError(`Unable to mark cleanup ${id} start-after time to ${new Date(startAfter).toLocaleString()} in database, cleanup does not exist`);\n    }\n    if (startAfter < value.startAfter) {\n      return;\n    }\n    value.startAfter = startAfter; // eslint-disable-line  no-param-reassign\n    return value; // eslint-disable-line consistent-return\n  });\n}\n\nexport async function markQueueForCleanupInDatabase(queueId:string) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        const value = Object.assign({}, cursor.value);\n        switch (value.status) {\n          case JOB_ERROR_STATUS:\n            value.status = JOB_CLEANUP_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_COMPLETE_STATUS:\n            value.status = JOB_CLEANUP_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_PENDING_STATUS:\n            value.status = JOB_ABORTED_STATUS;\n            break;\n          case JOB_CLEANUP_STATUS:\n            cursor.continue();\n            return;\n          case JOB_ABORTED_STATUS:\n            cursor.continue();\n            return;\n          default:\n            logger.warn(`Unhandled job status ${value.status}`);\n            cursor.continue();\n            return;\n        }\n        const updateRequest = cursor.update(value);\n        updateRequest.onsuccess = function () {\n          localJobEmitter.emit('jobUpdate', value.id, value.queueId, value.type, value.status);\n          jobEmitter.emit('jobUpdate', value.id, value.queueId, value.type, value.status);\n          cursor.continue();\n        };\n        updateRequest.onerror = function (event2) {\n          logger.error(`Update request error while marking queue ${queueId} error`);\n          logger.errorObject(event2);\n          cursor.continue();\n        };\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking queue ${queueId} error`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking queue ${queueId} error`));\n    };\n  });\n  return jobs;\n}\n\nexport async function incrementJobAttemptInDatabase(id:number) {\n  await updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to increment attempts for job ${id} in database, job does not exist`);\n    }\n    value.attempt += 1; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport async function incrementCleanupAttemptInDatabase(id:number, queueId:string) {\n  let attempt = 1;\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      return {\n        id,\n        queueId,\n        attempt: 1,\n        startAfter: Date.now(),\n        data: {},\n      };\n    }\n    attempt = value.attempt + 1;\n    value.attempt = attempt; // eslint-disable-line no-param-reassign\n    return value;\n  });\n  return attempt;\n}\n\nexport async function bulkEnqueueToDatabase(queueId: string, items:Array<[string, Array<any>]>, delay: number) { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to bulk enqueue in database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (!Array.isArray(items)) {\n    throw new TypeError(`Unable to bulk enqueue in database, received invalid \"items\" argument type \"${typeof items}\"`);\n  }\n  for (let i = 0; i < items.length; i += 1) {\n    const [type, args] = items[i];\n    if (typeof type !== 'string') {\n      throw new TypeError(`Unable to bulk enqueue in database, received invalid items[${i}] \"type\" argument type \"${typeof type}\"`);\n    }\n    if (!Array.isArray(args)) {\n      throw new TypeError(`Unable to bulk enqueue in database, received invalid items[${i}] \"args\" argument type \"${typeof args}\"`);\n    }\n  }\n  if (typeof delay !== 'number') {\n    throw new TypeError(`Unable to bulk enqueue in database, received invalid \"delay\" argument type \"${typeof delay}\"`);\n  }\n  const ids = [];\n  const store = await getReadWriteJobsObjectStore();\n  await new Promise((resolve, reject) => {\n    for (let i = 0; i < items.length; i += 1) {\n      const [type, args] = items[i];\n      const value = {\n        queueId,\n        type,\n        args,\n        attempt: 0,\n        created: Date.now(),\n        status: JOB_PENDING_STATUS,\n        startAfter: Date.now() + delay,\n      };\n      const request = store.put(value);\n      request.onsuccess = function () {\n        const id = request.result;\n        ids.push(request.result);\n        localJobEmitter.emit('jobAdd', id, queueId, type);\n        jobEmitter.emit('jobAdd', id, queueId, type);\n        resolve(request.result);\n      };\n      request.onerror = function (event) {\n        logger.error(`Request error while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`);\n        logger.errorObject(event);\n        reject(new Error(`Request error while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`));\n      };\n    }\n  });\n  return ids;\n}\n\nexport async function enqueueToDatabase(queueId: string, type: string, args: Array<any>, delay: number) { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (typeof type !== 'string') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"type\" argument type \"${typeof type}\"`);\n  }\n  if (!Array.isArray(args)) {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"args\" argument type \"${typeof args}\"`);\n  }\n  if (typeof delay !== 'number') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"delay\" argument type \"${typeof delay}\"`);\n  }\n  const value = {\n    queueId,\n    type,\n    args,\n    attempt: 0,\n    created: Date.now(),\n    status: JOB_PENDING_STATUS,\n    startAfter: Date.now() + delay,\n  };\n  const store = await getReadWriteJobsObjectStore();\n\n  const request = store.put(value);\n  const id = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while enqueueing ${type} job`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while enqueueing ${type} job`));\n    };\n  });\n  localJobEmitter.emit('jobAdd', id, queueId, type);\n  jobEmitter.emit('jobAdd', id, queueId, type);\n  return id;\n}\n\nexport async function restoreJobToDatabaseForCleanupAndRemove(id:number, queueId: string, type: string, args: Array<any>) { // eslint-disable-line no-underscore-dangle\n  if (typeof id !== 'number') {\n    throw new TypeError(`Unable to restore to database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to restore to database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (typeof type !== 'string') {\n    throw new TypeError(`Unable to restore to database, received invalid \"type\" argument type \"${typeof type}\"`);\n  }\n  if (!Array.isArray(args)) {\n    throw new TypeError(`Unable to restore to database, received invalid \"args\" argument type \"${typeof args}\"`);\n  }\n  const value = {\n    id,\n    queueId,\n    type,\n    args,\n    attempt: 1,\n    created: Date.now(),\n    status: JOB_CLEANUP_AND_REMOVE_STATUS,\n    startAfter: Date.now(),\n  };\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.put(value);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while enqueueing ${type} job`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while enqueueing ${type} job`));\n    };\n  });\n  localJobEmitter.emit('jobAdd', id, queueId, type);\n  jobEmitter.emit('jobAdd', id, queueId, type);\n  return id;\n}\n\nexport async function dequeueFromDatabase():Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.bound(JOB_CLEANUP_AND_REMOVE_STATUS, JOB_PENDING_STATUS));\n  const jobs = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error('Request error while dequeing');\n      logger.errorObject(event);\n      reject(new Error('Request error while dequeing'));\n    };\n  });\n  return jobs;\n}\n\nexport function getContiguousIds(ids:Array<number>) {\n  ids.sort((a, b) => a - b);\n  const points = [[0, ids[0] - 1]];\n  for (let i = 0; i < ids.length; i += 1) {\n    if (ids[i] + 1 !== ids[i + 1]) {\n      if (i + 1 >= ids.length) {\n        points.push([ids[i] + 1, Infinity]);\n      } else {\n        points.push([ids[i] + 1, ids[i + 1] - 1]);\n      }\n    }\n  }\n  return points;\n}\n\nexport async function dequeueFromDatabaseNotIn(ids:Array<number>):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (ids.length === 0) {\n    return dequeueFromDatabase();\n  }\n  const [store, promise] = await getReadOnlyJobsObjectStoreAndTransactionPromise();\n  const index = store.index('statusIndex');\n  const jobs = [];\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.bound(JOB_CLEANUP_STATUS, JOB_PENDING_STATUS));\n  request.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      if (ids.includes(id)) {\n        continue;\n      }\n      const getRequest = store.get(id);\n      getRequest.onsuccess = function () {\n        jobs.push(getRequest.result);\n      };\n      getRequest.onerror = function (event2) {\n        logger.error(`Request error while getting job ${id}`);\n        logger.errorObject(event2);\n      };\n    }\n  };\n  request.onerror = function (event) {\n    logger.error('Request error while dequeing');\n    logger.errorObject(event);\n  };\n  await promise;\n  return jobs;\n}\n\nexport async function getJobsFromDatabase(queueId: string):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to get completed jobs database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(queueId));\n  const jobs = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error('Request error while dequeing');\n      logger.errorObject(event);\n      reject(new Error('Request error while dequeing'));\n    };\n  });\n  return jobs;\n}\n\nexport async function getCompletedJobsCountFromDatabase(queueId: string) { // eslint-disable-line no-underscore-dangle\n  const jobs = await getCompletedJobsFromDatabase(queueId);\n  return jobs.length;\n}\n\nexport async function getCompletedJobsFromDatabase(queueId: string):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to get completed jobs database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only([queueId, JOB_COMPLETE_STATUS]));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        jobs.push(cursor.value);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting completed jobs for queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting completed jobs for queue ${queueId}`));\n    };\n  });\n  return jobs;\n}\n\nexport async function storeAuthDataInDatabase(id:string, data: Object) { // eslint-disable-line no-underscore-dangle\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  if (typeof data !== 'object') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"data\" argument type \"${typeof data}\"`);\n  }\n  const store = await getReadWriteAuthObjectStore();\n  const request = store.put({ id, data });\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while storing auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while storing auth data for ${id}`));\n    };\n  });\n}\n\nexport async function getAuthDataFromDatabase(id:string) {\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  const store = await getReadOnlyAuthObjectStore();\n  const request = store.get(id);\n  const authData = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting auth data for ${id}`));\n    };\n  });\n  return typeof authData !== 'undefined' ? authData.data : undefined;\n}\n\nexport async function removeAuthDataFromDatabase(id:string) {\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  const store = await getReadWriteAuthObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing auth data for ${id}`));\n    };\n  });\n}\n\nexport async function getQueueStatus(queueId:string) {\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  // $FlowFixMe\n  const abortedRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_ABORTED_STATUS]));\n  // $FlowFixMe\n  const completeRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_COMPLETE_STATUS]));\n  // $FlowFixMe\n  const pendingRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_PENDING_STATUS]));\n  // $FlowFixMe\n  const errorRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_ERROR_STATUS]));\n  // $FlowFixMe\n  const cleanupRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_CLEANUP_STATUS]));\n  // $FlowFixMe\n  const cleanupAndRemoveRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_CLEANUP_AND_REMOVE_STATUS]));\n  const abortedCountPromise = new Promise((resolve, reject) => {\n    abortedRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    abortedRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const completeCountPromise = new Promise((resolve, reject) => {\n    completeRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    completeRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const pendingCountPromise = new Promise((resolve, reject) => {\n    pendingRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    pendingRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const errorCountPromise = new Promise((resolve, reject) => {\n    errorRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    errorRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const cleanupCountPromise = new Promise((resolve, reject) => {\n    cleanupRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    cleanupRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const cleanupAndRemoveCountPromise = new Promise((resolve, reject) => {\n    cleanupAndRemoveRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    cleanupAndRemoveRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const [\n    abortedCount,\n    completeCount,\n    pendingCount,\n    errorCount,\n    cleanupCount,\n    cleanupAndRemoveCount,\n  ] = await Promise.all([\n    abortedCountPromise,\n    completeCountPromise,\n    pendingCountPromise,\n    errorCountPromise,\n    cleanupCountPromise,\n    cleanupAndRemoveCountPromise,\n  ]);\n  if (abortedCount > 0 || cleanupCount > 0) {\n    return QUEUE_ERROR_STATUS;\n  }\n  if (errorCount > 0 || pendingCount > 0 || cleanupAndRemoveCount > 0) {\n    return QUEUE_PENDING_STATUS;\n  }\n  if (completeCount > 0) {\n    return QUEUE_COMPLETE_STATUS;\n  }\n  return QUEUE_EMPTY_STATUS;\n}\n\n"],"file":"database.js"}