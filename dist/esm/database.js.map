{"version":3,"sources":["../../src/database.js"],"names":["JSONPath","merge","unset","uniq","EventEmitter","makeLogger","localJobEmitter","jobEmitter","logger","JobDoesNotExistError","Error","constructor","message","name","CleanupDoesNotExistError","QUEUE_ERROR_STATUS","QUEUE_PENDING_STATUS","QUEUE_COMPLETE_STATUS","QUEUE_EMPTY_STATUS","JOB_ABORTED_STATUS","JOB_COMPLETE_STATUS","JOB_PENDING_STATUS","JOB_ERROR_STATUS","JOB_CLEANUP_STATUS","JOB_CLEANUP_AND_REMOVE_STATUS","databasePromise","request","self","indexedDB","open","onupgradeneeded","e","store","target","result","createObjectStore","keyPath","autoIncrement","createIndex","unique","error","db","Promise","resolve","reject","onerror","onsuccess","event","getReadWriteObjectStore","database","transaction","durability","objectStore","onabort","errorObject","getReadOnlyObjectStore","getReadWriteArgLookupObjectStore","getReadOnlyArgLookupObjectStore","getReadWriteAuthObjectStore","getReadOnlyAuthObjectStore","getReadWriteMetadataObjectStore","getReadOnlyMetadataObjectStore","getReadWriteJobsObjectStore","getReadOnlyJobsObjectStore","getReadWriteCleanupsObjectStore","getReadOnlyCleanupsObjectStore","getReadWriteJobCleanupAndArgLookupStores","getReadWriteJobAndCleanupStores","getReadOnlyObjectStoreAndTransactionPromise","promise","oncomplete","getReadOnlyJobsObjectStoreAndTransactionPromise","silentlyRemoveJobCleanupAndArgLookup","jobsObjectStore","cleanupsObjectStore","argLookupObjectStore","jobId","queueId","onSuccess","onError","jobDeleteRequest","delete","cleanupDeleteRequest","argLookupJobIdIndex","index","argLookupJobRequest","getAllKeys","IDBKeyRange","only","id","argLookupDeleteRequest","deleteEvent","removeJobCleanupAndArgLookup","queueMicrotask","emit","clearAllMetadataInDatabase","clear","commit","clearJobsDatabase","clearCleanupsDatabase","clearDatabase","removeJobsWithQueueIdAndTypeFromDatabase","type","jobIds","i","length","removeQueueFromDatabase","removeCompletedExpiredItemsFromDatabase","maxAge","getAll","bound","Date","now","jobs","updateJobInDatabase","transform","get","newValue","value","deleteRequest","removeArgLookupsAndCleanupsForJobAsMicrotask","status","putRequest","put","getJobFromDatabase","updateCleanupInDatabase","removePathFromCleanupDataInDatabase","path","attempt","startAfter","data","Object","assign","updateCleanupValuesInDatabase","TypeError","combinedData","silentlyRemoveQueueFromDatabase","silentlyRemoveJobFromDatabase","removeJobFromDatabase","job","removeCleanupFromDatabase","getCleanupFromDatabase","getMetadataFromDatabase","response","metadata","undefined","clearMetadataInDatabase","setMetadataInDatabase","updateMetadataInDatabase","markJobStatusInDatabase","markJobCompleteInDatabase","markJobPendingInDatabase","markJobErrorInDatabase","markJobCleanupInDatabase","markJobAbortedInDatabase","markJobCompleteThenRemoveFromDatabase","markJobCleanupAndRemoveInDatabase","markJobAsAbortedOrRemoveFromDatabase","markJobStartAfterInDatabase","toLocaleString","markCleanupStartAfterInDatabase","markQueueForCleanupInDatabase","lastRequest","push","warn","event2","markQueueJobsGreaterThanIdCleanupAndRemoveInDatabase","shouldRemove","markQueueForCleanupAndRemoveInDatabase","markQueueJobsGreaterThanIdPendingInDatabase","markQueuePendingInDatabase","getGreatestJobIdFromQueueInDatabase","openCursor","cursor","incrementJobAttemptInDatabase","incrementCleanupAttemptInDatabase","bulkEnqueueToDatabase","items","Array","isArray","args","options","delay","prioritize","ids","abortedQueueCheckPromiseMap","Map","has","abortedRequest","set","created","then","hasAbortedJobs","console","log","catch","importJobsAndCleanups","cleanups","jobIdSet","Set","add","cleanupMap","cleanup","newJobs","didCommit","cleanupValue","cleanupAttempt","cleanupData","cleanupStartAfter","cleanupPutRequest","size","enqueueToDatabase","restoreJobToDatabaseForCleanupAndRemove","dequeueFromDatabase","getContiguousIds","sort","a","b","points","Infinity","dequeueFromDatabaseNotIn","includes","getRequest","getJobsWithTypeFromDatabase","getCleanupsInQueueFromDatabase","getJobsInQueueFromDatabase","getJobsInDatabase","getCompletedJobsCountFromDatabase","getCompletedJobsFromDatabase","storeAuthDataInDatabase","getAuthDataFromDatabase","authData","removeAuthDataFromDatabase","getQueueStatus","completeRequest","pendingRequest","errorRequest","cleanupRequest","cleanupAndRemoveRequest","abortedCountPromise","completeCountPromise","pendingCountPromise","errorCountPromise","cleanupCountPromise","cleanupAndRemoveCountPromise","abortedCount","completeCount","pendingCount","errorCount","cleanupCount","cleanupAndRemoveCount","all","addArgLookup","key","jsonPath","getArgLookupJobPathMap","map","x","markJobsWithArgLookupKeyCleanupAndRemoveInDatabase","lookupArgs","argLookupIndex","argLookupRequest","results","argLookupEvent","argLookups","jobRequest","json","lookupArg","jobsArgLookupsAndCleanupsToRemove","removeArgLookupsAndCleanupsForJob","slice","UNLOAD_DATA_ID","updateUnloadDataInDatabase","getUnloadDataFromDatabase","clearUnloadDataInDatabase"],"mappings":"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","sourcesContent":["// @flow\n\nimport { JSONPath } from 'jsonpath-plus';\nimport merge from 'lodash/merge';\nimport unset from 'lodash/unset';\nimport uniq from 'lodash/uniq';\nimport EventEmitter from 'events';\nimport makeLogger from './logger';\n\n// Local job emitter is for this process only,\n// jobEmitter is bridged when a MessagePort is open\nexport const localJobEmitter = new EventEmitter();\nexport const jobEmitter = new EventEmitter();\n\nconst logger = makeLogger('Jobs Database');\n\nexport class JobDoesNotExistError extends Error {\n  constructor(message:string) {\n    super(message);\n    this.name = 'JobDoesNotExistError';\n  }\n}\n\nexport class CleanupDoesNotExistError extends Error {\n  constructor(message:string) {\n    super(message);\n    this.name = 'CleanupDoesNotExistError';\n  }\n}\n\nexport type Job = {\n  id: number,\n  queueId:string,\n  type:string,\n  args:Array<any>,\n  attempt: number,\n  created: number,\n  status: number,\n  startAfter: number,\n  prioritize: boolean\n};\n\nexport type Cleanup = {\n  id: number,\n  queueId:string,\n  data: Object,\n  attempt: number,\n  startAfter: number\n};\n\nexport const QUEUE_ERROR_STATUS = 0;\nexport const QUEUE_PENDING_STATUS = 1;\nexport const QUEUE_COMPLETE_STATUS = 2;\nexport const QUEUE_EMPTY_STATUS = 3;\n\nexport const JOB_ABORTED_STATUS = 2;\nexport const JOB_COMPLETE_STATUS = 1;\nexport const JOB_PENDING_STATUS = 0;\nexport const JOB_ERROR_STATUS = -1;\nexport const JOB_CLEANUP_STATUS = -2;\nexport const JOB_CLEANUP_AND_REMOVE_STATUS = -3;\n\nexport const databasePromise = (async () => {\n  const request = self.indexedDB.open('battery-queue-08', 1);\n\n  request.onupgradeneeded = function (e) {\n    try {\n      const store = e.target.result.createObjectStore('jobs', { keyPath: 'id', autoIncrement: true });\n      store.createIndex('statusIndex', 'status', { unique: false });\n      store.createIndex('queueIdIndex', 'queueId', { unique: false });\n      store.createIndex('queueIdTypeIndex', ['queueId', 'type'], { unique: false });\n      store.createIndex('typeIndex', 'type', { unique: false });\n      store.createIndex('statusQueueIdIndex', ['queueId', 'status'], { unique: false });\n      store.createIndex('statusCreatedIndex', ['status', 'created'], { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      e.target.result.createObjectStore('metadata', { keyPath: 'id' });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      const store = e.target.result.createObjectStore('cleanups', { keyPath: 'id' });\n      store.createIndex('queueIdIndex', 'queueId', { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      e.target.result.createObjectStore('auth-data', { keyPath: 'id' });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      const store = e.target.result.createObjectStore('arg-lookup', { keyPath: 'id', autoIncrement: true });\n      store.createIndex('jobIdIndex', 'jobId', { unique: false });\n      store.createIndex('keyIndex', 'key', { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n  };\n\n  const db = await new Promise((resolve, reject) => {\n    request.onerror = () => {\n      reject(new Error('Unable to open database'));\n    };\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n  });\n\n  return db;\n})();\n\nasync function getReadWriteObjectStore(name:string) {\n  const database = await databasePromise;\n  const transaction = database.transaction([name], 'readwrite', { durability: 'relaxed' });\n  const objectStore = transaction.objectStore(name);\n  transaction.onabort = (event) => {\n    logger.error(`Read-write \"${name}\" transaction was aborted`);\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error(`Error in read-write \"${name}\" transaction`);\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyObjectStore(name:string) {\n  const database = await databasePromise;\n  const transaction = database.transaction([name], 'readonly', { durability: 'relaxed' });\n  const objectStore = transaction.objectStore(name);\n  transaction.onabort = (event) => {\n    logger.error(`Read-only \"${name}\" transaction was aborted`);\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error(`Error in read-only \"${name}\" transaction`);\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nfunction getReadWriteArgLookupObjectStore() {\n  return getReadWriteObjectStore('arg-lookup');\n}\n\nfunction getReadOnlyArgLookupObjectStore() {\n  return getReadOnlyObjectStore('arg-lookup');\n}\n\nfunction getReadWriteAuthObjectStore() {\n  return getReadWriteObjectStore('auth-data');\n}\n\nfunction getReadOnlyAuthObjectStore() {\n  return getReadOnlyObjectStore('auth-data');\n}\n\nfunction getReadWriteMetadataObjectStore() {\n  return getReadWriteObjectStore('metadata');\n}\n\nfunction getReadOnlyMetadataObjectStore() {\n  return getReadOnlyObjectStore('metadata');\n}\n\nfunction getReadWriteJobsObjectStore() {\n  return getReadWriteObjectStore('jobs');\n}\n\nfunction getReadOnlyJobsObjectStore() {\n  return getReadOnlyObjectStore('jobs');\n}\n\nfunction getReadWriteCleanupsObjectStore() {\n  return getReadWriteObjectStore('cleanups');\n}\n\nfunction getReadOnlyCleanupsObjectStore() {\n  return getReadOnlyObjectStore('cleanups');\n}\n\nasync function getReadWriteJobCleanupAndArgLookupStores() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['jobs', 'cleanups', 'arg-lookup'], 'readwrite', { durability: 'relaxed' });\n  transaction.onabort = (event) => {\n    logger.error('Read-write \\'jobs\\', \\'cleanups\\', and \\'arg-lookup\\' transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write \\'jobs\\', \\'cleanups\\', and \\'arg-lookup\\' transaction');\n    logger.errorObject(event);\n  };\n  return [transaction.objectStore('jobs'), transaction.objectStore('cleanups'), transaction.objectStore('arg-lookup')];\n}\n\nasync function getReadWriteJobAndCleanupStores() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['jobs', 'cleanups'], 'readwrite', { durability: 'relaxed' });\n  transaction.onabort = (event) => {\n    logger.error('Read-write \\'jobs\\' and \\'cleanups\\' transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write \\'jobs\\' and \\'cleanups\\' transaction');\n    logger.errorObject(event);\n  };\n  return [transaction.objectStore('jobs'), transaction.objectStore('cleanups')];\n}\n\nasync function getReadOnlyObjectStoreAndTransactionPromise(name:string) {\n  const database = await databasePromise;\n  const transaction = database.transaction([name], 'readonly', { durability: 'relaxed' });\n  const objectStore = transaction.objectStore(name);\n  const promise = new Promise((resolve, reject) => {\n    transaction.onabort = (event) => {\n      logger.error(`Read-write \"${name}\" transaction was aborted`);\n      logger.errorObject(event);\n      reject(new Error(`Read-write \"${name}\" transaction was aborted`));\n    };\n    transaction.onerror = (event) => {\n      logger.error(`Error in read-write \"${name}\" transaction`);\n      logger.errorObject(event);\n      reject(new Error(`Error in read-write \"${name}\" transaction`));\n    };\n    transaction.oncomplete = () => {\n      resolve();\n    };\n  });\n  return [objectStore, promise];\n}\n\n\nfunction getReadOnlyJobsObjectStoreAndTransactionPromise() {\n  return getReadOnlyObjectStoreAndTransactionPromise('jobs');\n}\n\nfunction silentlyRemoveJobCleanupAndArgLookup(jobsObjectStore:IDBObjectStore, cleanupsObjectStore:IDBObjectStore, argLookupObjectStore:IDBObjectStore, jobId:number, queueId:string, onSuccess?:() => void, onError?:(Error) => void) {\n  const jobDeleteRequest = jobsObjectStore.delete(jobId);\n  jobDeleteRequest.onerror = function (event) {\n    logger.error(`Request error while removing job ${jobId} in queue ${queueId} from database`);\n    logger.errorObject(event);\n    if (typeof onError === 'function') {\n      onError(new Error(`Request error while removing job ${jobId} in queue ${queueId} from database`));\n    }\n  };\n  const cleanupDeleteRequest = cleanupsObjectStore.delete(jobId);\n  cleanupDeleteRequest.onerror = function (event) {\n    logger.error(`Request error while removing cleanup for job ${jobId} in queue ${queueId} from database`);\n    logger.errorObject(event);\n    if (typeof onError === 'function') {\n      onError(new Error(`Request error while removing cleanup for job ${jobId} in queue ${queueId} from database`));\n    }\n  };\n  const argLookupJobIdIndex = argLookupObjectStore.index('jobIdIndex');\n  // $FlowFixMe\n  const argLookupJobRequest = argLookupJobIdIndex.getAllKeys(IDBKeyRange.only(jobId));\n  argLookupJobRequest.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      const argLookupDeleteRequest = argLookupObjectStore.delete(id);\n      argLookupDeleteRequest.onerror = function (deleteEvent) {\n        logger.error(`Delete request error while removing argument lookups for job ${jobId} in queue ${queueId} from database`);\n        logger.errorObject(deleteEvent);\n        if (typeof onError === 'function') {\n          onError(new Error(`Delete request error while removing argument lookups for job ${jobId} in queue ${queueId} from database`));\n        }\n      };\n    }\n    if (typeof onSuccess === 'function') {\n      onSuccess();\n    }\n  };\n  argLookupJobRequest.onerror = function (event) {\n    logger.error(`Request error while removing argument lookups for job ${jobId} in queue ${queueId} from database`);\n    logger.errorObject(event);\n    if (typeof onError === 'function') {\n      onError(new Error(`Request error while removing argument lookups for job ${jobId} in queue ${queueId} from database`));\n    }\n  };\n}\n\nfunction removeJobCleanupAndArgLookup(jobsObjectStore:IDBObjectStore, cleanupsObjectStore:IDBObjectStore, argLookupObjectStore:IDBObjectStore, jobId:number, queueId:string, onSuccess?:() => void, onError?:(Error) => void) {\n  queueMicrotask(() => {\n    localJobEmitter.emit('jobDelete', jobId, queueId);\n    jobEmitter.emit('jobDelete', jobId, queueId);\n  });\n  return silentlyRemoveJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId, onSuccess, onError);\n}\n\nasync function clearAllMetadataInDatabase() {\n  const store = await getReadWriteMetadataObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing queue data database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing queue data database'));\n    };\n    store.transaction.commit();\n  });\n}\n\nasync function clearJobsDatabase() {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.clear();\n  localJobEmitter.emit('jobsClear');\n  jobEmitter.emit('jobsClear');\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing jobs database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing jobs database'));\n    };\n    store.transaction.commit();\n  });\n}\n\nasync function clearCleanupsDatabase() {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing cleanups database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing cleanups database'));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function clearDatabase() {\n  await clearJobsDatabase();\n  await clearCleanupsDatabase();\n  await clearAllMetadataInDatabase();\n}\n\nexport async function removeJobsWithQueueIdAndTypeFromDatabase(queueId:string, type:string) {\n  const [jobsObjectStore, cleanupsObjectStore, argLookupObjectStore] = await getReadWriteJobCleanupAndArgLookupStores();\n  const index = jobsObjectStore.index('queueIdTypeIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only([queueId, type]));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const jobIds = event.target.result;\n      for (let i = 0; i < jobIds.length; i += 1) {\n        const jobId = jobIds[i];\n        if (i === jobIds.length - 1) {\n          removeJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId, resolve, reject);\n        } else {\n          removeJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId);\n        }\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing jobs with queue ${queueId} and type ${type} from jobs database`);\n      logger.errorObject(event);\n    };\n  });\n}\n\nexport async function removeQueueFromDatabase(queueId:string) {\n  const [jobsObjectStore, cleanupsObjectStore, argLookupObjectStore] = await getReadWriteJobCleanupAndArgLookupStores();\n  const index = jobsObjectStore.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only(queueId));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const jobIds = event.target.result;\n      for (let i = 0; i < jobIds.length; i += 1) {\n        const jobId = jobIds[i];\n        if (i === jobIds.length - 1) {\n          removeJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId, () => {\n            jobsObjectStore.transaction.commit();\n            resolve();\n          }, reject);\n        } else {\n          removeJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId);\n        }\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing queue ${queueId} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while removing queue ${queueId} from jobs database`));\n    };\n  });\n}\n\nexport async function removeCompletedExpiredItemsFromDatabase(maxAge:number) {\n  const [jobsObjectStore, cleanupsObjectStore, argLookupObjectStore] = await getReadWriteJobCleanupAndArgLookupStores();\n  const index = jobsObjectStore.index('statusCreatedIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.bound([JOB_COMPLETE_STATUS, 0], [JOB_COMPLETE_STATUS, Date.now() - maxAge]));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const jobs = event.target.result;\n      for (let i = 0; i < jobs.length; i += 1) {\n        const { id: jobId, queueId } = jobs[i];\n        if (i === jobs.length - 1) {\n          removeJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId, () => {\n            jobsObjectStore.transaction.commit();\n            resolve();\n          }, reject);\n        } else {\n          removeJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId);\n        }\n      }\n      if (jobs.length === 0) {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing completed jobs with age > ${maxAge}ms`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while removing completed jobs with age > ${maxAge}ms`));\n    };\n  });\n}\n\nexport async function updateJobInDatabase(id:number, transform:(Job | void) => Job | void | false):Promise<Job | void> {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      let newValue;\n      const value = request.result;\n      try {\n        newValue = transform(value);\n      } catch (error) {\n        reject(error);\n        return;\n      }\n      if (typeof newValue === 'undefined') {\n        resolve();\n      } else if (newValue === false) {\n        if (typeof value !== 'undefined') {\n          const { queueId, type } = value;\n          const deleteRequest = store.delete(id);\n          localJobEmitter.emit('jobDelete', id, queueId);\n          jobEmitter.emit('jobDelete', id, queueId);\n          deleteRequest.onsuccess = function () {\n            removeArgLookupsAndCleanupsForJobAsMicrotask(id);\n            resolve();\n          };\n          deleteRequest.onerror = function (event) {\n            logger.error(`Delete request error while updating job ${id} in queue ${queueId} and type ${type} in jobs database`);\n            logger.errorObject(event);\n            reject(new Error(`Delete request error while updating job ${id} in queue ${queueId} and type ${type} from jobs database`));\n          };\n        } else {\n          resolve();\n        }\n      } else {\n        const { queueId, type, status } = newValue;\n        const putRequest = store.put(newValue);\n        localJobEmitter.emit('jobUpdate', id, queueId, type, status);\n        jobEmitter.emit('jobUpdate', id, queueId, type, status);\n        putRequest.onsuccess = function () {\n          resolve();\n        };\n        putRequest.onerror = function (event) {\n          logger.error(`Put request error while updating job ${id} in queue ${queueId} and type ${type} in jobs database`);\n          logger.errorObject(event);\n          reject(new Error(`Put request error while updating job ${id} in queue ${queueId} and type ${type} from jobs database`));\n        };\n      }\n      store.transaction.commit();\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while updating ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while updating ${id}`));\n    };\n  });\n}\n\nexport async function getJobFromDatabase(id:number):Promise<Job | void> {\n  const store = await getReadOnlyJobsObjectStore();\n  const request = store.get(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id}`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function updateCleanupInDatabase(id:number, transform:(Cleanup | void) => Object):Promise<Cleanup | void> {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      let newValue;\n      try {\n        newValue = transform(request.result);\n      } catch (error) {\n        reject(error);\n        return;\n      }\n      if (typeof newValue === 'undefined') {\n        resolve();\n      } else {\n        const putRequest = store.put(newValue);\n        putRequest.onsuccess = function () {\n          resolve();\n        };\n        putRequest.onerror = function (event) {\n          logger.error(`Put request error while updating ${id} cleanup`);\n          logger.errorObject(event);\n          reject(new Error(`Put request error while updating ${id} cleanup`));\n        };\n      }\n      store.transaction.commit();\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while updating ${id} cleanup`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while updating ${id} cleanup`));\n    };\n  });\n}\n\nexport async function removePathFromCleanupDataInDatabase(id:number, path:Array<string>) {\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      return;\n    }\n    const { queueId, attempt, startAfter } = value;\n    const data = Object.assign({}, value.data);\n    unset(data, path);\n    return { // eslint-disable-line consistent-return\n      id,\n      queueId,\n      attempt,\n      startAfter,\n      data,\n    };\n  });\n}\n\n\nexport async function updateCleanupValuesInDatabase(id:number, queueId:string, data:Object) {\n  if (typeof id !== 'number') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (typeof data !== 'object') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"data\" argument type \"${typeof data}\"`);\n  }\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    const combinedData = typeof value === 'undefined' ? data : merge({}, value.data, data);\n    return {\n      id,\n      queueId,\n      attempt: 0,\n      startAfter: Date.now(),\n      data: combinedData,\n    };\n  });\n}\n\nexport async function silentlyRemoveQueueFromDatabase(queueId:string) {\n  const [jobsObjectStore, cleanupsObjectStore, argLookupObjectStore] = await getReadWriteJobCleanupAndArgLookupStores();\n  const index = jobsObjectStore.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only(queueId));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const jobIds = event.target.result;\n      for (let i = 0; i < jobIds.length; i += 1) {\n        const jobId = jobIds[i];\n        if (i === jobIds.length - 1) {\n          silentlyRemoveJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId, () => {\n            jobsObjectStore.transaction.commit();\n            resolve();\n          }, reject);\n        } else {\n          silentlyRemoveJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, jobId, queueId);\n        }\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing queue ${queueId} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while removing queue ${queueId} from jobs database`));\n    };\n  });\n}\n\nexport async function silentlyRemoveJobFromDatabase(id:number) {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.delete(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Delete request error while removing job ${id} from database`);\n      logger.errorObject(event);\n      reject(new Error(`Delete request error while removing job ${id} from database`));\n    };\n    store.transaction.commit();\n  });\n}\n\n\nexport async function removeJobFromDatabase(jobId:number) {\n  const [jobsObjectStore, cleanupsObjectStore, argLookupObjectStore] = await getReadWriteJobCleanupAndArgLookupStores();\n  const request = jobsObjectStore.get(jobId);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      const job = request.result;\n      if (typeof job === 'undefined') {\n        resolve();\n        jobsObjectStore.transaction.commit();\n        return;\n      }\n      removeJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, job.id, job.queueId, () => {\n        resolve();\n      }, reject);\n      jobsObjectStore.transaction.commit();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting job ${jobId} before removing from database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting job ${jobId} before removing from database`));\n    };\n  });\n}\n\nexport async function removeCleanupFromDatabase(id:number) {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing cleanup data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing cleanup data for ${id}`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function getCleanupFromDatabase(id:number):Promise<Cleanup | void> {\n  const store = await getReadOnlyCleanupsObjectStore();\n  const request = store.get(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id}`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function getMetadataFromDatabase(id:string) {\n  const store = await getReadOnlyMetadataObjectStore();\n  const request = store.get(id);\n  const response = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id} metadata`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id} metadata`));\n    };\n    store.transaction.commit();\n  });\n  return typeof response !== 'undefined' ? response.metadata : undefined;\n}\n\nexport async function clearMetadataInDatabase(id:string) {\n  const store = await getReadWriteMetadataObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while clearing ${id} metadata`);\n      logger.errorObject(event);\n      reject(new Error(`Error while clearing ${id} metadata`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function setMetadataInDatabase(id:string, metadata:Object) {\n  const store = await getReadWriteMetadataObjectStore();\n  const request = store.put({\n    id,\n    metadata,\n  });\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while setting ${id} metadata`);\n      logger.errorObject(event);\n      reject(new Error(`Error while setting ${id} metadata`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function updateMetadataInDatabase(id:string, transform:(Object | void) => Object | void | false):Promise<Object | void> {\n  const store = await getReadWriteMetadataObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      let newValue;\n      const response = request.result;\n      const value = typeof response !== 'undefined' ? response.metadata : undefined;\n      try {\n        newValue = transform(value);\n      } catch (error) {\n        reject(error);\n        return;\n      }\n      if (typeof newValue === 'undefined') {\n        resolve();\n      } else if (newValue === false) {\n        if (typeof value !== 'undefined') {\n          const deleteRequest = store.delete(id);\n          deleteRequest.onsuccess = function () {\n            resolve();\n          };\n          deleteRequest.onerror = function (event) {\n            logger.error(`Delete request error while updating ${id} in metadata database`);\n            logger.errorObject(event);\n            reject(new Error(`Delete request error while updating ${id} in metadata database`));\n          };\n        }\n      } else {\n        const putRequest = store.put({\n          id,\n          metadata: newValue,\n        });\n        putRequest.onsuccess = function () {\n          resolve();\n        };\n        putRequest.onerror = function (event) {\n          logger.error(`Put request error while updating ${id} in metadata database`);\n          logger.errorObject(event);\n          reject(new Error(`Put request error while updating ${id} in metadata database`));\n        };\n      }\n      store.transaction.commit();\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while updating ${id} in metadata database`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while updating ${id} in metadata database`));\n    };\n  });\n}\n\nexport function markJobStatusInDatabase(id:number, status:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to mark job ${id} as status ${status} in database, job does not exist`);\n    }\n    value.status = status; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport function markJobCompleteInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_COMPLETE_STATUS);\n}\n\nexport function markJobPendingInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_PENDING_STATUS);\n}\n\nexport function markJobErrorInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_ERROR_STATUS);\n}\n\nexport function markJobCleanupInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_CLEANUP_STATUS);\n}\n\nexport function markJobAbortedInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_ABORTED_STATUS);\n}\n\nexport async function markJobCompleteThenRemoveFromDatabase(id:number):Promise<void> {\n  const [jobsObjectStore, cleanupsObjectStore, argLookupObjectStore] = await getReadWriteJobCleanupAndArgLookupStores();\n  const request = jobsObjectStore.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      const value = request.result;\n      if (typeof value !== 'undefined') {\n        const { queueId, type } = value;\n        localJobEmitter.emit('jobUpdate', id, queueId, type, JOB_COMPLETE_STATUS);\n        jobEmitter.emit('jobUpdate', id, queueId, type, JOB_COMPLETE_STATUS);\n        removeJobCleanupAndArgLookup(jobsObjectStore, cleanupsObjectStore, argLookupObjectStore, id, queueId, () => {\n          jobsObjectStore.transaction.commit();\n          resolve();\n        });\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while marking job ${id} complete then removing from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while marking job ${id} complete then removing from jobs database`));\n    };\n  });\n}\n\nexport function markJobCleanupAndRemoveInDatabase(id:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      return false;\n    }\n    if (value.status === JOB_PENDING_STATUS) {\n      return false;\n    }\n    if (value.status === JOB_ABORTED_STATUS) {\n      return false;\n    }\n    value.status = JOB_CLEANUP_AND_REMOVE_STATUS; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport function markJobAsAbortedOrRemoveFromDatabase(id:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      return;\n    }\n    if (value.status === JOB_ERROR_STATUS) {\n      value.status = JOB_ABORTED_STATUS; // eslint-disable-line no-param-reassign\n      return value; // eslint-disable-line consistent-return\n    }\n    if (value.status === JOB_CLEANUP_STATUS) {\n      value.status = JOB_ABORTED_STATUS; // eslint-disable-line no-param-reassign\n      return value; // eslint-disable-line consistent-return\n    }\n    if (value.status === JOB_CLEANUP_AND_REMOVE_STATUS) {\n      return false; // eslint-disable-line consistent-return\n    }\n    throw new Error(`Unable to mark job ${id} as aborted or remove after cleanup, unable to handle status ${value.status}`);\n  });\n}\n\nexport function markJobStartAfterInDatabase(id:number, startAfter:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to mark job ${id} start-after time to ${new Date(startAfter).toLocaleString()} in database, job does not exist`);\n    }\n    if (startAfter < value.startAfter) {\n      return;\n    }\n    value.startAfter = startAfter; // eslint-disable-line no-param-reassign\n    return value; // eslint-disable-line consistent-return\n  });\n}\n\nexport function markCleanupStartAfterInDatabase(id:number, startAfter:number) {\n  return updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      throw new CleanupDoesNotExistError(`Unable to mark cleanup ${id} start-after time to ${new Date(startAfter).toLocaleString()} in database, cleanup does not exist`);\n    }\n    if (startAfter < value.startAfter) {\n      return;\n    }\n    value.startAfter = startAfter; // eslint-disable-line  no-param-reassign\n    return value; // eslint-disable-line consistent-return\n  });\n}\n\nexport async function markQueueForCleanupInDatabase(queueId:string) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(queueId));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const length = event.target.result.length;\n      let lastRequest;\n      for (let i = 0; i < length; i += 1) {\n        const value = Object.assign({}, event.target.result[i]);\n        switch (value.status) {\n          case JOB_ERROR_STATUS:\n            value.status = JOB_CLEANUP_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_COMPLETE_STATUS:\n            value.status = JOB_CLEANUP_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_PENDING_STATUS:\n            value.status = JOB_ABORTED_STATUS;\n            break;\n          case JOB_CLEANUP_STATUS:\n            jobs.push(value);\n            continue;\n          case JOB_CLEANUP_AND_REMOVE_STATUS:\n            jobs.push(value);\n            continue;\n          case JOB_ABORTED_STATUS:\n            continue;\n          default:\n            logger.warn(`Unhandled job status ${value.status} while marking queue ${queueId} for cleanup`);\n            continue;\n        }\n        const putRequest = store.put(value);\n        localJobEmitter.emit('jobUpdate', value.id, value.queueId, value.type, value.status);\n        jobEmitter.emit('jobUpdate', value.id, value.queueId, value.type, value.status);\n        lastRequest = putRequest;\n        putRequest.onerror = function (event2) {\n          logger.error(`Put request error while marking queue ${queueId} for cleanup`);\n          logger.errorObject(event2);\n          reject(new Error(`Put request error while marking queue ${queueId} for cleanup`));\n        };\n      }\n      if (typeof lastRequest !== 'undefined') {\n        lastRequest.onsuccess = function () {\n          resolve();\n        };\n      } else {\n        resolve();\n      }\n      store.transaction.commit();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking queue ${queueId} for cleanup`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking queue ${queueId} for cleanup`));\n    };\n  });\n  return jobs;\n}\n\nexport async function markQueueJobsGreaterThanIdCleanupAndRemoveInDatabase(queueId:string, jobId:number) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(queueId));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const length = event.target.result.length;\n      let lastRequest;\n      for (let i = 0; i < length; i += 1) {\n        const value = Object.assign({}, event.target.result[i]);\n        if (value.id <= jobId) {\n          continue;\n        }\n        let shouldRemove = false;\n        switch (value.status) {\n          case JOB_ERROR_STATUS:\n            value.status = JOB_CLEANUP_AND_REMOVE_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_COMPLETE_STATUS:\n            value.status = JOB_CLEANUP_AND_REMOVE_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_PENDING_STATUS:\n            shouldRemove = true;\n            break;\n          case JOB_CLEANUP_STATUS:\n            value.status = JOB_CLEANUP_AND_REMOVE_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_CLEANUP_AND_REMOVE_STATUS:\n            jobs.push(value);\n            continue;\n          case JOB_ABORTED_STATUS:\n            shouldRemove = true;\n            break;\n          default:\n            logger.warn(`Unhandled job status ${value.status} while marking queue ${queueId} for cleanup and removal`);\n            continue;\n        }\n        const { id, type, status } = value;\n        if (shouldRemove) {\n          const deleteRequest = store.delete(id);\n          localJobEmitter.emit('jobDelete', id, queueId);\n          jobEmitter.emit('jobDelete', id, queueId);\n          removeArgLookupsAndCleanupsForJobAsMicrotask(id);\n          lastRequest = deleteRequest;\n          deleteRequest.onerror = function (event2) {\n            logger.error(`Delete request error while marking queue ${queueId} for cleanup and removal`);\n            logger.errorObject(event2);\n            reject(new Error(`Delete request error while marking queue ${queueId} for cleanup and removal`));\n          };\n        } else {\n          const putRequest = store.put(value);\n          localJobEmitter.emit('jobUpdate', id, queueId, type, status);\n          jobEmitter.emit('jobUpdate', id, queueId, type, status);\n          lastRequest = putRequest;\n          putRequest.onerror = function (event2) {\n            logger.error(`Put request error while marking queue ${queueId} for cleanup and removal`);\n            logger.errorObject(event2);\n            reject(new Error(`Put request error while marking queue ${queueId} for cleanup and removal`));\n          };\n        }\n      }\n      if (typeof lastRequest !== 'undefined') {\n        lastRequest.onsuccess = function () {\n          resolve();\n        };\n      } else {\n        resolve();\n      }\n      store.transaction.commit();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking queue ${queueId} for cleanup and removal`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking queue ${queueId} for cleanup and removal`));\n    };\n  });\n  return jobs;\n}\n\nexport function markQueueForCleanupAndRemoveInDatabase(queueId:string) {\n  return markQueueJobsGreaterThanIdCleanupAndRemoveInDatabase(queueId, -1);\n}\n\nexport async function markQueueJobsGreaterThanIdPendingInDatabase(queueId:string, jobId:number) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(queueId));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const length = event.target.result.length;\n      let lastRequest;\n      for (let i = 0; i < length; i += 1) {\n        const value = Object.assign({}, event.target.result[i]);\n        if (value.id <= jobId) {\n          continue;\n        }\n        switch (value.status) {\n          case JOB_ERROR_STATUS:\n            value.attempt = 0;\n            jobs.push(value);\n            break;\n          case JOB_COMPLETE_STATUS:\n            continue;\n          case JOB_PENDING_STATUS:\n            value.attempt = 0;\n            jobs.push(value);\n            break;\n          case JOB_CLEANUP_STATUS:\n            value.attempt = 0;\n            jobs.push(value);\n            break;\n          case JOB_CLEANUP_AND_REMOVE_STATUS:\n            jobs.push(value);\n            continue;\n          case JOB_ABORTED_STATUS:\n            value.attempt = 0;\n            value.status = JOB_PENDING_STATUS;\n            jobs.push(value);\n            break;\n          default:\n            logger.warn(`Unhandled job status ${value.status} while marking queue ${queueId} as pending`);\n            continue;\n        }\n        const { id, type, status } = value;\n        const putRequest = store.put(value);\n        localJobEmitter.emit('jobUpdate', id, queueId, type, status);\n        jobEmitter.emit('jobUpdate', id, queueId, type, status);\n        lastRequest = putRequest;\n        putRequest.onerror = function (event2) {\n          logger.error(`Put request error while marking queue ${queueId} as pending`);\n          logger.errorObject(event2);\n          reject(new Error(`Put request error while marking queue ${queueId} as pending`));\n        };\n      }\n      if (typeof lastRequest !== 'undefined') {\n        lastRequest.onsuccess = function () {\n          resolve();\n        };\n      } else {\n        resolve();\n      }\n      store.transaction.commit();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking queue ${queueId} as pending`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking queue ${queueId} as pending`));\n    };\n  });\n  return jobs;\n}\n\n\nexport function markQueuePendingInDatabase(queueId:string) {\n  return markQueueJobsGreaterThanIdPendingInDatabase(queueId, -1);\n}\n\nexport async function getGreatestJobIdFromQueueInDatabase(queueId:string) {\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId), 'prev');\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        resolve(cursor.value.id || 0);\n      } else {\n        resolve(0);\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting the greatest job ID in queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting the greatest job ID in queue ${queueId}`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function incrementJobAttemptInDatabase(id:number) {\n  await updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to increment attempts for job ${id} in database, job does not exist`);\n    }\n    value.attempt += 1; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport async function incrementCleanupAttemptInDatabase(id:number, queueId:string) {\n  let attempt = 1;\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      return {\n        id,\n        queueId,\n        attempt: 1,\n        startAfter: Date.now(),\n        data: {},\n      };\n    }\n    attempt = value.attempt + 1;\n    value.attempt = attempt; // eslint-disable-line no-param-reassign\n    return value;\n  });\n  return attempt;\n}\n\ntype EnqueueOptions = {\n  delay?: number,\n  prioritize?: boolean\n}\n\nexport async function bulkEnqueueToDatabase(items:Array<[string, string, Array<any>, EnqueueOptions]>) { // eslint-disable-line no-underscore-dangle\n  if (!Array.isArray(items)) {\n    throw new TypeError(`Unable to bulk enqueue in database, received invalid \"items\" argument type \"${typeof items}\"`);\n  }\n  for (const [queueId, type, args, options = {}] of items) {\n    if (typeof queueId !== 'string') {\n      throw new TypeError(`Unable to enqueue in database, received invalid \"queueId\" argument type \"${typeof queueId}\", should be string`);\n    }\n    if (typeof type !== 'string') {\n      throw new TypeError(`Unable to enqueue in database, received invalid \"type\" argument type \"${typeof type}\", should be string`);\n    }\n    if (!Array.isArray(args)) {\n      throw new TypeError(`Unable to enqueue in database, received invalid \"args\" argument type \"${typeof args}\", should be Array<any>`);\n    }\n    const delay = options.delay || 0;\n    const prioritize = options.prioritize || false;\n    if (typeof delay !== 'number') {\n      throw new TypeError(`Unable to enqueue in database, received invalid \"options.delay\" argument type \"${typeof delay}\", should be number`);\n    }\n    if (typeof prioritize !== 'boolean') {\n      throw new TypeError(`Unable to enqueue in database, received invalid \"options.prioritize\" argument type \"${typeof prioritize}\", should be boolean`);\n    }\n  }\n  const ids = [];\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  const abortedQueueCheckPromiseMap = new Map();\n  for (const [queueId] of items) {\n    if (abortedQueueCheckPromiseMap.has(queueId)) {\n      continue;\n    }\n    // $FlowFixMe\n    const abortedRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_ABORTED_STATUS]));\n    const promise = new Promise((resolve, reject) => {\n      abortedRequest.onsuccess = function (e) {\n        resolve(e.target.result.length > 0);\n      };\n      abortedRequest.onerror = function (event) {\n        logger.error(`Request error while checking for aborted jobs while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`);\n        logger.errorObject(event);\n        reject(new Error(`Request error while checking for aborted jobs while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`));\n      };\n    });\n    abortedQueueCheckPromiseMap.set(queueId, promise);\n  }\n  await new Promise((resolve, reject) => {\n    for (let i = 0; i < items.length; i += 1) {\n      const [queueId, type, args, options = {}] = items[i];\n      const delay = typeof options.delay === 'number' ? options.delay : 0;\n      const prioritize = typeof options.prioritize === 'boolean' ? options.prioritize : false;\n      const value = {\n        queueId,\n        type,\n        args,\n        attempt: 0,\n        created: Date.now(),\n        status: JOB_PENDING_STATUS,\n        startAfter: Date.now() + delay,\n        prioritize,\n      };\n      const promise = abortedQueueCheckPromiseMap.get(queueId);\n      if (!promise) {\n        reject(new Error(`Aborted queue check does not exist while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`));\n        return;\n      }\n      promise.then((hasAbortedJobs:boolean) => {\n        console.log({ hasAbortedJobs });\n        if (hasAbortedJobs) {\n          value.status = JOB_ABORTED_STATUS;\n        }\n        const request = store.put(value);\n        request.onsuccess = function () {\n          const id = request.result;\n          ids.push(request.result);\n          if (!hasAbortedJobs) {\n            localJobEmitter.emit('jobAdd', id, queueId, type);\n            jobEmitter.emit('jobAdd', id, queueId, type);\n          }\n          if (i === items.length - 1) {\n            resolve();\n          }\n        };\n        request.onerror = function (event) {\n          logger.error(`Request error while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`);\n          logger.errorObject(event);\n          reject(new Error(`Request error while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`));\n        };\n      }).catch(reject);\n    }\n  });\n  return ids;\n}\n\nexport async function importJobsAndCleanups(jobs:Array<Job>, cleanups:Array<Cleanup>) { // eslint-disable-line no-underscore-dangle\n  if (!Array.isArray(jobs)) {\n    throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"jobs\" argument type \"${typeof jobs}\"`);\n  }\n  if (!Array.isArray(cleanups)) {\n    throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"cleanups\" argument type \"${typeof cleanups}\"`);\n  }\n  for (const { args, attempt, created, id, prioritize, queueId, startAfter, status, type } of jobs) {\n    if (!Array.isArray(args)) {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"args\" argument type \"${typeof args}\", should be Array<any>`);\n    }\n    if (typeof attempt !== 'number') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"attempt\" argument type \"${typeof attempt}\", should be number`);\n    }\n    if (typeof created !== 'number') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"created\" argument type \"${typeof created}\", should be number`);\n    }\n    if (typeof id !== 'number') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"id\" argument type \"${typeof id}\", should be number`);\n    }\n    if (typeof prioritize !== 'boolean') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"prioritize\" argument type \"${typeof prioritize}\", should be boolean`);\n    }\n    if (typeof queueId !== 'string') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"queueId\" argument type \"${typeof queueId}\", should be string`);\n    }\n    if (typeof startAfter !== 'number') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"startAfter\" argument type \"${typeof startAfter}\", should be number`);\n    }\n    if (typeof status !== 'number') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"status\" argument type \"${typeof status}\", should be number`);\n    }\n    if (typeof type !== 'string') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"type\" argument type \"${typeof type}\", should be string`);\n    }\n  }\n  for (const { attempt, data, id, queueId, startAfter } of cleanups) {\n    if (typeof attempt !== 'number') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"attempt\" argument type \"${typeof attempt}\", should be number`);\n    }\n    if (typeof data !== 'object') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"data\" argument type \"${typeof data}\", should be object`);\n    }\n    if (typeof id !== 'number') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"id\" argument type \"${typeof id}\", should be number`);\n    }\n    if (typeof queueId !== 'string') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"queueId\" argument type \"${typeof queueId}\", should be string`);\n    }\n    if (typeof startAfter !== 'number') {\n      throw new TypeError(`Unable to import jobs and cleanups into database, received invalid \"startAfter\" argument type \"${typeof startAfter}\", should be number`);\n    }\n  }\n  const jobIdSet = new Set();\n  for (const { id } of jobs) {\n    jobIdSet.add(id);\n  }\n  const cleanupMap = new Map();\n  for (const cleanup of cleanups) {\n    if (jobIdSet.has(cleanup.id)) {\n      cleanupMap.set(cleanup.id, cleanup);\n    }\n  }\n  const [jobsObjectStore, cleanupsObjectStore] = await getReadWriteJobAndCleanupStores();\n  const newJobs = [];\n  await new Promise((resolve, reject) => {\n    let didCommit = false;\n    for (let i = 0; i < jobs.length; i += 1) {\n      const { args, attempt, created, id, prioritize, queueId, startAfter, status, type } = jobs[i];\n      const value:Object = {\n        args,\n        attempt,\n        created,\n        prioritize,\n        queueId,\n        startAfter,\n        status,\n        type,\n      };\n      const request = jobsObjectStore.put(value);\n      request.onsuccess = function () { // eslint-disable-line no-loop-func\n        const jobId = request.result;\n        value.id = jobId;\n        newJobs.push(value);\n        const cleanupValue = cleanupMap.get(id);\n        cleanupMap.delete(id);\n        if (typeof cleanupValue === 'object') {\n          const {\n            attempt: cleanupAttempt,\n            data: cleanupData,\n            startAfter: cleanupStartAfter,\n          } = cleanupValue;\n          const cleanupPutRequest = cleanupsObjectStore.put({\n            id: jobId,\n            queueId,\n            attempt: cleanupAttempt,\n            data: cleanupData,\n            startAfter: cleanupStartAfter,\n          });\n          cleanupPutRequest.onsuccess = function () {\n            if (i === jobs.length - 1) {\n              resolve();\n            }\n          };\n          cleanupPutRequest.onerror = function (event) {\n            logger.error(`Request error while importing ${jobs.length} ${jobs.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`);\n            logger.errorObject(event);\n            reject(new Error(`Request error while importing ${jobs.length} ${jobs.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`));\n          };\n        } else {\n          localJobEmitter.emit('jobAdd', jobId, queueId, type);\n          jobEmitter.emit('jobAdd', jobId, queueId, type);\n          if (i === jobs.length - 1) {\n            resolve();\n          }\n        }\n        if (i === jobs.length - 1 && !didCommit) {\n          didCommit = true;\n          jobsObjectStore.transaction.commit();\n        }\n      };\n      request.onerror = function (event) {\n        logger.error(`Request error while importing ${jobs.length} ${jobs.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`);\n        logger.errorObject(event);\n        reject(new Error(`Request error while importing ${jobs.length} ${jobs.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`));\n      };\n    }\n    if (cleanupMap.size === 0) {\n      didCommit = true;\n      jobsObjectStore.transaction.commit();\n    }\n  });\n  return newJobs;\n}\n\nexport async function enqueueToDatabase(queueId: string, type: string, args: Array<any>, options?:EnqueueOptions = {}) { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"queueId\" argument type \"${typeof queueId}\", should be string`);\n  }\n  if (typeof type !== 'string') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"type\" argument type \"${typeof type}\", should be string`);\n  }\n  if (!Array.isArray(args)) {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"args\" argument type \"${typeof args}\", should be Array<any>`);\n  }\n  const delay = options.delay || 0;\n  const prioritize = options.prioritize || false;\n  if (typeof delay !== 'number') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"options.delay\" argument type \"${typeof delay}\", should be number`);\n  }\n  if (typeof prioritize !== 'boolean') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"options.prioritize\" argument type \"${typeof prioritize}\", should be boolean`);\n  }\n  const value = {\n    queueId,\n    type,\n    args,\n    attempt: 0,\n    created: Date.now(),\n    status: JOB_PENDING_STATUS,\n    startAfter: Date.now() + delay,\n    prioritize,\n  };\n\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  // $FlowFixMe\n  const abortedRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_ABORTED_STATUS]));\n  return new Promise((resolve, reject) => {\n    abortedRequest.onsuccess = function (e) {\n      const hasAbortedJobs = e.target.result.length > 0;\n      if (hasAbortedJobs) {\n        value.status = JOB_ABORTED_STATUS;\n      }\n      const request = store.put(value);\n      request.onsuccess = function () {\n        const id = request.result;\n        if (!hasAbortedJobs) {\n          localJobEmitter.emit('jobAdd', id, queueId, type);\n          jobEmitter.emit('jobAdd', id, queueId, type);\n        }\n        resolve(id);\n      };\n      request.onerror = function (event) {\n        logger.error(`Request error while enqueueing ${type} job`);\n        logger.errorObject(event);\n        reject(new Error(`Request error while enqueueing ${type} job`));\n      };\n      store.transaction.commit();\n    };\n    abortedRequest.onerror = function (event) {\n      logger.error(`Request error while checking for aborted jobs in queue ${queueId} while enqueueing ${type} job`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while checking for aborted jobs in queue ${queueId} while enqueueing ${type} job`));\n    };\n  });\n}\n\nexport async function restoreJobToDatabaseForCleanupAndRemove(id:number, queueId: string, type: string, args: Array<any>, options?:EnqueueOptions = {}) { // eslint-disable-line no-underscore-dangle\n  if (typeof id !== 'number') {\n    throw new TypeError(`Unable to restore to database, received invalid \"id\" argument type \"${typeof id}\", should be number`);\n  }\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to restore to database, received invalid \"queueId\" argument type \"${typeof queueId}\", should be string`);\n  }\n  if (typeof type !== 'string') {\n    throw new TypeError(`Unable to restore to database, received invalid \"type\" argument type \"${typeof type}\", should be string`);\n  }\n  if (!Array.isArray(args)) {\n    throw new TypeError(`Unable to restore to database, received invalid \"args\" argument type \"${typeof args}\", should be Array<any>`);\n  }\n  const delay = options.delay || 0;\n  const prioritize = options.prioritize || false;\n  if (typeof delay !== 'number') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"options.delay\" argument type \"${typeof delay}\", should be number`);\n  }\n  if (typeof prioritize !== 'boolean') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"options.prioritize\" argument type \"${typeof prioritize}\", should be boolean`);\n  }\n  const value = {\n    id,\n    queueId,\n    type,\n    args,\n    attempt: 1,\n    created: Date.now(),\n    status: JOB_CLEANUP_AND_REMOVE_STATUS,\n    startAfter: Date.now() + delay,\n    prioritize,\n  };\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.put(value);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while enqueueing ${type} job`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while enqueueing ${type} job`));\n    };\n    store.transaction.commit();\n  });\n  localJobEmitter.emit('jobAdd', id, queueId, type);\n  jobEmitter.emit('jobAdd', id, queueId, type);\n  return id;\n}\n\nexport async function dequeueFromDatabase():Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.bound(JOB_CLEANUP_AND_REMOVE_STATUS, JOB_PENDING_STATUS));\n  const jobs = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error('Request error while dequeing');\n      logger.errorObject(event);\n      reject(new Error('Request error while dequeing'));\n    };\n    store.transaction.commit();\n  });\n  return jobs;\n}\n\nexport function getContiguousIds(ids:Array<number>) {\n  ids.sort((a, b) => a - b);\n  const points = [[0, ids[0] - 1]];\n  for (let i = 0; i < ids.length; i += 1) {\n    if (ids[i] + 1 !== ids[i + 1]) {\n      if (i + 1 >= ids.length) {\n        points.push([ids[i] + 1, Infinity]);\n      } else {\n        points.push([ids[i] + 1, ids[i + 1] - 1]);\n      }\n    }\n  }\n  return points;\n}\n\nexport async function dequeueFromDatabaseNotIn(ids:Array<number>):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (ids.length === 0) {\n    return dequeueFromDatabase();\n  }\n  const [store, promise] = await getReadOnlyJobsObjectStoreAndTransactionPromise();\n  const index = store.index('statusIndex');\n  const jobs = [];\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.bound(JOB_CLEANUP_AND_REMOVE_STATUS, JOB_PENDING_STATUS));\n  request.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      if (ids.includes(id)) {\n        continue;\n      }\n      const getRequest = store.get(id);\n      getRequest.onsuccess = function () {\n        jobs.push(getRequest.result);\n      };\n      getRequest.onerror = function (event2) {\n        logger.error(`Request error while getting job ${id}`);\n        logger.errorObject(event2);\n      };\n    }\n    // Do not commit the transaction here, will cause transaction promise to return before\n    // getRequest onsuccess completes\n  };\n  request.onerror = function (event) {\n    logger.error('Request error while dequeing');\n    logger.errorObject(event);\n  };\n  await promise;\n  return jobs;\n}\n\nexport async function getJobsWithTypeFromDatabase(type:string):Promise<Array<Job>> {\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('typeIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(type));\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting jobs with type ${type} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Error while getting jobs with type ${type} from jobs database`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function getCleanupsInQueueFromDatabase(queueId: string):Promise<Array<Cleanup>> { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to get cleanups in queue from database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  const store = await getReadOnlyCleanupsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(queueId));\n  const jobs = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting cleanups in queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error('Request error while getting cleanups in queue'));\n    };\n    store.transaction.commit();\n  });\n  return jobs;\n}\n\nexport async function getJobsInQueueFromDatabase(queueId: string):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to get jobs in queue from database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(queueId));\n  const jobs = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting jobs in queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error('Request error while getting jobs in queue'));\n    };\n    store.transaction.commit();\n  });\n  return jobs;\n}\n\nexport async function getJobsInDatabase(jobIds: Array<number>):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (!Array.isArray(jobIds)) {\n    throw new TypeError(`Unable to get jobs from database, received invalid \"jobIds\" argument type \"${typeof jobIds}\"`);\n  }\n  const [store, promise] = await getReadOnlyJobsObjectStoreAndTransactionPromise();\n  const jobs = [];\n  for (const jobId of jobIds) {\n    const request = store.get(jobId);\n    request.onsuccess = function () {\n      if (typeof request.result !== 'undefined') {\n        jobs.push(request.result);\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting job ${jobId}`);\n      logger.errorObject(event);\n    };\n  }\n  // Do not commit the transaction here, will cause transaction promise to return before\n  // getRequest onsuccess completes\n  await promise;\n  return jobs;\n}\n\nexport async function getCompletedJobsCountFromDatabase(queueId: string) { // eslint-disable-line no-underscore-dangle\n  const jobs = await getCompletedJobsFromDatabase(queueId);\n  return jobs.length;\n}\n\n\nexport async function getCompletedJobsFromDatabase(queueId: string):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to get completed jobs database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only([queueId, JOB_COMPLETE_STATUS]));\n  const jobs = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting completed jobs for queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting completed jobs for queue ${queueId}`));\n    };\n    store.transaction.commit();\n  });\n  return jobs;\n}\n\n\nexport async function storeAuthDataInDatabase(id:string, data: Object) { // eslint-disable-line no-underscore-dangle\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  if (typeof data !== 'object') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"data\" argument type \"${typeof data}\"`);\n  }\n  const store = await getReadWriteAuthObjectStore();\n  const request = store.put({ id, data });\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while storing auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while storing auth data for ${id}`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function getAuthDataFromDatabase(id:string) {\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  const store = await getReadOnlyAuthObjectStore();\n  const request = store.get(id);\n  const authData = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting auth data for ${id}`));\n    };\n    store.transaction.commit();\n  });\n  return typeof authData !== 'undefined' ? authData.data : undefined;\n}\n\nexport async function removeAuthDataFromDatabase(id:string) {\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  const store = await getReadWriteAuthObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing auth data for ${id}`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function getQueueStatus(queueId:string) {\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  // $FlowFixMe\n  const abortedRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_ABORTED_STATUS]));\n  // $FlowFixMe\n  const completeRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_COMPLETE_STATUS]));\n  // $FlowFixMe\n  const pendingRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_PENDING_STATUS]));\n  // $FlowFixMe\n  const errorRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_ERROR_STATUS]));\n  // $FlowFixMe\n  const cleanupRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_CLEANUP_STATUS]));\n  // $FlowFixMe\n  const cleanupAndRemoveRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_CLEANUP_AND_REMOVE_STATUS]));\n  const abortedCountPromise = new Promise((resolve, reject) => {\n    abortedRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    abortedRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const completeCountPromise = new Promise((resolve, reject) => {\n    completeRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    completeRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const pendingCountPromise = new Promise((resolve, reject) => {\n    pendingRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    pendingRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const errorCountPromise = new Promise((resolve, reject) => {\n    errorRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    errorRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const cleanupCountPromise = new Promise((resolve, reject) => {\n    cleanupRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    cleanupRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const cleanupAndRemoveCountPromise = new Promise((resolve, reject) => {\n    cleanupAndRemoveRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    cleanupAndRemoveRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  store.transaction.commit();\n  const [\n    abortedCount,\n    completeCount,\n    pendingCount,\n    errorCount,\n    cleanupCount,\n    cleanupAndRemoveCount,\n  ] = await Promise.all([\n    abortedCountPromise,\n    completeCountPromise,\n    pendingCountPromise,\n    errorCountPromise,\n    cleanupCountPromise,\n    cleanupAndRemoveCountPromise,\n  ]);\n  if (abortedCount > 0 || cleanupCount > 0) {\n    return QUEUE_ERROR_STATUS;\n  }\n  if (errorCount > 0 || pendingCount > 0 || cleanupAndRemoveCount > 0) {\n    return QUEUE_PENDING_STATUS;\n  }\n  if (completeCount > 0) {\n    return QUEUE_COMPLETE_STATUS;\n  }\n  return QUEUE_EMPTY_STATUS;\n}\n\nexport async function addArgLookup(jobId:number, key:string, jsonPath:string) {\n  if (typeof jobId !== 'number') {\n    throw new TypeError(`Unable add argument lookup, received invalid \"jobId\" argument type \"${typeof jobId}\"`);\n  }\n  if (typeof key !== 'string') {\n    throw new TypeError(`Unable add argument lookup, received invalid \"key\" argument type \"${typeof key}\"`);\n  }\n  if (typeof jsonPath !== 'string') {\n    throw new TypeError(`Unable add argument lookup, received invalid \"jsonPath\" argument type \"${typeof jsonPath}\"`);\n  }\n  const store = await getReadWriteArgLookupObjectStore();\n  const request = store.put({\n    jobId,\n    key,\n    jsonPath,\n  });\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while adding argument lookup for job ${jobId} with key \"${key}\" and JSON path \"${jsonPath}\"`);\n      logger.errorObject(event);\n      reject(new Error(`Error while adding argument lookup for job ${jobId} with key \"${key}\" and JSON path \"${jsonPath}\"`));\n    };\n    store.transaction.commit();\n  });\n}\n\nexport async function getArgLookupJobPathMap(key:string) {\n  if (typeof key !== 'string') {\n    throw new TypeError(`Unable to lookup arguments, received invalid \"key\" argument type \"${typeof key}\"`);\n  }\n  const store = await getReadOnlyArgLookupObjectStore();\n  const index = store.index('keyIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(key));\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const map: Map<number, string> = new Map(event.target.result.map((x) => [x.jobId, x.jsonPath]));\n      resolve(map);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error looking up arguments for key ${key}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error looking up arguments for key ${key}`));\n    };\n    store.transaction.commit();\n  });\n}\n\n\nexport async function markJobsWithArgLookupKeyCleanupAndRemoveInDatabase(key:string) {\n  if (typeof key !== 'string') {\n    throw new TypeError(`Unable to lookup arguments, received invalid \"key\" argument type \"${typeof key}\"`);\n  }\n  const store = await getReadOnlyArgLookupObjectStore();\n  const index = store.index('keyIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(key));\n  const jobIds = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(uniq(event.target.result.map((x) => x.jobId)));\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error looking up arguments for key ${key}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error looking up arguments for key ${key}`));\n    };\n    store.transaction.commit();\n  });\n  await Promise.all(jobIds.map(markJobCleanupAndRemoveInDatabase));\n}\n\nexport async function lookupArgs(key:string) {\n  const database = await databasePromise;\n  const transaction = database.transaction(['arg-lookup', 'jobs'], 'readonly', { durability: 'relaxed' });\n  const argLookupObjectStore = transaction.objectStore('arg-lookup');\n  transaction.onabort = (event) => {\n    logger.error('Read-only lookupArgs transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only lookupArgs transaction');\n    logger.errorObject(event);\n  };\n  const argLookupIndex = argLookupObjectStore.index('keyIndex');\n  // $FlowFixMe\n  const argLookupRequest = argLookupIndex.getAll(IDBKeyRange.only(key));\n  const results = [];\n  return new Promise((resolve, reject) => {\n    argLookupRequest.onsuccess = function (argLookupEvent) {\n      const argLookups = argLookupEvent.target.result;\n      if (argLookups.length === 0) {\n        resolve([]);\n        transaction.commit();\n        return;\n      }\n      const jobsObjectStore = transaction.objectStore('jobs');\n      for (let i = 0; i < argLookups.length; i += 1) {\n        const { jobId, jsonPath } = argLookups[i];\n        const jobRequest = jobsObjectStore.get(jobId);\n        jobRequest.onsuccess = function () {\n          if (typeof jobRequest.result === 'undefined') {\n            return;\n          }\n          const { args } = jobRequest.result;\n          for (const result of JSONPath({ path: jsonPath, json: args })) {\n            results.push(result);\n          }\n          if (i === argLookups.length - 1) {\n            resolve(results);\n          }\n        };\n        jobRequest.onerror = function (event) {\n          logger.error(`Request error while getting job ${jobId}`);\n          logger.errorObject(event);\n          reject(new Error(`Request error looking up jobs for key ${key}`));\n        };\n      }\n      transaction.commit();\n    };\n    argLookupRequest.onerror = function (event) {\n      logger.error(`Request error looking up arguments for key ${key}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error looking up arguments for key ${key}`));\n    };\n  });\n}\n\nexport async function lookupArg(key:string) {\n  const results = await lookupArgs(key);\n  return results[0];\n}\n\nconst jobsArgLookupsAndCleanupsToRemove = [];\n\nasync function removeArgLookupsAndCleanupsForJob() {\n  if (jobsArgLookupsAndCleanupsToRemove.length === 0) {\n    return;\n  }\n  const jobIds = jobsArgLookupsAndCleanupsToRemove.slice();\n  jobsArgLookupsAndCleanupsToRemove.length = 0;\n  const database = await databasePromise;\n  const transaction = database.transaction(['cleanups', 'arg-lookup'], 'readwrite', { durability: 'relaxed' });\n  transaction.onabort = (event) => {\n    logger.error('Read-write \"cleanups\", and \"arg-lookup\" transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write \"cleanups\" and \"arg-lookup\" transaction');\n    logger.errorObject(event);\n  };\n  const cleanupsObjectStore = transaction.objectStore('cleanups');\n  const argLookupObjectStore = transaction.objectStore('arg-lookup');\n  const argLookupJobIdIndex = argLookupObjectStore.index('jobIdIndex');\n  for (const jobId of jobIds) {\n    const cleanupDeleteRequest = cleanupsObjectStore.delete(jobId);\n    cleanupDeleteRequest.onerror = function (event) {\n      logger.error(`Request error while removing cleanups for job ${jobId} from database`);\n      logger.errorObject(event);\n    };\n    // $FlowFixMe\n    const argLookupJobRequest = argLookupJobIdIndex.getAllKeys(IDBKeyRange.only(jobId));\n    argLookupJobRequest.onsuccess = function (event) {\n      for (const id of event.target.result) {\n        const argLookupDeleteRequest = argLookupObjectStore.delete(id);\n        argLookupDeleteRequest.onerror = function (deleteEvent) {\n          logger.error(`Delete request error while removing argument lookups for job ${jobId} from database`);\n          logger.errorObject(deleteEvent);\n        };\n      }\n    };\n    argLookupJobRequest.onerror = function (event) {\n      logger.error(`Request error while removing argument lookups for job ${jobId} from database`);\n      logger.errorObject(event);\n    };\n  }\n}\n\nexport function removeArgLookupsAndCleanupsForJobAsMicrotask(jobId:number) {\n  jobsArgLookupsAndCleanupsToRemove.push(jobId);\n  self.queueMicrotask(removeArgLookupsAndCleanupsForJob);\n}\n\nconst UNLOAD_DATA_ID = '_UNLOAD_DATA';\n\nexport function updateUnloadDataInDatabase(transform:(Object | void) => Object | void | false):Promise<Object | void> {\n  return updateMetadataInDatabase(UNLOAD_DATA_ID, transform);\n}\n\nexport function getUnloadDataFromDatabase() {\n  return getMetadataFromDatabase(UNLOAD_DATA_ID);\n}\n\nexport function clearUnloadDataInDatabase() {\n  return clearMetadataInDatabase(UNLOAD_DATA_ID);\n}\n\n"],"file":"database.js"}