{"version":3,"sources":["../../src/database.js"],"names":["logger","JOB_ABORTED_STATUS","JOB_COMPLETE_STATUS","JOB_PENDING_STATUS","JOB_ERROR_STATUS","JOB_CLEANUP_STATUS","databasePromise","request","self","indexedDB","open","onupgradeneeded","e","store","target","result","createObjectStore","keyPath","autoIncrement","createIndex","unique","error","name","Promise","resolve","reject","onerror","Error","onsuccess","event","db","getReadWriteAuthObjectStore","database","transaction","objectStore","onabort","errorObject","getReadOnlyAuthObjectStore","getReadWriteQueueDataObjectStore","getReadOnlyQueueDataObjectStore","getReadWriteJobsObjectStore","getReadOnlyJobsObjectStore","getReadWriteCleanupsObjectStore","getReadOnlyCleanupsObjectStore","clearQueueDataDatabase","clear","clearJobsDatabase","clearCleanupsDatabase","clearDatabase","removeJobsWithQueueIdAndTypeFromDatabase","queueId","type","index","openCursor","IDBKeyRange","only","cursor","delete","primaryKey","continue","removeQueueIdFromJobsDatabase","removeQueueIdFromCleanupsDatabase","removeQueueIdFromDatabase","removeCompletedExpiredItemsFromDatabase","maxAge","bound","Date","now","queueIds","Set","add","value","getJobFromDatabase","id","get","removePathFromCleanupDataInDatabase","path","getCleanupFromDatabase","attempt","maxAttempts","startAfter","data","Object","assign","put","Array","isArray","join","updateCleanupInDatabase","combinedData","removeCleanupFromDatabase","getQueueDataFromDatabase","queueData","undefined","updateQueueDataInDatabase","markJobStatusInDatabase","status","markJobCompleteInDatabase","markJobPendingInDatabase","markJobErrorInDatabase","markJobCleanupInDatabase","markJobAbortedInDatabase","markJobStartAfterInDatabase","toLocaleString","markCleanupStartAfterInDatabase","markQueueForCleanupInDatabase","warn","updateRequest","update","event2","incrementJobAttemptInDatabase","incrementCleanupAttemptInDatabase","bulkEnqueueToDatabase","items","delay","i","args","created","length","enqueueToDatabase","dequeueFromDatabase","jobs","push","getCompletedJobsCountFromDatabase","getCompletedJobsFromDatabase","storeAuthDataInDatabase","getAuthDataFromDatabase","authData","removeAuthDataFromDatabase"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAEA;;AACA;;AACA;;;;;;;;;;;;;;;;;;;;;;AAEA,IAAMA,MAAM,GAAG,qBAAW,eAAX,CAAf;AAyBO,IAAMC,mBAAkB,GAAG,CAA3B;;AACA,IAAMC,oBAAmB,GAAG,CAA5B;;AACA,IAAMC,mBAAkB,GAAG,CAA3B;;;AACA,IAAMC,iBAAgB,GAAG,CAAC,CAA1B;;;;AACA,IAAMC,mBAAkB,GAAG,CAAC,CAA5B;;;;AAEA,IAAMC,gBAAe,GAAG,wDAAC;AAAA;AAAA;AAAA;AAAA;AAAA;AACxBC,UAAAA,OADwB,GACdC,IAAI,CAACC,SAAL,CAAeC,IAAf,CAAoB,eAApB,EAAqC,CAArC,CADc;;AAG9BH,UAAAA,OAAO,CAACI,eAAR,GAA0B,UAAUC,CAAV,EAAa;AACrC,gBAAI;AACF,kBAAMC,KAAK,GAAGD,CAAC,CAACE,MAAF,CAASC,MAAT,CAAgBC,iBAAhB,CAAkC,MAAlC,EAA0C;AAAEC,gBAAAA,OAAO,EAAE,IAAX;AAAiBC,gBAAAA,aAAa,EAAE;AAAhC,eAA1C,CAAd;AACAL,cAAAA,KAAK,CAACM,WAAN,CAAkB,aAAlB,EAAiC,QAAjC,EAA2C;AAAEC,gBAAAA,MAAM,EAAE;AAAV,eAA3C;AACAP,cAAAA,KAAK,CAACM,WAAN,CAAkB,cAAlB,EAAkC,SAAlC,EAA6C;AAAEC,gBAAAA,MAAM,EAAE;AAAV,eAA7C;AACAP,cAAAA,KAAK,CAACM,WAAN,CAAkB,kBAAlB,EAAsC,CAAC,SAAD,EAAY,MAAZ,CAAtC,EAA2D;AAAEC,gBAAAA,MAAM,EAAE;AAAV,eAA3D;AACAP,cAAAA,KAAK,CAACM,WAAN,CAAkB,oBAAlB,EAAwC,CAAC,SAAD,EAAY,QAAZ,CAAxC,EAA+D;AAAEC,gBAAAA,MAAM,EAAE;AAAV,eAA/D;AACAP,cAAAA,KAAK,CAACM,WAAN,CAAkB,oBAAlB,EAAwC,CAAC,QAAD,EAAW,SAAX,CAAxC,EAA+D;AAAEC,gBAAAA,MAAM,EAAE;AAAV,eAA/D;AACD,aAPD,CAOE,OAAOC,KAAP,EAAc;AACd,kBAAI,EAAEA,KAAK,CAACC,IAAN,KAAe,iBAAjB,CAAJ,EAAyC;AACvC,sBAAMD,KAAN;AACD;AACF;;AACD,gBAAI;AACFT,cAAAA,CAAC,CAACE,MAAF,CAASC,MAAT,CAAgBC,iBAAhB,CAAkC,YAAlC,EAAgD;AAAEC,gBAAAA,OAAO,EAAE;AAAX,eAAhD;AACD,aAFD,CAEE,OAAOI,KAAP,EAAc;AACd,kBAAI,EAAEA,KAAK,CAACC,IAAN,KAAe,iBAAjB,CAAJ,EAAyC;AACvC,sBAAMD,KAAN;AACD;AACF;;AACD,gBAAI;AACF,kBAAMR,MAAK,GAAGD,CAAC,CAACE,MAAF,CAASC,MAAT,CAAgBC,iBAAhB,CAAkC,UAAlC,EAA8C;AAAEC,gBAAAA,OAAO,EAAE;AAAX,eAA9C,CAAd;;AACAJ,cAAAA,MAAK,CAACM,WAAN,CAAkB,cAAlB,EAAkC,SAAlC,EAA6C;AAAEC,gBAAAA,MAAM,EAAE;AAAV,eAA7C;AACD,aAHD,CAGE,OAAOC,KAAP,EAAc;AACd,kBAAI,EAAEA,KAAK,CAACC,IAAN,KAAe,iBAAjB,CAAJ,EAAyC;AACvC,sBAAMD,KAAN;AACD;AACF;;AACD,gBAAI;AACFT,cAAAA,CAAC,CAACE,MAAF,CAASC,MAAT,CAAgBC,iBAAhB,CAAkC,WAAlC,EAA+C;AAAEC,gBAAAA,OAAO,EAAE;AAAX,eAA/C;AACD,aAFD,CAEE,OAAOI,KAAP,EAAc;AACd,kBAAI,EAAEA,KAAK,CAACC,IAAN,KAAe,iBAAjB,CAAJ,EAAyC;AACvC,sBAAMD,KAAN;AACD;AACF;AACF,WAnCD;;AAH8B;AAAA,iBAwCb,IAAIE,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAChDlB,YAAAA,OAAO,CAACmB,OAAR,GAAkB,YAAM;AACtBD,cAAAA,MAAM,CAAC,IAAIE,KAAJ,CAAU,yBAAV,CAAD,CAAN;AACD,aAFD;;AAGApB,YAAAA,OAAO,CAACqB,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACnCL,cAAAA,OAAO,CAACK,KAAK,CAACf,MAAN,CAAaC,MAAd,CAAP;AACD,aAFD;AAGD,WAPgB,CAxCa;;AAAA;AAwCxBe,UAAAA,EAxCwB;AAAA,2CAiDvBA,EAjDuB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAD,IAAxB;;;;SAoDQC,2B;;;;;yFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACyBzB,gBADzB;;AAAA;AACQ0B,YAAAA,QADR;AAEQC,YAAAA,WAFR,GAEsBD,QAAQ,CAACC,WAAT,CAAqB,CAAC,WAAD,CAArB,EAAoC,WAApC,CAFtB;AAGQC,YAAAA,WAHR,GAGsBD,WAAW,CAACC,WAAZ,CAAwB,WAAxB,CAHtB;;AAIED,YAAAA,WAAW,CAACE,OAAZ,GAAsB,UAACN,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,yCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AAIAI,YAAAA,WAAW,CAACP,OAAZ,GAAsB,UAACG,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,sCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AARF,8CAYSK,WAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeG,0B;;;;;wFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACyB/B,gBADzB;;AAAA;AACQ0B,YAAAA,QADR;AAEQC,YAAAA,WAFR,GAEsBD,QAAQ,CAACC,WAAT,CAAqB,CAAC,WAAD,CAArB,EAAoC,UAApC,CAFtB;AAGQC,YAAAA,WAHR,GAGsBD,WAAW,CAACC,WAAZ,CAAwB,WAAxB,CAHtB;;AAIED,YAAAA,WAAW,CAACE,OAAZ,GAAsB,UAACN,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,wCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AAIAI,YAAAA,WAAW,CAACP,OAAZ,GAAsB,UAACG,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,qCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AARF,8CAYSK,WAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeI,gC;;;;;8FAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACyBhC,gBADzB;;AAAA;AACQ0B,YAAAA,QADR;AAEQC,YAAAA,WAFR,GAEsBD,QAAQ,CAACC,WAAT,CAAqB,CAAC,YAAD,CAArB,EAAqC,WAArC,CAFtB;AAGQC,YAAAA,WAHR,GAGsBD,WAAW,CAACC,WAAZ,CAAwB,YAAxB,CAHtB;;AAIED,YAAAA,WAAW,CAACE,OAAZ,GAAsB,UAACN,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,+CAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AAIAI,YAAAA,WAAW,CAACP,OAAZ,GAAsB,UAACG,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,4CAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AARF,8CAYSK,WAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeK,+B;;;;;6FAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACyBjC,gBADzB;;AAAA;AACQ0B,YAAAA,QADR;AAEQC,YAAAA,WAFR,GAEsBD,QAAQ,CAACC,WAAT,CAAqB,CAAC,YAAD,CAArB,EAAqC,UAArC,CAFtB;AAGQC,YAAAA,WAHR,GAGsBD,WAAW,CAACC,WAAZ,CAAwB,YAAxB,CAHtB;;AAIED,YAAAA,WAAW,CAACE,OAAZ,GAAsB,UAACN,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,8CAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AAIAI,YAAAA,WAAW,CAACP,OAAZ,GAAsB,UAACG,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,2CAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AARF,8CAYSK,WAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeM,2B;;;;;yFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACyBlC,gBADzB;;AAAA;AACQ0B,YAAAA,QADR;AAEQC,YAAAA,WAFR,GAEsBD,QAAQ,CAACC,WAAT,CAAqB,CAAC,MAAD,CAArB,EAA+B,WAA/B,CAFtB;AAGQC,YAAAA,WAHR,GAGsBD,WAAW,CAACC,WAAZ,CAAwB,MAAxB,CAHtB;;AAIED,YAAAA,WAAW,CAACE,OAAZ,GAAsB,UAACN,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,yCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AAIAI,YAAAA,WAAW,CAACP,OAAZ,GAAsB,UAACG,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,sCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AARF,8CAYSK,WAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeO,0B;;;;;wFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACyBnC,gBADzB;;AAAA;AACQ0B,YAAAA,QADR;AAEQC,YAAAA,WAFR,GAEsBD,QAAQ,CAACC,WAAT,CAAqB,CAAC,MAAD,CAArB,EAA+B,UAA/B,CAFtB;AAGQC,YAAAA,WAHR,GAGsBD,WAAW,CAACC,WAAZ,CAAwB,MAAxB,CAHtB;;AAIED,YAAAA,WAAW,CAACE,OAAZ,GAAsB,UAACN,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,wCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AAIAI,YAAAA,WAAW,CAACP,OAAZ,GAAsB,UAACG,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,qCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AARF,8CAYSK,WAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeQ,+B;;;;;6FAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACyBpC,gBADzB;;AAAA;AACQ0B,YAAAA,QADR;AAEQC,YAAAA,WAFR,GAEsBD,QAAQ,CAACC,WAAT,CAAqB,CAAC,UAAD,CAArB,EAAmC,WAAnC,CAFtB;AAGQC,YAAAA,WAHR,GAGsBD,WAAW,CAACC,WAAZ,CAAwB,UAAxB,CAHtB;;AAIED,YAAAA,WAAW,CAACE,OAAZ,GAAsB,UAACN,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,6CAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AAIAI,YAAAA,WAAW,CAACP,OAAZ,GAAsB,UAACG,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,0CAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AARF,8CAYSK,WAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeS,8B;;;;;4FAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACyBrC,gBADzB;;AAAA;AACQ0B,YAAAA,QADR;AAEQC,YAAAA,WAFR,GAEsBD,QAAQ,CAACC,WAAT,CAAqB,CAAC,UAAD,CAArB,EAAmC,UAAnC,CAFtB;AAGQC,YAAAA,WAHR,GAGsBD,WAAW,CAACC,WAAZ,CAAwB,UAAxB,CAHtB;;AAIED,YAAAA,WAAW,CAACE,OAAZ,GAAsB,UAACN,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,4CAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AAIAI,YAAAA,WAAW,CAACP,OAAZ,GAAsB,UAACG,KAAD,EAAW;AAC/B7B,cAAAA,MAAM,CAACqB,KAAP,CAAa,yCAAb;AACArB,cAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACD,aAHD;;AARF,8CAYSK,WAZT;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeU,sB;;;;;oFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACsBN,gCAAgC,EADtD;;AAAA;AACQzB,YAAAA,KADR;AAEQN,YAAAA,OAFR,GAEkBM,KAAK,CAACgC,KAAN,EAFlB;AAAA;AAAA,mBAGQ,IAAItB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,CAAa,0CAAb;AACArB,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,CAAU,0CAAV,CAAD,CAAN;AACD,eAJD;AAKD,aATK,CAHR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeemB,iB;;;;;+EAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACsBN,2BAA2B,EADjD;;AAAA;AACQ3B,YAAAA,KADR;AAEQN,YAAAA,OAFR,GAEkBM,KAAK,CAACgC,KAAN,EAFlB;AAAA;AAAA,mBAGQ,IAAItB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,CAAa,oCAAb;AACArB,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,CAAU,oCAAV,CAAD,CAAN;AACD,eAJD;AAKD,aATK,CAHR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeoB,qB;;;;;mFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACsBL,+BAA+B,EADrD;;AAAA;AACQ7B,YAAAA,KADR;AAEQN,YAAAA,OAFR,GAEkBM,KAAK,CAACgC,KAAN,EAFlB;AAAA;AAAA,mBAGQ,IAAItB,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,CAAa,wCAAb;AACArB,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,CAAU,wCAAV,CAAD,CAAN;AACD,eAJD;AAKD,aATK,CAHR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAesBqB,e;;;;;2EAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACCF,iBAAiB,EADlB;;AAAA;AAAA;AAAA,mBAECC,qBAAqB,EAFtB;;AAAA;AAAA;AAAA,mBAGCH,sBAAsB,EAHvB;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAMeK,0C;;;;;sGAAf,mBAAwDC,OAAxD,EAAwEC,IAAxE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeX,2BAA2B,EAD1C;;AAAA;AACC3B,YAAAA,KADD;AAECuC,YAAAA,KAFD,GAESvC,KAAK,CAACuC,KAAN,CAAY,kBAAZ,CAFT,EAGL;;AACM7C,YAAAA,OAJD,GAIW6C,KAAK,CAACC,UAAN,CAAiBC,WAAW,CAACC,IAAZ,CAAiB,CAACL,OAAD,EAAUC,IAAV,CAAjB,CAAjB,CAJX;AAAA;AAAA,mBAKC,IAAI5B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACnC,oBAAM2B,MAAM,GAAG3B,KAAK,CAACf,MAAN,CAAaC,MAA5B;;AACA,oBAAIyC,MAAJ,EAAY;AACV3C,kBAAAA,KAAK,CAAC4C,MAAN,CAAaD,MAAM,CAACE,UAApB;AACAF,kBAAAA,MAAM,CAACG,QAAP;AACD,iBAHD,MAGO;AACLnC,kBAAAA,OAAO;AACR;AACF,eARD;;AASAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,wDAA6D6B,OAA7D,uBAAiFC,IAAjF;AACAnD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,wDAA0DuB,OAA1D,uBAA8EC,IAA9E,yBAAD,CAAN;AACD,eAJD;AAKD,aAfK,CALD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAuBQS,6B;;;;;2FAAf,mBAA6CV,OAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACsBV,2BAA2B,EADjD;;AAAA;AACQ3B,YAAAA,KADR;AAEQuC,YAAAA,KAFR,GAEgBvC,KAAK,CAACuC,KAAN,CAAY,cAAZ,CAFhB,EAGE;;AACM7C,YAAAA,OAJR,GAIkB6C,KAAK,CAACC,UAAN,CAAiBC,WAAW,CAACC,IAAZ,CAAiBL,OAAjB,CAAjB,CAJlB;AAAA;AAAA,mBAKQ,IAAI3B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACnC,oBAAM2B,MAAM,GAAG3B,KAAK,CAACf,MAAN,CAAaC,MAA5B;;AACA,oBAAIyC,MAAJ,EAAY;AACV3C,kBAAAA,KAAK,CAAC4C,MAAN,CAAaD,MAAM,CAACE,UAApB;AACAF,kBAAAA,MAAM,CAACG,QAAP;AACD,iBAHD,MAGO;AACLnC,kBAAAA,OAAO;AACR;AACF,eARD;;AASAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,8CAAmD6B,OAAnD;AACAlD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,8CAAgDuB,OAAhD,yBAAD,CAAN;AACD,eAJD;AAKD,aAfK,CALR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAuBeW,iC;;;;;+FAAf,mBAAiDX,OAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACsBR,+BAA+B,EADrD;;AAAA;AACQ7B,YAAAA,KADR;AAEQuC,YAAAA,KAFR,GAEgBvC,KAAK,CAACuC,KAAN,CAAY,cAAZ,CAFhB,EAGE;;AACM7C,YAAAA,OAJR,GAIkB6C,KAAK,CAACC,UAAN,CAAiBC,WAAW,CAACC,IAAZ,CAAiBL,OAAjB,CAAjB,CAJlB;AAAA;AAAA,mBAKQ,IAAI3B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACnC,oBAAM2B,MAAM,GAAG3B,KAAK,CAACf,MAAN,CAAaC,MAA5B;;AACA,oBAAIyC,MAAJ,EAAY;AACV3C,kBAAAA,KAAK,CAAC4C,MAAN,CAAaD,MAAM,CAACE,UAApB;AACAF,kBAAAA,MAAM,CAACG,QAAP;AACD,iBAHD,MAGO;AACLnC,kBAAAA,OAAO;AACR;AACF,eARD;;AASAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,8CAAmD6B,OAAnD;AACAlD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,8CAAgDuB,OAAhD,yBAAD,CAAN;AACD,eAJD;AAKD,aAfK,CALR;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAuBsBY,2B;;;;;uFAAf,mBAAyCZ,OAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACCU,6BAA6B,CAACV,OAAD,CAD9B;;AAAA;AAAA;AAAA,mBAECW,iCAAiC,CAACX,OAAD,CAFlC;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAKea,yC;;;;;qGAAf,mBAAuDC,MAAvD;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACexB,2BAA2B,EAD1C;;AAAA;AACC3B,YAAAA,KADD;AAECuC,YAAAA,KAFD,GAESvC,KAAK,CAACuC,KAAN,CAAY,oBAAZ,CAFT,EAGL;;AACM7C,YAAAA,OAJD,GAIW6C,KAAK,CAACC,UAAN,CAAiBC,WAAW,CAACW,KAAZ,CAAkB,CAAC/D,oBAAD,EAAsB,CAAtB,CAAlB,EAA4C,CAACA,oBAAD,EAAsBgE,IAAI,CAACC,GAAL,KAAaH,MAAnC,CAA5C,CAAjB,CAJX;AAKCI,YAAAA,QALD,GAKY,IAAIC,GAAJ,EALZ;AAAA;AAAA,mBAMC,IAAI9C,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACnC,oBAAM2B,MAAM,GAAG3B,KAAK,CAACf,MAAN,CAAaC,MAA5B;;AACA,oBAAIyC,MAAJ,EAAY;AACVY,kBAAAA,QAAQ,CAACE,GAAT,CAAad,MAAM,CAACe,KAAP,CAAarB,OAA1B;AACArC,kBAAAA,KAAK,CAAC4C,MAAN,CAAaD,MAAM,CAACE,UAApB;AACAF,kBAAAA,MAAM,CAACG,QAAP;AACD,iBAJD,MAIO;AACLnC,kBAAAA,OAAO;AACR;AACF,eATD;;AAUAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,CAAa,wEAAb;AACArB,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,CAAU,wEAAV,CAAD,CAAN;AACD,eAJD;AAKD,aAhBK,CAND;;AAAA;AAAA,mDAuBiByC,QAvBjB;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAuBMlB,YAAAA,OAvBN;AAAA;AAAA,mBAwBGY,2BAAyB,CAACZ,OAAD,CAxB5B;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAAA;;AAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SA4BesB,oB;;;;;gFAAf,mBAAkCC,EAAlC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACehC,0BAA0B,EADzC;;AAAA;AACC5B,YAAAA,KADD;AAECN,YAAAA,OAFD,GAEWM,KAAK,CAAC6D,GAAN,CAAUD,EAAV,CAFX;AAAA,+CAGE,IAAIlD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO,CAACjB,OAAO,CAACQ,MAAT,CAAP;AACD,eAFD;;AAGAR,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,uCAA4CoD,EAA5C;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,uCAAyC8C,EAAzC,EAAD,CAAN;AACD,eAJD;AAKD,aATM,CAHF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeE,qC;;;;;iGAAf,mBAAmDF,EAAnD,EAA8DG,IAA9D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeC,wBAAsB,CAACJ,EAAD,CADrC;;AAAA;AACCF,YAAAA,KADD;AAAA;AAAA,mBAEe7B,+BAA+B,EAF9C;;AAAA;AAEC7B,YAAAA,KAFD;;AAAA,kBAGD,OAAO0D,KAAP,KAAiB,WAHhB;AAAA;AAAA;AAAA;;AAAA;;AAAA;AAMGrB,YAAAA,OANH,GAMiDqB,KANjD,CAMGrB,OANH,EAMY4B,OANZ,GAMiDP,KANjD,CAMYO,OANZ,EAMqBC,WANrB,GAMiDR,KANjD,CAMqBQ,WANrB,EAMkCC,UANlC,GAMiDT,KANjD,CAMkCS,UANlC;AAOCC,YAAAA,IAPD,GAOQC,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkBZ,KAAK,CAACU,IAAxB,CAPR;AAQL,gCAAMA,IAAN,EAAYL,IAAZ;AACMrE,YAAAA,OATD,GASWM,KAAK,CAACuE,GAAN,CAAU;AACxBX,cAAAA,EAAE,EAAFA,EADwB;AAExBvB,cAAAA,OAAO,EAAPA,OAFwB;AAGxB4B,cAAAA,OAAO,EAAPA,OAHwB;AAIxBC,cAAAA,WAAW,EAAXA,WAJwB;AAKxBC,cAAAA,UAAU,EAAVA,UALwB;AAMxBC,cAAAA,IAAI,EAAJA;AANwB,aAAV,CATX;AAAA;AAAA,mBAiBC,IAAI1D,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,qCAA0CgE,KAAK,CAACC,OAAN,CAAcV,IAAd,IAAsBA,IAAI,CAACW,IAAL,CAAU,GAAV,CAAtB,GAAuCX,IAAjF,oCAA+GH,EAA/G,uBAA8HvB,OAA9H;AACAlD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,qCAAuC0D,KAAK,CAACC,OAAN,CAAcV,IAAd,IAAsBA,IAAI,CAACW,IAAL,CAAU,GAAV,CAAtB,GAAuCX,IAA9E,oCAA4GH,EAA5G,uBAA2HvB,OAA3H,EAAD,CAAN;AACD,eAJD;AAKD,aATK,CAjBD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SA6BesC,yB;;;;;qFAAf,mBAAuCf,EAAvC,EAAkDvB,OAAlD,EAAkE+B,IAAlE,EAA+EF,WAA/E;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeF,wBAAsB,CAACJ,EAAD,CADrC;;AAAA;AACCF,YAAAA,KADD;AAAA;AAAA,mBAEe7B,+BAA+B,EAF9C;;AAAA;AAEC7B,YAAAA,KAFD;AAGC4E,YAAAA,YAHD,GAGgB,OAAOlB,KAAP,KAAiB,WAAjB,GAA+BU,IAA/B,GAAsC,oBAAM,EAAN,EAAUV,KAAK,CAACU,IAAhB,EAAsBA,IAAtB,CAHtD;AAIC1E,YAAAA,OAJD,GAIWM,KAAK,CAACuE,GAAN,CAAU;AACxBX,cAAAA,EAAE,EAAFA,EADwB;AAExBvB,cAAAA,OAAO,EAAPA,OAFwB;AAGxB4B,cAAAA,OAAO,EAAE,CAHe;AAIxBE,cAAAA,UAAU,EAAEd,IAAI,CAACC,GAAL,EAJY;AAKxBY,cAAAA,WAAW,EAAXA,WALwB;AAMxBE,cAAAA,IAAI,EAAEQ;AANkB,aAAV,CAJX;AAAA,+CAYE,IAAIlE,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,iDAAsDoD,EAAtD;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,iDAAmD8C,EAAnD,EAAD,CAAN;AACD,eAJD;AAKD,aATM,CAZF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAwBeiB,2B;;;;;uFAAf,mBAAyCjB,EAAzC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACe/B,+BAA+B,EAD9C;;AAAA;AACC7B,YAAAA,KADD;AAECN,YAAAA,OAFD,GAEWM,KAAK,CAAC4C,MAAN,CAAagB,EAAb,CAFX;AAAA,+CAGE,IAAIlD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,iDAAsDoD,EAAtD;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,iDAAmD8C,EAAnD,EAAD,CAAN;AACD,eAJD;AAKD,aATM,CAHF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeI,wB;;;;;oFAAf,mBAAsCJ,EAAtC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACe9B,8BAA8B,EAD7C;;AAAA;AACC9B,YAAAA,KADD;AAECN,YAAAA,OAFD,GAEWM,KAAK,CAAC6D,GAAN,CAAUD,EAAV,CAFX;AAAA,+CAGE,IAAIlD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO,CAACjB,OAAO,CAACQ,MAAT,CAAP;AACD,eAFD;;AAGAR,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,uCAA4CoD,EAA5C;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,uCAAyC8C,EAAzC,EAAD,CAAN;AACD,eAJD;AAKD,aATM,CAHF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeekB,0B;;;;;sFAAf,mBAAwCzC,OAAxC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeX,+BAA+B,EAD9C;;AAAA;AACC1B,YAAAA,KADD;AAECN,YAAAA,OAFD,GAEWM,KAAK,CAAC6D,GAAN,CAAUxB,OAAV,CAFX;AAAA;AAAA,mBAGmB,IAAI3B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACvDlB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO,CAACjB,OAAO,CAACQ,MAAT,CAAP;AACD,eAFD;;AAGAR,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,6CAAkD6B,OAAlD;AACAlD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,6CAA+CuB,OAA/C,WAAD,CAAN;AACD,eAJD;AAKD,aATuB,CAHnB;;AAAA;AAGC0C,YAAAA,SAHD;AAAA,+CAaE,OAAOA,SAAP,KAAqB,WAArB,GAAmCA,SAAS,CAACX,IAA7C,GAAoDY,SAbtD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAgBeC,2B;;;;;uFAAf,mBAAyC5C,OAAzC,EAAyD+B,IAAzD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeU,0BAAwB,CAACzC,OAAD,CADvC;;AAAA;AACCqB,YAAAA,KADD;AAAA;AAAA,mBAEejC,gCAAgC,EAF/C;;AAAA;AAECzB,YAAAA,KAFD;AAGCN,YAAAA,OAHD,GAGWM,KAAK,CAACuE,GAAN,CAAU;AACxBlC,cAAAA,OAAO,EAAPA,OADwB;AAExB+B,cAAAA,IAAI,EAAE,oBAAM,EAAN,EAAUV,KAAV,EAAiBU,IAAjB;AAFkB,aAAV,CAHX;AAAA,+CAOE,IAAI1D,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,sCAA2C6B,OAA3C;AACAlD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,sCAAwCuB,OAAxC,WAAD,CAAN;AACD,eAJD;AAKD,aATM,CAPF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAmBe6C,yB;;;;;qFAAf,mBAAuCtB,EAAvC,EAAkDuB,MAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACexB,oBAAkB,CAACC,EAAD,CADjC;;AAAA;AACCF,YAAAA,KADD;;AAAA,kBAED,OAAOA,KAAP,KAAiB,WAFhB;AAAA;AAAA;AAAA;;AAAA,kBAGG,IAAI5C,KAAJ,8BAAgC8C,EAAhC,wBAAgDuB,MAAhD,sCAHH;;AAAA;AAKLzB,YAAAA,KAAK,CAACyB,MAAN,GAAeA,MAAf;AALK;AAAA,mBAMexD,2BAA2B,EAN1C;;AAAA;AAMC3B,YAAAA,KAND;AAOCN,YAAAA,OAPD,GAOWM,KAAK,CAACuE,GAAN,CAAUb,KAAV,CAPX;AAAA,+CAQE,IAAIhD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,2CAAgDoD,EAAhD,wBAAgEuB,MAAhE;AACAhG,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,2CAA6C8C,EAA7C,wBAA6DuB,MAA7D,EAAD,CAAN;AACD,eAJD;AAKD,aATM,CARF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;AAoBA,SAASC,0BAAT,CAAmCxB,EAAnC,EAA8C;AACnD,SAAOsB,yBAAuB,CAACtB,EAAD,EAAKvE,oBAAL,CAA9B;AACD;;AAEM,SAASgG,yBAAT,CAAkCzB,EAAlC,EAA6C;AAClD,SAAOsB,yBAAuB,CAACtB,EAAD,EAAKtE,mBAAL,CAA9B;AACD;;AAEM,SAASgG,uBAAT,CAAgC1B,EAAhC,EAA2C;AAChD,SAAOsB,yBAAuB,CAACtB,EAAD,EAAKrE,iBAAL,CAA9B;AACD;;AAEM,SAASgG,yBAAT,CAAkC3B,EAAlC,EAA6C;AAClD,SAAOsB,yBAAuB,CAACtB,EAAD,EAAKpE,mBAAL,CAA9B;AACD;;AAEM,SAASgG,yBAAT,CAAkC5B,EAAlC,EAA6C;AAClD,SAAOsB,yBAAuB,CAACtB,EAAD,EAAKxE,mBAAL,CAA9B;AACD;;SAEqBqG,6B;;;;;yFAAf,mBAA2C7B,EAA3C,EAAsDO,UAAtD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeR,oBAAkB,CAACC,EAAD,CADjC;;AAAA;AACCF,YAAAA,KADD;;AAAA,kBAED,OAAOA,KAAP,KAAiB,WAFhB;AAAA;AAAA;AAAA;;AAAA,kBAGG,IAAI5C,KAAJ,8BAAgC8C,EAAhC,kCAA0D,IAAIP,IAAJ,CAASc,UAAT,EAAqBuB,cAArB,EAA1D,sCAHH;;AAAA;AAKLhC,YAAAA,KAAK,CAACS,UAAN,GAAmBA,UAAnB;AALK;AAAA,mBAMexC,2BAA2B,EAN1C;;AAAA;AAMC3B,YAAAA,KAND;AAOCN,YAAAA,OAPD,GAOWM,KAAK,CAACuE,GAAN,CAAUb,KAAV,CAPX;AAAA,+CAQE,IAAIhD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,2CAAgDoD,EAAhD,kCAA0E,IAAIP,IAAJ,CAASc,UAAT,EAAqBuB,cAArB,EAA1E;AACAvG,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,2CAA6C8C,EAA7C,kCAAuE,IAAIP,IAAJ,CAASc,UAAT,EAAqBuB,cAArB,EAAvE,EAAD,CAAN;AACD,eAJD;AAKD,aATM,CARF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAoBeC,iC;;;;;6FAAf,mBAA+C/B,EAA/C,EAA0DO,UAA1D;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeH,wBAAsB,CAACJ,EAAD,CADrC;;AAAA;AACCF,YAAAA,KADD;;AAAA,kBAED,OAAOA,KAAP,KAAiB,WAFhB;AAAA;AAAA;AAAA;;AAAA,kBAGG,IAAI5C,KAAJ,kCAAoC8C,EAApC,kCAA8D,IAAIP,IAAJ,CAASc,UAAT,EAAqBuB,cAArB,EAA9D,0CAHH;;AAAA;AAKLhC,YAAAA,KAAK,CAACS,UAAN,GAAmBA,UAAnB;AALK;AAAA,mBAMetC,+BAA+B,EAN9C;;AAAA;AAMC7B,YAAAA,KAND;AAOCN,YAAAA,OAPD,GAOWM,KAAK,CAACuE,GAAN,CAAUb,KAAV,CAPX;AAAA,+CAQE,IAAIhD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,+CAAoDoD,EAApD,kCAA8E,IAAIP,IAAJ,CAASc,UAAT,EAAqBuB,cAArB,EAA9E;AACAvG,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,+CAAiD8C,EAAjD,kCAA2E,IAAIP,IAAJ,CAASc,UAAT,EAAqBuB,cAArB,EAA3E,EAAD,CAAN;AACD,eAJD;AAKD,aATM,CARF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAoBeE,+B;;;;;2FAAf,mBAA6CvD,OAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeV,2BAA2B,EAD1C;;AAAA;AACC3B,YAAAA,KADD;AAECuC,YAAAA,KAFD,GAESvC,KAAK,CAACuC,KAAN,CAAY,cAAZ,CAFT,EAGL;;AACM7C,YAAAA,OAJD,GAIW6C,KAAK,CAACC,UAAN,CAAiBC,WAAW,CAACC,IAAZ,CAAiBL,OAAjB,CAAjB,CAJX;AAAA;AAAA,mBAKC,IAAI3B,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACnC,oBAAM2B,MAAM,GAAG3B,KAAK,CAACf,MAAN,CAAaC,MAA5B;;AACA,oBAAIyC,MAAJ,EAAY;AACV,sBAAMe,KAAK,GAAGW,MAAM,CAACC,MAAP,CAAc,EAAd,EAAkB3B,MAAM,CAACe,KAAzB,CAAd;;AACA,0BAAQA,KAAK,CAACyB,MAAd;AACE,yBAAK5F,iBAAL;AACEmE,sBAAAA,KAAK,CAACyB,MAAN,GAAe3F,mBAAf;AACA;;AACF,yBAAKH,oBAAL;AACEqE,sBAAAA,KAAK,CAACyB,MAAN,GAAe3F,mBAAf;AACA;;AACF,yBAAKF,mBAAL;AACEoE,sBAAAA,KAAK,CAACyB,MAAN,GAAe/F,mBAAf;AACA;;AACF,yBAAKI,mBAAL;AACEmD,sBAAAA,MAAM,CAACG,QAAP;AACA;;AACF,yBAAK1D,mBAAL;AACEuD,sBAAAA,MAAM,CAACG,QAAP;AACA;;AACF;AACE3D,sBAAAA,MAAM,CAAC0G,IAAP,gCAAoCnC,KAAK,CAACyB,MAA1C;AACAxC,sBAAAA,MAAM,CAACG,QAAP;AACA;AAnBJ;;AAqBA,sBAAMgD,aAAa,GAAGnD,MAAM,CAACoD,MAAP,CAAcrC,KAAd,CAAtB;;AACAoC,kBAAAA,aAAa,CAAC/E,SAAd,GAA0B,YAAY;AACpC4B,oBAAAA,MAAM,CAACG,QAAP;AACD,mBAFD;;AAGAgD,kBAAAA,aAAa,CAACjF,OAAd,GAAwB,UAAUmF,MAAV,EAAkB;AACxC7G,oBAAAA,MAAM,CAACqB,KAAP,oDAAyD6B,OAAzD;AACAlD,oBAAAA,MAAM,CAACoC,WAAP,CAAmByE,MAAnB;AACArD,oBAAAA,MAAM,CAACG,QAAP;AACD,mBAJD;AAKD,iBAhCD,MAgCO;AACLnC,kBAAAA,OAAO;AACR;AACF,eArCD;;AAsCAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,6CAAkD6B,OAAlD;AACAlD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,6CAA+CuB,OAA/C,YAAD,CAAN;AACD,eAJD;AAKD,aA5CK,CALD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAoDe4D,+B;;;;;2FAAf,mBAA6CrC,EAA7C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeD,oBAAkB,CAACC,EAAD,CADjC;;AAAA;AACCF,YAAAA,KADD;;AAAA,kBAED,OAAOA,KAAP,KAAiB,WAFhB;AAAA;AAAA;AAAA;;AAAA,kBAGG,IAAI5C,KAAJ,gDAAkD8C,EAAlD,sCAHH;;AAAA;AAKCK,YAAAA,OALD,GAKWP,KAAK,CAACO,OAAN,GAAgB,CAL3B;AAMLP,YAAAA,KAAK,CAACO,OAAN,GAAgBA,OAAhB;AANK;AAAA,mBAOetC,2BAA2B,EAP1C;;AAAA;AAOC3B,YAAAA,KAPD;AAQCN,YAAAA,OARD,GAQWM,KAAK,CAACuE,GAAN,CAAUb,KAAV,CARX;AAAA;AAAA,mBASC,IAAIhD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,uDAA4DyD,OAA5D,sBAA+EL,EAA/E;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,uDAAyDmD,OAAzD,sBAA4EL,EAA5E,EAAD,CAAN;AACD,eAJD;AAKD,aATK,CATD;;AAAA;AAAA,+CAmBE,CAACK,OAAD,EAAUP,KAAK,CAACQ,WAAhB,CAnBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAsBegC,mC;;;;;+FAAf,mBAAiDtC,EAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeI,wBAAsB,CAACJ,EAAD,CADrC;;AAAA;AACCF,YAAAA,KADD;;AAAA,kBAED,OAAOA,KAAP,KAAiB,WAFhB;AAAA;AAAA;AAAA;;AAAA,kBAGG,IAAI5C,KAAJ,oDAAsD8C,EAAtD,0CAHH;;AAAA;AAKCK,YAAAA,OALD,GAKWP,KAAK,CAACO,OAAN,GAAgB,CAL3B;AAMLP,YAAAA,KAAK,CAACO,OAAN,GAAgBA,OAAhB;AANK;AAAA,mBAOepC,+BAA+B,EAP9C;;AAAA;AAOC7B,YAAAA,KAPD;AAQCN,YAAAA,OARD,GAQWM,KAAK,CAACuE,GAAN,CAAUb,KAAV,CARX;AAAA;AAAA,mBASC,IAAIhD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,uDAA4DyD,OAA5D,0BAAmFL,EAAnF;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,uDAAyDmD,OAAzD,0BAAgFL,EAAhF,EAAD,CAAN;AACD,eAJD;AAKD,aATK,CATD;;AAAA;AAAA,+CAmBE,CAACK,OAAD,EAAUP,KAAK,CAACQ,WAAhB,CAnBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAsBeiC,uB;;;;;mFAAf,mBAAqC9D,OAArC,EAAsD+D,KAAtD,EAAiGC,KAAjG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACe1E,2BAA2B,EAD1C;;AAAA;AACC3B,YAAAA,KADD;AAAA;AAAA,mBAEC,IAAIU,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAAA,yCAC5B0F,CAD4B;AAEnC,8CAAkCF,KAAK,CAACE,CAAD,CAAvC;AAAA,oBAAOhE,IAAP;AAAA,oBAAaiE,IAAb;AAAA,oBAAmBrC,WAAnB;;AACA,oBAAMR,KAAK,GAAG;AACZrB,kBAAAA,OAAO,EAAPA,OADY;AAEZC,kBAAAA,IAAI,EAAJA,IAFY;AAGZiE,kBAAAA,IAAI,EAAJA,IAHY;AAIZtC,kBAAAA,OAAO,EAAE,CAJG;AAKZC,kBAAAA,WAAW,EAAXA,WALY;AAMZsC,kBAAAA,OAAO,EAAEnD,IAAI,CAACC,GAAL,EANG;AAOZ6B,kBAAAA,MAAM,EAAE7F,mBAPI;AAQZ6E,kBAAAA,UAAU,EAAEd,IAAI,CAACC,GAAL,KAAa+C;AARb,iBAAd;AAUA,oBAAM3G,OAAO,GAAGM,KAAK,CAACuE,GAAN,CAAUb,KAAV,CAAhB;;AACA,oBAAI4C,CAAC,KAAKF,KAAK,CAACK,MAAN,GAAe,CAAzB,EAA4B;AAC1B/G,kBAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,oBAAAA,OAAO,CAACjB,OAAO,CAACQ,MAAT,CAAP;AACD,mBAFD;;AAGAR,kBAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,oBAAAA,MAAM,CAACqB,KAAP,+CAAoD4F,KAAK,CAACK,MAA1D,cAAoEL,KAAK,CAACK,MAAN,KAAiB,CAAjB,GAAqB,KAArB,GAA6B,MAAjG,uBAAoHpE,OAApH;AACAlD,oBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,oBAAAA,MAAM,CAAC,IAAIE,KAAJ,+CAAiDsF,KAAK,CAACK,MAAvD,cAAiEL,KAAK,CAACK,MAAN,KAAiB,CAAjB,GAAqB,KAArB,GAA6B,MAA9F,uBAAiHpE,OAAjH,EAAD,CAAN;AACD,mBAJD;AAKD;AAvBkC;;AACrC,mBAAK,IAAIiE,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAGF,KAAK,CAACK,MAA1B,EAAkCH,CAAC,IAAI,CAAvC,EAA0C;AAAA,sBAAjCA,CAAiC;AAuBzC;AACF,aAzBK,CAFD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SA8BeI,mB;;;;;+EAAf,mBAAiCrE,OAAjC,EAAkDC,IAAlD,EAAgEiE,IAAhE,EAAkFrC,WAAlF,EAAuGmC,KAAvG;AAAA;AAAA;AAAA;AAAA;AAAA;AAAwH;AACvH3C,YAAAA,KADD,GACS;AACZrB,cAAAA,OAAO,EAAPA,OADY;AAEZC,cAAAA,IAAI,EAAJA,IAFY;AAGZiE,cAAAA,IAAI,EAAJA,IAHY;AAIZtC,cAAAA,OAAO,EAAE,CAJG;AAKZC,cAAAA,WAAW,EAAXA,WALY;AAMZsC,cAAAA,OAAO,EAAEnD,IAAI,CAACC,GAAL,EANG;AAOZ6B,cAAAA,MAAM,EAAE7F,mBAPI;AAQZ6E,cAAAA,UAAU,EAAEd,IAAI,CAACC,GAAL,KAAa+C;AARb,aADT;AAAA;AAAA,mBAWe1E,2BAA2B,EAX1C;;AAAA;AAWC3B,YAAAA,KAXD;AAYCN,YAAAA,OAZD,GAYWM,KAAK,CAACuE,GAAN,CAAUb,KAAV,CAZX;AAAA;AAAA,mBAaY,IAAIhD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AAChDlB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO,CAACjB,OAAO,CAACQ,MAAT,CAAP;AACD,eAFD;;AAGAR,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,0CAA+C8B,IAA/C;AACAnD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,0CAA4CwB,IAA5C,UAAD,CAAN;AACD,eAJD;AAKD,aATgB,CAbZ;;AAAA;AAaCsB,YAAAA,EAbD;AAAA,+CAuBEA,EAvBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SA0Be+C,qB;;;;;iFAAf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACe/E,0BAA0B,EADzC;;AAAA;AACC5B,YAAAA,KADD;AAECuC,YAAAA,KAFD,GAESvC,KAAK,CAACuC,KAAN,CAAY,aAAZ,CAFT,EAGL;;AACM7C,YAAAA,OAJD,GAIW6C,KAAK,CAACC,UAAN,CAAiBC,WAAW,CAACW,KAAZ,CAAkB5D,mBAAlB,EAAsCF,mBAAtC,CAAjB,CAJX;AAKCsH,YAAAA,IALD,GAKQ,EALR;AAAA;AAAA,mBAMC,IAAIlG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACnC,oBAAM2B,MAAM,GAAG3B,KAAK,CAACf,MAAN,CAAaC,MAA5B;;AACA,oBAAIyC,MAAJ,EAAY;AACViE,kBAAAA,IAAI,CAACC,IAAL,CAAUlE,MAAM,CAACe,KAAjB;AACAf,kBAAAA,MAAM,CAACG,QAAP;AACD,iBAHD,MAGO;AACLnC,kBAAAA,OAAO;AACR;AACF,eARD;;AASAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,CAAa,8BAAb;AACArB,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,CAAU,8BAAV,CAAD,CAAN;AACD,eAJD;AAKD,aAfK,CAND;;AAAA;AAAA,+CAsBE8F,IAtBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAyBeE,mC;;;;;+FAAf,mBAAiDzE,OAAjD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACc0E,8BAA4B,CAAC1E,OAAD,CAD1C;;AAAA;AACCuE,YAAAA,IADD;AAAA,+CAEEA,IAAI,CAACH,MAFP;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAKeM,8B;;;;;0FAAf,mBAA4C1E,OAA5C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACeT,0BAA0B,EADzC;;AAAA;AACC5B,YAAAA,KADD;AAECuC,YAAAA,KAFD,GAESvC,KAAK,CAACuC,KAAN,CAAY,oBAAZ,CAFT,EAGL;;AACM7C,YAAAA,OAJD,GAIW6C,KAAK,CAACC,UAAN,CAAiBC,WAAW,CAACC,IAAZ,CAAiB,CAACL,OAAD,EAAUhD,oBAAV,CAAjB,CAAjB,CAJX;AAKCuH,YAAAA,IALD,GAKQ,EALR;AAAA;AAAA,mBAMC,IAAIlG,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,UAAUC,KAAV,EAAiB;AACnC,oBAAM2B,MAAM,GAAG3B,KAAK,CAACf,MAAN,CAAaC,MAA5B;;AACA,oBAAIyC,MAAJ,EAAY;AACViE,kBAAAA,IAAI,CAACC,IAAL,CAAUlE,MAAM,CAACe,KAAjB;AACAf,kBAAAA,MAAM,CAACG,QAAP;AACD,iBAHD,MAGO;AACLnC,kBAAAA,OAAO;AACR;AACF,eARD;;AASAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,gEAAqE6B,OAArE;AACAlD,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,gEAAkEuB,OAAlE,EAAD,CAAN;AACD,eAJD;AAKD,aAfK,CAND;;AAAA;AAAA,+CAsBEuE,IAtBF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAyBeI,yB;;;;;qFAAf,mBAAuCpD,EAAvC,EAAkDQ,IAAlD;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACelD,2BAA2B,EAD1C;;AAAA;AACClB,YAAAA,KADD;AAECN,YAAAA,OAFD,GAEWM,KAAK,CAACuE,GAAN,CAAU;AAAEX,cAAAA,EAAE,EAAFA,EAAF;AAAMQ,cAAAA,IAAI,EAAJA;AAAN,aAAV,CAFX;AAAA;AAAA,mBAGC,IAAI1D,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACrClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,qDAA0DoD,EAA1D;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,qDAAuD8C,EAAvD,EAAD,CAAN;AACD,eAJD;AAKD,aATK,CAHD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAeeqD,yB;;;;;qFAAf,mBAAuCrD,EAAvC;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACepC,0BAA0B,EADzC;;AAAA;AACCxB,YAAAA,KADD;AAECN,YAAAA,OAFD,GAEWM,KAAK,CAAC6D,GAAN,CAAUD,EAAV,CAFX;AAAA;AAAA,mBAGkB,IAAIlD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtDlB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO,CAACjB,OAAO,CAACQ,MAAT,CAAP;AACD,eAFD;;AAGAR,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,qDAA0DoD,EAA1D;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,qDAAuD8C,EAAvD,EAAD,CAAN;AACD,eAJD;AAKD,aATsB,CAHlB;;AAAA;AAGCsD,YAAAA,QAHD;AAAA,+CAaE,OAAOA,QAAP,KAAoB,WAApB,GAAkCA,QAAQ,CAAC9C,IAA3C,GAAkDY,SAbpD;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G;;;;SAgBemC,4B;;;;;wFAAf,mBAA0CvD,EAA1C;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,mBACe1C,2BAA2B,EAD1C;;AAAA;AACClB,YAAAA,KADD;AAECN,YAAAA,OAFD,GAEWM,KAAK,CAAC4C,MAAN,CAAagB,EAAb,CAFX;AAAA,+CAGE,IAAIlD,OAAJ,CAAY,UAACC,OAAD,EAAUC,MAAV,EAAqB;AACtClB,cAAAA,OAAO,CAACqB,SAAR,GAAoB,YAAY;AAC9BJ,gBAAAA,OAAO;AACR,eAFD;;AAGAjB,cAAAA,OAAO,CAACmB,OAAR,GAAkB,UAAUG,KAAV,EAAiB;AACjC7B,gBAAAA,MAAM,CAACqB,KAAP,8CAAmDoD,EAAnD;AACAzE,gBAAAA,MAAM,CAACoC,WAAP,CAAmBP,KAAnB;AACAJ,gBAAAA,MAAM,CAAC,IAAIE,KAAJ,8CAAgD8C,EAAhD,EAAD,CAAN;AACD,eAJD;AAKD,aATM,CAHF;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,G","sourcesContent":["// @flow\n\nimport merge from 'lodash/merge';\nimport unset from 'lodash/unset';\nimport makeLogger from './logger';\n\nconst logger = makeLogger('Jobs Database');\n\ntype Job = {\n  id: number,\n  queueId:string,\n  type:string,\n  args:Array<any>,\n  attempt: number,\n  maxAttempts: number,\n  created: number,\n  status: number,\n  startAfter: number\n};\n\n\ntype Cleanup = {\n  id: number,\n  queueId:string,\n  data: Object,\n  attempt: number,\n  maxAttempts: number,\n  startAfter: number\n};\n\n\nexport const JOB_ABORTED_STATUS = 2;\nexport const JOB_COMPLETE_STATUS = 1;\nexport const JOB_PENDING_STATUS = 0;\nexport const JOB_ERROR_STATUS = -1;\nexport const JOB_CLEANUP_STATUS = -2;\n\nexport const databasePromise = (async () => {\n  const request = self.indexedDB.open('battery-queue', 2);\n\n  request.onupgradeneeded = function (e) {\n    try {\n      const store = e.target.result.createObjectStore('jobs', { keyPath: 'id', autoIncrement: true });\n      store.createIndex('statusIndex', 'status', { unique: false });\n      store.createIndex('queueIdIndex', 'queueId', { unique: false });\n      store.createIndex('queueIdTypeIndex', ['queueId', 'type'], { unique: false });\n      store.createIndex('statusQueueIdIndex', ['queueId', 'status'], { unique: false });\n      store.createIndex('statusCreatedIndex', ['status', 'created'], { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      e.target.result.createObjectStore('queue-data', { keyPath: 'queueId' });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      const store = e.target.result.createObjectStore('cleanups', { keyPath: 'id' });\n      store.createIndex('queueIdIndex', 'queueId', { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      e.target.result.createObjectStore('auth-data', { keyPath: 'id' });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n  };\n\n  const db = await new Promise((resolve, reject) => {\n    request.onerror = () => {\n      reject(new Error('Unable to open database'));\n    };\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n  });\n\n  return db;\n})();\n\nasync function getReadWriteAuthObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['auth-data'], 'readwrite');\n  const objectStore = transaction.objectStore('auth-data');\n  transaction.onabort = (event) => {\n    logger.error('Read-write auth transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write auth transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyAuthObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['auth-data'], 'readonly');\n  const objectStore = transaction.objectStore('auth-data');\n  transaction.onabort = (event) => {\n    logger.error('Read-only auth transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only auth transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadWriteQueueDataObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['queue-data'], 'readwrite');\n  const objectStore = transaction.objectStore('queue-data');\n  transaction.onabort = (event) => {\n    logger.error('Read-write queue data transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write queue data transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyQueueDataObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['queue-data'], 'readonly');\n  const objectStore = transaction.objectStore('queue-data');\n  transaction.onabort = (event) => {\n    logger.error('Read-only queue data transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only queue data transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadWriteJobsObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['jobs'], 'readwrite');\n  const objectStore = transaction.objectStore('jobs');\n  transaction.onabort = (event) => {\n    logger.error('Read-write jobs transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write jobs transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyJobsObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['jobs'], 'readonly');\n  const objectStore = transaction.objectStore('jobs');\n  transaction.onabort = (event) => {\n    logger.error('Read-only jobs transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only jobs transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadWriteCleanupsObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['cleanups'], 'readwrite');\n  const objectStore = transaction.objectStore('cleanups');\n  transaction.onabort = (event) => {\n    logger.error('Read-write cleanups transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-write cleanups transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyCleanupsObjectStore() {\n  const database = await databasePromise;\n  const transaction = database.transaction(['cleanups'], 'readonly');\n  const objectStore = transaction.objectStore('cleanups');\n  transaction.onabort = (event) => {\n    logger.error('Read-only cleanups transaction was aborted');\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error('Error in read-only cleanups transaction');\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function clearQueueDataDatabase() {\n  const store = await getReadWriteQueueDataObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing queue data database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing queue data database'));\n    };\n  });\n}\n\nasync function clearJobsDatabase() {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing jobs database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing jobs database'));\n    };\n  });\n}\n\nasync function clearCleanupsDatabase() {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing cleanups database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing cleanups database'));\n    };\n  });\n}\n\nexport async function clearDatabase() {\n  await clearJobsDatabase();\n  await clearCleanupsDatabase();\n  await clearQueueDataDatabase();\n}\n\nexport async function removeJobsWithQueueIdAndTypeFromDatabase(queueId:string, type:string) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdTypeIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only([queueId, type]));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        store.delete(cursor.primaryKey);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing jobs with queue ${queueId} and type ${type} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while removing jobs with queue ${queueId} and type ${type} from jobs database`));\n    };\n  });\n}\n\nasync function removeQueueIdFromJobsDatabase(queueId:string) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        store.delete(cursor.primaryKey);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing queue ${queueId} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while removing queue ${queueId} from jobs database`));\n    };\n  });\n}\n\nasync function removeQueueIdFromCleanupsDatabase(queueId:string) {\n  const store = await getReadWriteCleanupsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        store.delete(cursor.primaryKey);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing queue ${queueId} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while removing queue ${queueId} from jobs database`));\n    };\n  });\n}\n\nexport async function removeQueueIdFromDatabase(queueId:string) {\n  await removeQueueIdFromJobsDatabase(queueId);\n  await removeQueueIdFromCleanupsDatabase(queueId);\n}\n\nexport async function removeCompletedExpiredItemsFromDatabase(maxAge:number) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('statusCreatedIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.bound([JOB_COMPLETE_STATUS, 0], [JOB_COMPLETE_STATUS, Date.now() - maxAge]));\n  const queueIds = new Set();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        queueIds.add(cursor.value.queueId);\n        store.delete(cursor.primaryKey);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error('Request error while removing completed exired items from jobs database');\n      logger.errorObject(event);\n      reject(new Error('Request error while removing completed exired items from jobs database'));\n    };\n  });\n  for (const queueId of queueIds) {\n    await removeQueueIdFromDatabase(queueId);\n  }\n}\n\nexport async function getJobFromDatabase(id:number):Promise<Job | void> {\n  const store = await getReadOnlyJobsObjectStore();\n  const request = store.get(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id}`));\n    };\n  });\n}\n\nexport async function removePathFromCleanupDataInDatabase(id:number, path:Array<string>) {\n  const value = await getCleanupFromDatabase(id);\n  const store = await getReadWriteCleanupsObjectStore();\n  if (typeof value === 'undefined') {\n    return;\n  }\n  const { queueId, attempt, maxAttempts, startAfter } = value;\n  const data = Object.assign({}, value.data);\n  unset(data, path);\n  const request = store.put({\n    id,\n    queueId,\n    attempt,\n    maxAttempts,\n    startAfter,\n    data,\n  });\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing path ${Array.isArray(path) ? path.join('.') : path} from cleanup data for ${id} in queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing path ${Array.isArray(path) ? path.join('.') : path} from cleanup data for ${id} in queue ${queueId}`));\n    };\n  });\n}\n\nexport async function updateCleanupInDatabase(id:number, queueId:string, data:Object, maxAttempts: number) {\n  const value = await getCleanupFromDatabase(id);\n  const store = await getReadWriteCleanupsObjectStore();\n  const combinedData = typeof value === 'undefined' ? data : merge({}, value.data, data);\n  const request = store.put({\n    id,\n    queueId,\n    attempt: 0,\n    startAfter: Date.now(),\n    maxAttempts,\n    data: combinedData,\n  });\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while updating cleanup data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while updating cleanup data for ${id}`));\n    };\n  });\n}\n\nexport async function removeCleanupFromDatabase(id:number) {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing cleanup data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing cleanup data for ${id}`));\n    };\n  });\n}\n\nexport async function getCleanupFromDatabase(id:number):Promise<Cleanup | void> {\n  const store = await getReadOnlyCleanupsObjectStore();\n  const request = store.get(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id}`));\n    };\n  });\n}\n\nexport async function getQueueDataFromDatabase(queueId:string) {\n  const store = await getReadOnlyQueueDataObjectStore();\n  const request = store.get(queueId);\n  const queueData = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting queue ${queueId} data`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting queue ${queueId} data`));\n    };\n  });\n  return typeof queueData !== 'undefined' ? queueData.data : undefined;\n}\n\nexport async function updateQueueDataInDatabase(queueId:string, data:Object) {\n  const value = await getQueueDataFromDatabase(queueId);\n  const store = await getReadWriteQueueDataObjectStore();\n  const request = store.put({\n    queueId,\n    data: merge({}, value, data),\n  });\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while updating queue ${queueId} data`);\n      logger.errorObject(event);\n      reject(new Error(`Error while updating queue ${queueId} data`));\n    };\n  });\n}\n\nexport async function markJobStatusInDatabase(id:number, status:number) {\n  const value = await getJobFromDatabase(id);\n  if (typeof value === 'undefined') {\n    throw new Error(`Unable to mark job ${id} as status ${status} in database, job does not exist`);\n  }\n  value.status = status;\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.put(value);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking job ${id} as status ${status}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking job ${id} as status ${status}`));\n    };\n  });\n}\n\nexport function markJobCompleteInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_COMPLETE_STATUS);\n}\n\nexport function markJobPendingInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_PENDING_STATUS);\n}\n\nexport function markJobErrorInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_ERROR_STATUS);\n}\n\nexport function markJobCleanupInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_CLEANUP_STATUS);\n}\n\nexport function markJobAbortedInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_ABORTED_STATUS);\n}\n\nexport async function markJobStartAfterInDatabase(id:number, startAfter:number) {\n  const value = await getJobFromDatabase(id);\n  if (typeof value === 'undefined') {\n    throw new Error(`Unable to mark job ${id} start-after time to ${new Date(startAfter).toLocaleString()} in database, job does not exist`);\n  }\n  value.startAfter = startAfter;\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.put(value);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking job ${id} start-after time to ${new Date(startAfter).toLocaleString()}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking job ${id} start-after time to ${new Date(startAfter).toLocaleString()}`));\n    };\n  });\n}\n\nexport async function markCleanupStartAfterInDatabase(id:number, startAfter:number) {\n  const value = await getCleanupFromDatabase(id);\n  if (typeof value === 'undefined') {\n    throw new Error(`Unable to mark cleanup ${id} start-after time to ${new Date(startAfter).toLocaleString()} in database, cleanup does not exist`);\n  }\n  value.startAfter = startAfter;\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.put(value);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking cleanup ${id} start-after time to ${new Date(startAfter).toLocaleString()}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking cleanup ${id} start-after time to ${new Date(startAfter).toLocaleString()}`));\n    };\n  });\n}\n\nexport async function markQueueForCleanupInDatabase(queueId:string) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        const value = Object.assign({}, cursor.value);\n        switch (value.status) {\n          case JOB_ERROR_STATUS:\n            value.status = JOB_CLEANUP_STATUS;\n            break;\n          case JOB_COMPLETE_STATUS:\n            value.status = JOB_CLEANUP_STATUS;\n            break;\n          case JOB_PENDING_STATUS:\n            value.status = JOB_ABORTED_STATUS;\n            break;\n          case JOB_CLEANUP_STATUS:\n            cursor.continue();\n            return;\n          case JOB_ABORTED_STATUS:\n            cursor.continue();\n            return;\n          default:\n            logger.warn(`Unhandled job status ${value.status}`);\n            cursor.continue();\n            return;\n        }\n        const updateRequest = cursor.update(value);\n        updateRequest.onsuccess = function () {\n          cursor.continue();\n        };\n        updateRequest.onerror = function (event2) {\n          logger.error(`Update request error while marking queue ${queueId} error`);\n          logger.errorObject(event2);\n          cursor.continue();\n        };\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking queue ${queueId} error`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking queue ${queueId} error`));\n    };\n  });\n}\n\nexport async function incrementJobAttemptInDatabase(id:number) {\n  const value = await getJobFromDatabase(id);\n  if (typeof value === 'undefined') {\n    throw new Error(`Unable to increment attempts for job ${id} in database, job does not exist`);\n  }\n  const attempt = value.attempt + 1;\n  value.attempt = attempt;\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.put(value);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while incrementing attempt to ${attempt} for job ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while incrementing attempt to ${attempt} for job ${id}`));\n    };\n  });\n  return [attempt, value.maxAttempts];\n}\n\nexport async function incrementCleanupAttemptInDatabase(id:number) {\n  const value = await getCleanupFromDatabase(id);\n  if (typeof value === 'undefined') {\n    throw new Error(`Unable to increment attempts for cleanup ${id} in database, cleanup does not exist`);\n  }\n  const attempt = value.attempt + 1;\n  value.attempt = attempt;\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.put(value);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while incrementing attempt to ${attempt} for cleanup ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while incrementing attempt to ${attempt} for cleanup ${id}`));\n    };\n  });\n  return [attempt, value.maxAttempts];\n}\n\nexport async function bulkEnqueueToDatabase(queueId: string, items:Array<[string, Array<any>, number]>, delay: number) { // eslint-disable-line no-underscore-dangle\n  const store = await getReadWriteJobsObjectStore();\n  await new Promise((resolve, reject) => {\n    for (let i = 0; i < items.length; i += 1) {\n      const [type, args, maxAttempts] = items[i];\n      const value = {\n        queueId,\n        type,\n        args,\n        attempt: 0,\n        maxAttempts,\n        created: Date.now(),\n        status: JOB_PENDING_STATUS,\n        startAfter: Date.now() + delay,\n      };\n      const request = store.put(value);\n      if (i === items.length - 1) {\n        request.onsuccess = function () {\n          resolve(request.result);\n        };\n        request.onerror = function (event) {\n          logger.error(`Request error while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`);\n          logger.errorObject(event);\n          reject(new Error(`Request error while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`));\n        };\n      }\n    }\n  });\n}\n\nexport async function enqueueToDatabase(queueId: string, type: string, args: Array<any>, maxAttempts: number, delay: number) { // eslint-disable-line no-underscore-dangle\n  const value = {\n    queueId,\n    type,\n    args,\n    attempt: 0,\n    maxAttempts,\n    created: Date.now(),\n    status: JOB_PENDING_STATUS,\n    startAfter: Date.now() + delay,\n  };\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.put(value);\n  const id = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while enqueueing ${type} job`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while enqueueing ${type} job`));\n    };\n  });\n  return id;\n}\n\nexport async function dequeueFromDatabase():Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.bound(JOB_CLEANUP_STATUS, JOB_PENDING_STATUS));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        jobs.push(cursor.value);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error('Request error while dequeing');\n      logger.errorObject(event);\n      reject(new Error('Request error while dequeing'));\n    };\n  });\n  return jobs;\n}\n\nexport async function getCompletedJobsCountFromDatabase(queueId: string) { // eslint-disable-line no-underscore-dangle\n  const jobs = await getCompletedJobsFromDatabase(queueId);\n  return jobs.length;\n}\n\nexport async function getCompletedJobsFromDatabase(queueId: string):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only([queueId, JOB_COMPLETE_STATUS]));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        jobs.push(cursor.value);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting completed jobs for queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting completed jobs for queue ${queueId}`));\n    };\n  });\n  return jobs;\n}\n\nexport async function storeAuthDataInDatabase(id:string, data: Object) { // eslint-disable-line no-underscore-dangle\n  const store = await getReadWriteAuthObjectStore();\n  const request = store.put({ id, data });\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while storing auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while storing auth data for ${id}`));\n    };\n  });\n}\n\nexport async function getAuthDataFromDatabase(id:string) {\n  const store = await getReadOnlyAuthObjectStore();\n  const request = store.get(id);\n  const authData = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting auth data for ${id}`));\n    };\n  });\n  return typeof authData !== 'undefined' ? authData.data : undefined;\n}\n\nexport async function removeAuthDataFromDatabase(id:string) {\n  const store = await getReadWriteAuthObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing auth data for ${id}`));\n    };\n  });\n}\n"],"file":"database.js"}