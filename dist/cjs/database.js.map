{"version":3,"sources":["../../src/database.js"],"names":["localJobEmitter","EventEmitter","jobEmitter","logger","JobDoesNotExistError","message","name","Error","CleanupDoesNotExistError","QUEUE_ERROR_STATUS","QUEUE_PENDING_STATUS","QUEUE_COMPLETE_STATUS","QUEUE_EMPTY_STATUS","JOB_ABORTED_STATUS","JOB_COMPLETE_STATUS","JOB_PENDING_STATUS","JOB_ERROR_STATUS","JOB_CLEANUP_STATUS","JOB_CLEANUP_AND_REMOVE_STATUS","databasePromise","request","self","indexedDB","open","onupgradeneeded","e","store","target","result","createObjectStore","keyPath","autoIncrement","createIndex","unique","error","Promise","resolve","reject","onerror","onsuccess","event","db","getReadWriteObjectStore","database","transaction","durability","objectStore","onabort","errorObject","getReadOnlyObjectStore","getReadWriteArgLookupObjectStore","getReadOnlyArgLookupObjectStore","getReadWriteAuthObjectStore","getReadOnlyAuthObjectStore","getReadWriteMetadataObjectStore","getReadOnlyMetadataObjectStore","getReadWriteJobsObjectStore","getReadOnlyJobsObjectStore","getReadWriteCleanupsObjectStore","getReadOnlyCleanupsObjectStore","getReadWriteObjectStoreAndTransactionPromise","promise","oncomplete","getReadOnlyObjectStoreAndTransactionPromise","getReadWriteJobsObjectStoreAndTransactionPromise","getReadOnlyJobsObjectStoreAndTransactionPromise","getReadWriteArgLookupObjectStoreAndTransactionPromise","getReadWriteMetadataObjectStoreAndTransactionPromise","removeJobFromObjectStore","id","queueId","deleteRequest","delete","emit","removeArgLookupsForJobAsMicrotask","clearAllMetadataInDatabase","clear","clearJobsDatabase","clearCleanupsDatabase","clearDatabase","getJobsWithQueueIdAndTypeFromDatabase","type","index","getAllKeys","IDBKeyRange","only","removeJobsWithQueueIdAndTypeFromDatabase","removeQueueIdFromJobsDatabase","removeQueueIdFromCleanupsDatabase","openCursor","cursor","primaryKey","continue","removeQueueIdFromDatabase","removeCompletedExpiredItemsFromDatabase","maxAge","getAll","bound","Date","now","status","updateJobInDatabase","transform","get","newValue","value","putRequest","put","getJobFromDatabase","updateCleanupInDatabase","removePathFromCleanupDataInDatabase","path","attempt","startAfter","data","Object","assign","updateCleanupValuesInDatabase","TypeError","combinedData","silentlyRemoveJobFromDatabase","removeJobFromDatabase","job","removeCleanupFromDatabase","getCleanupFromDatabase","getMetadataFromDatabase","response","metadata","undefined","clearMetadataInDatabase","setMetadataInDatabase","updateMetadataInDatabase","markJobStatusInDatabase","markJobCompleteInDatabase","markJobPendingInDatabase","markJobErrorInDatabase","markJobCleanupInDatabase","markJobAbortedInDatabase","markJobCompleteThenRemoveFromDatabase","markJobCleanupAndRemoveInDatabase","markJobAsAbortedOrRemoveFromDatabase","markJobStartAfterInDatabase","toLocaleString","markCleanupStartAfterInDatabase","markQueueForCleanupInDatabase","jobs","push","warn","updateRequest","update","event2","markQueueJobsGreaterThanIdCleanupAndRemoveInDatabase","jobId","shouldRemove","markQueueForCleanupAndRemoveInDatabase","getGreatestJobIdFromQueueInDatabase","incrementJobAttemptInDatabase","incrementCleanupAttemptInDatabase","bulkEnqueueToDatabase","items","delay","Array","isArray","i","length","args","ids","created","enqueueToDatabase","restoreJobToDatabaseForCleanupAndRemove","dequeueFromDatabase","getContiguousIds","sort","a","b","points","Infinity","dequeueFromDatabaseNotIn","includes","getRequest","getJobsInQueueFromDatabase","getJobsInDatabase","jobIds","getCompletedJobsCountFromDatabase","getCompletedJobsFromDatabase","storeAuthDataInDatabase","getAuthDataFromDatabase","authData","removeAuthDataFromDatabase","getQueueStatus","abortedRequest","completeRequest","pendingRequest","errorRequest","cleanupRequest","cleanupAndRemoveRequest","abortedCountPromise","completeCountPromise","pendingCountPromise","errorCountPromise","cleanupCountPromise","cleanupAndRemoveCountPromise","all","abortedCount","completeCount","pendingCount","errorCount","cleanupCount","cleanupAndRemoveCount","addArgLookup","key","jsonPath","getArgLookupJobPathMap","map","Map","x","markJobsWithArgLookupKeyCleanupAndRemoveInDatabase","keys","lookupArgs","size","results","json","lookupArg","queueMicrotask","removeArgLookupsForJob","catch","errorStack","deleteEvent","UNLOAD_DATA_ID","updateUnloadDataInDatabase","getUnloadDataFromDatabase","clearUnloadDataInDatabase"],"mappings":"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","sourcesContent":["// @flow\n\nimport { JSONPath } from 'jsonpath-plus';\nimport merge from 'lodash/merge';\nimport unset from 'lodash/unset';\nimport EventEmitter from 'events';\nimport makeLogger from './logger';\n\n// Local job emitter is for this process only,\n// jobEmitter is bridged when a MessagePort is open\nexport const localJobEmitter = new EventEmitter();\nexport const jobEmitter = new EventEmitter();\n\nconst logger = makeLogger('Jobs Database');\n\nexport class JobDoesNotExistError extends Error {\n  constructor(message:string) {\n    super(message);\n    this.name = 'JobDoesNotExistError';\n  }\n}\n\nexport class CleanupDoesNotExistError extends Error {\n  constructor(message:string) {\n    super(message);\n    this.name = 'CleanupDoesNotExistError';\n  }\n}\n\nexport type Job = {\n  id: number,\n  queueId:string,\n  type:string,\n  args:Array<any>,\n  attempt: number,\n  created: number,\n  status: number,\n  startAfter: number\n};\n\n\ntype Cleanup = {\n  id: number,\n  queueId:string,\n  data: Object,\n  attempt: number,\n  startAfter: number\n};\n\nexport const QUEUE_ERROR_STATUS = 0;\nexport const QUEUE_PENDING_STATUS = 1;\nexport const QUEUE_COMPLETE_STATUS = 2;\nexport const QUEUE_EMPTY_STATUS = 3;\n\nexport const JOB_ABORTED_STATUS = 2;\nexport const JOB_COMPLETE_STATUS = 1;\nexport const JOB_PENDING_STATUS = 0;\nexport const JOB_ERROR_STATUS = -1;\nexport const JOB_CLEANUP_STATUS = -2;\nexport const JOB_CLEANUP_AND_REMOVE_STATUS = -3;\n\nexport const databasePromise = (async () => {\n  const request = self.indexedDB.open('battery-queue-06', 1);\n\n  request.onupgradeneeded = function (e) {\n    try {\n      const store = e.target.result.createObjectStore('jobs', { keyPath: 'id', autoIncrement: true });\n      store.createIndex('statusIndex', 'status', { unique: false });\n      store.createIndex('queueIdIndex', 'queueId', { unique: false });\n      store.createIndex('queueIdTypeIndex', ['queueId', 'type'], { unique: false });\n      store.createIndex('statusQueueIdIndex', ['queueId', 'status'], { unique: false });\n      store.createIndex('createdIndex', 'created', { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      e.target.result.createObjectStore('metadata', { keyPath: 'id' });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      const store = e.target.result.createObjectStore('cleanups', { keyPath: 'id' });\n      store.createIndex('queueIdIndex', 'queueId', { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      e.target.result.createObjectStore('auth-data', { keyPath: 'id' });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n    try {\n      const store = e.target.result.createObjectStore('arg-lookup', { keyPath: 'id', autoIncrement: true });\n      store.createIndex('jobIdIndex', 'jobId', { unique: false });\n      store.createIndex('keyIndex', 'key', { unique: false });\n    } catch (error) {\n      if (!(error.name === 'ConstraintError')) {\n        throw error;\n      }\n    }\n  };\n\n  const db = await new Promise((resolve, reject) => {\n    request.onerror = () => {\n      reject(new Error('Unable to open database'));\n    };\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n  });\n\n  return db;\n})();\n\nasync function getReadWriteObjectStore(name:string) {\n  const database = await databasePromise;\n  const transaction = database.transaction([name], 'readwrite', { durability: 'relaxed' });\n  const objectStore = transaction.objectStore(name);\n  transaction.onabort = (event) => {\n    logger.error(`Read-write \"${name}\" transaction was aborted`);\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error(`Error in read-write \"${name}\" transaction`);\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nasync function getReadOnlyObjectStore(name:string) {\n  const database = await databasePromise;\n  const transaction = database.transaction([name], 'readonly', { durability: 'relaxed' });\n  const objectStore = transaction.objectStore(name);\n  transaction.onabort = (event) => {\n    logger.error(`Read-only \"${name}\" transaction was aborted`);\n    logger.errorObject(event);\n  };\n  transaction.onerror = (event) => {\n    logger.error(`Error in read-only \"${name}\" transaction`);\n    logger.errorObject(event);\n  };\n  return objectStore;\n}\n\nfunction getReadWriteArgLookupObjectStore() {\n  return getReadWriteObjectStore('arg-lookup');\n}\n\nfunction getReadOnlyArgLookupObjectStore() {\n  return getReadOnlyObjectStore('arg-lookup');\n}\n\nfunction getReadWriteAuthObjectStore() {\n  return getReadWriteObjectStore('auth-data');\n}\n\nfunction getReadOnlyAuthObjectStore() {\n  return getReadOnlyObjectStore('auth-data');\n}\n\nfunction getReadWriteMetadataObjectStore() {\n  return getReadWriteObjectStore('metadata');\n}\n\nfunction getReadOnlyMetadataObjectStore() {\n  return getReadOnlyObjectStore('metadata');\n}\n\nfunction getReadWriteJobsObjectStore() {\n  return getReadWriteObjectStore('jobs');\n}\n\nfunction getReadOnlyJobsObjectStore() {\n  return getReadOnlyObjectStore('jobs');\n}\n\nfunction getReadWriteCleanupsObjectStore() {\n  return getReadWriteObjectStore('cleanups');\n}\n\nfunction getReadOnlyCleanupsObjectStore() {\n  return getReadOnlyObjectStore('cleanups');\n}\n\nasync function getReadWriteObjectStoreAndTransactionPromise(name:string) {\n  const database = await databasePromise;\n  const transaction = database.transaction([name], 'readwrite', { durability: 'relaxed' });\n  const objectStore = transaction.objectStore(name);\n  const promise = new Promise((resolve, reject) => {\n    transaction.onabort = (event) => {\n      logger.error(`Read-write \"${name}\" transaction was aborted`);\n      logger.errorObject(event);\n      reject(new Error(`Read-write \"${name}\" transaction was aborted`));\n    };\n    transaction.onerror = (event) => {\n      logger.error(`Error in read-write \"${name}\" transaction`);\n      logger.errorObject(event);\n      reject(new Error(`Error in read-write \"${name}\" transaction`));\n    };\n    transaction.oncomplete = () => {\n      resolve();\n    };\n  });\n  return [objectStore, promise];\n}\n\nasync function getReadOnlyObjectStoreAndTransactionPromise(name:string) {\n  const database = await databasePromise;\n  const transaction = database.transaction([name], 'readonly', { durability: 'relaxed' });\n  const objectStore = transaction.objectStore(name);\n  const promise = new Promise((resolve, reject) => {\n    transaction.onabort = (event) => {\n      logger.error(`Read-write \"${name}\" transaction was aborted`);\n      logger.errorObject(event);\n      reject(new Error(`Read-write \"${name}\" transaction was aborted`));\n    };\n    transaction.onerror = (event) => {\n      logger.error(`Error in read-write \"${name}\" transaction`);\n      logger.errorObject(event);\n      reject(new Error(`Error in read-write \"${name}\" transaction`));\n    };\n    transaction.oncomplete = () => {\n      resolve();\n    };\n  });\n  return [objectStore, promise];\n}\n\n\nfunction getReadWriteJobsObjectStoreAndTransactionPromise() {\n  return getReadWriteObjectStoreAndTransactionPromise('jobs');\n}\n\nfunction getReadOnlyJobsObjectStoreAndTransactionPromise() {\n  return getReadOnlyObjectStoreAndTransactionPromise('jobs');\n}\n\nfunction getReadWriteArgLookupObjectStoreAndTransactionPromise() {\n  return getReadWriteObjectStoreAndTransactionPromise('arg-lookup');\n}\n\nfunction getReadWriteMetadataObjectStoreAndTransactionPromise() {\n  return getReadWriteObjectStoreAndTransactionPromise('metadata');\n}\n\nfunction removeJobFromObjectStore(store:IDBObjectStore, id:number, queueId:string) {\n  const deleteRequest = store.delete(id);\n  deleteRequest.onsuccess = function () {\n    localJobEmitter.emit('jobDelete', id, queueId);\n    jobEmitter.emit('jobDelete', id, queueId);\n    removeArgLookupsForJobAsMicrotask(id);\n  };\n  deleteRequest.onerror = function (event) {\n    logger.error(`Request error while removing job ${id} in queue ${queueId} from database`);\n    logger.errorObject(event);\n  };\n}\n\nasync function clearAllMetadataInDatabase() {\n  const store = await getReadWriteMetadataObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing queue data database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing queue data database'));\n    };\n  });\n}\n\nasync function clearJobsDatabase() {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing jobs database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing jobs database'));\n    };\n  });\n  localJobEmitter.emit('jobsClear');\n  jobEmitter.emit('jobsClear');\n}\n\nasync function clearCleanupsDatabase() {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.clear();\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error('Error while clearing cleanups database');\n      logger.errorObject(event);\n      reject(new Error('Error while clearing cleanups database'));\n    };\n  });\n}\n\nexport async function clearDatabase() {\n  await clearJobsDatabase();\n  await clearCleanupsDatabase();\n  await clearAllMetadataInDatabase();\n}\n\nexport async function getJobsWithQueueIdAndTypeFromDatabase(queueId:string, type:string) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdTypeIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only([queueId, type]));\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting jobs with queue ${queueId} and type ${type} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Error while getting jobs with queue ${queueId} and type ${type}`));\n    };\n  });\n}\n\nexport async function removeJobsWithQueueIdAndTypeFromDatabase(queueId:string, type:string) {\n  const [store, promise] = await getReadWriteJobsObjectStoreAndTransactionPromise();\n  const index = store.index('queueIdTypeIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only([queueId, type]));\n  request.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      removeJobFromObjectStore(store, id, queueId);\n    }\n  };\n  request.onerror = function (event) {\n    logger.error(`Request error while removing jobs with queue ${queueId} and type ${type} from jobs database`);\n    logger.errorObject(event);\n  };\n  await promise;\n}\n\nexport async function removeQueueIdFromJobsDatabase(queueId:string) {\n  const [store, promise] = await getReadWriteJobsObjectStoreAndTransactionPromise();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only(queueId));\n  request.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      removeJobFromObjectStore(store, id, queueId);\n    }\n  };\n  request.onerror = function (event) {\n    logger.error(`Request error while removing queue ${queueId} from jobs database`);\n    logger.errorObject(event);\n  };\n  await promise;\n}\n\nasync function removeQueueIdFromCleanupsDatabase(queueId:string) {\n  const store = await getReadWriteCleanupsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId));\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        store.delete(cursor.primaryKey);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while removing queue ${queueId} from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while removing queue ${queueId} from jobs database`));\n    };\n  });\n}\n\nexport async function removeQueueIdFromDatabase(queueId:string) {\n  await removeQueueIdFromJobsDatabase(queueId);\n  await removeQueueIdFromCleanupsDatabase(queueId);\n}\n\nexport async function removeCompletedExpiredItemsFromDatabase(maxAge:number) {\n  const [store, promise] = await getReadWriteJobsObjectStoreAndTransactionPromise();\n  const index = store.index('createdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.bound(0, Date.now() - maxAge));\n  request.onsuccess = function (event) {\n    for (const { id, queueId, status } of event.target.result) {\n      if (status !== JOB_COMPLETE_STATUS) {\n        continue;\n      }\n      removeJobFromObjectStore(store, id, queueId);\n    }\n  };\n  request.onerror = function (event) {\n    logger.error('Request error while removing completed exired items from jobs database');\n    logger.errorObject(event);\n  };\n  await promise;\n}\n\nexport async function updateJobInDatabase(id:number, transform:(Job | void) => Job | void | false):Promise<Job | void> {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      let newValue;\n      const value = request.result;\n      try {\n        newValue = transform(value);\n      } catch (error) {\n        reject(error);\n        return;\n      }\n      if (typeof newValue === 'undefined') {\n        resolve();\n      } else if (newValue === false) {\n        if (typeof value !== 'undefined') {\n          const { queueId, type } = value;\n          const deleteRequest = store.delete(id);\n          deleteRequest.onsuccess = function () {\n            localJobEmitter.emit('jobDelete', id, queueId);\n            jobEmitter.emit('jobDelete', id, queueId);\n            removeArgLookupsForJobAsMicrotask(id);\n            resolve();\n          };\n          deleteRequest.onerror = function (event) {\n            logger.error(`Delete request error while updating job ${id} in queue ${queueId} and type ${type} in jobs database`);\n            logger.errorObject(event);\n            reject(new Error(`Delete request error while updating job ${id} in queue ${queueId} and type ${type} from jobs database`));\n          };\n        }\n      } else {\n        const putRequest = store.put(newValue);\n        const { queueId, type, status } = newValue;\n        putRequest.onsuccess = function () {\n          localJobEmitter.emit('jobUpdate', id, queueId, type, status);\n          jobEmitter.emit('jobUpdate', id, queueId, type, status);\n          resolve();\n        };\n        putRequest.onerror = function (event) {\n          logger.error(`Put request error while updating job ${id} in queue ${queueId} and type ${type} in jobs database`);\n          logger.errorObject(event);\n          reject(new Error(`Put request error while updating job ${id} in queue ${queueId} and type ${type} from jobs database`));\n        };\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while updating ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while updating ${id}`));\n    };\n  });\n}\n\nexport async function getJobFromDatabase(id:number):Promise<Job | void> {\n  const store = await getReadOnlyJobsObjectStore();\n  const request = store.get(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id}`));\n    };\n  });\n}\n\nexport async function updateCleanupInDatabase(id:number, transform:(Cleanup | void) => Object):Promise<Cleanup | void> {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      let newValue;\n      try {\n        newValue = transform(request.result);\n      } catch (error) {\n        reject(error);\n        return;\n      }\n      if (typeof newValue === 'undefined') {\n        resolve();\n      } else {\n        const putRequest = store.put(newValue);\n        putRequest.onsuccess = function () {\n          resolve();\n        };\n        putRequest.onerror = function (event) {\n          logger.error(`Put request error while updating ${id} cleanup`);\n          logger.errorObject(event);\n          reject(new Error(`Put request error while updating ${id} cleanup`));\n        };\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while updating ${id} cleanup`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while updating ${id} cleanup`));\n    };\n  });\n}\n\nexport async function removePathFromCleanupDataInDatabase(id:number, path:Array<string>) {\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      return;\n    }\n    const { queueId, attempt, startAfter } = value;\n    const data = Object.assign({}, value.data);\n    unset(data, path);\n    return { // eslint-disable-line consistent-return\n      id,\n      queueId,\n      attempt,\n      startAfter,\n      data,\n    };\n  });\n}\n\n\nexport async function updateCleanupValuesInDatabase(id:number, queueId:string, data:Object) {\n  if (typeof id !== 'number') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (typeof data !== 'object') {\n    throw new TypeError(`Unable to update cleanup in database, received invalid \"data\" argument type \"${typeof data}\"`);\n  }\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    const combinedData = typeof value === 'undefined' ? data : merge({}, value.data, data);\n    return {\n      id,\n      queueId,\n      attempt: 0,\n      startAfter: Date.now(),\n      data: combinedData,\n    };\n  });\n}\n\nexport async function silentlyRemoveJobFromDatabase(id:number) {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.delete(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Delete request error while removing job ${id} from database`);\n      logger.errorObject(event);\n      reject(new Error(`Delete request error while removing job ${id} from database`));\n    };\n  });\n}\n\nexport async function removeJobFromDatabase(id:number) {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      const job = request.result;\n      if (typeof job === 'undefined') {\n        resolve();\n        return;\n      }\n      const { queueId, type } = job;\n      const deleteRequest = store.delete(id);\n      deleteRequest.onsuccess = function () {\n        localJobEmitter.emit('jobDelete', id, queueId);\n        jobEmitter.emit('jobDelete', id, queueId);\n        removeArgLookupsForJobAsMicrotask(id);\n        resolve();\n      };\n      deleteRequest.onerror = function (event) {\n        logger.error(`Delete request error while removing job ${id} in queue ${queueId} with type ${type} from database`);\n        logger.errorObject(event);\n        reject(new Error(`Delete request error while removing job ${id} in queue ${queueId} with type ${type} from database`));\n      };\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id} before removing from database`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id} before removing from database`));\n    };\n  });\n}\n\nexport async function removeCleanupFromDatabase(id:number) {\n  const store = await getReadWriteCleanupsObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing cleanup data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing cleanup data for ${id}`));\n    };\n  });\n}\n\nexport async function getCleanupFromDatabase(id:number):Promise<Cleanup | void> {\n  const store = await getReadOnlyCleanupsObjectStore();\n  const request = store.get(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id}`));\n    };\n  });\n}\n\nexport async function getMetadataFromDatabase(id:string) {\n  const store = await getReadOnlyMetadataObjectStore();\n  const request = store.get(id);\n  const response = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting ${id} metadata`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting ${id} metadata`));\n    };\n  });\n  return typeof response !== 'undefined' ? response.metadata : undefined;\n}\n\nexport async function clearMetadataInDatabase(id:string) {\n  const store = await getReadWriteMetadataObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while clearing ${id} metadata`);\n      logger.errorObject(event);\n      reject(new Error(`Error while clearing ${id} metadata`));\n    };\n  });\n}\n\nexport async function setMetadataInDatabase(id:string, metadata:Object) {\n  const store = await getReadWriteMetadataObjectStore();\n  const request = store.put({\n    id,\n    metadata,\n  });\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while setting ${id} metadata`);\n      logger.errorObject(event);\n      reject(new Error(`Error while setting ${id} metadata`));\n    };\n  });\n}\n\nexport async function updateMetadataInDatabase(id:string, metadata:Object) {\n  const [store, promise] = await getReadWriteMetadataObjectStoreAndTransactionPromise();\n  const request = store.get(id);\n  request.onsuccess = function () {\n    const response = request.result;\n    if (typeof response === 'undefined') {\n      const putRequest = store.put({\n        id,\n        metadata,\n      });\n      putRequest.onerror = function (event) {\n        logger.error(`Error in put request while updating ${id} metadata`);\n        logger.errorObject(event);\n      };\n    } else {\n      const putRequest = store.put({\n        id,\n        metadata: merge({}, response.metadata, metadata),\n      });\n      putRequest.onerror = function (event) {\n        logger.error(`Error in put request while updating ${id} metadata`);\n        logger.errorObject(event);\n      };\n    }\n  };\n  request.onerror = function (event) {\n    logger.error(`Error while updating ${id} metadata`);\n    logger.errorObject(event);\n  };\n  await promise;\n}\n\nexport function markJobStatusInDatabase(id:number, status:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to mark job ${id} as status ${status} in database, job does not exist`);\n    }\n    value.status = status; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport function markJobCompleteInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_COMPLETE_STATUS);\n}\n\nexport function markJobPendingInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_PENDING_STATUS);\n}\n\nexport function markJobErrorInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_ERROR_STATUS);\n}\n\nexport function markJobCleanupInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_CLEANUP_STATUS);\n}\n\nexport function markJobAbortedInDatabase(id:number) {\n  return markJobStatusInDatabase(id, JOB_ABORTED_STATUS);\n}\n\nexport async function markJobCompleteThenRemoveFromDatabase(id:number):Promise<void> {\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.get(id);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      const value = request.result;\n      if (typeof value !== 'undefined') {\n        const { queueId, type } = value;\n        localJobEmitter.emit('jobUpdate', id, queueId, type, JOB_COMPLETE_STATUS);\n        jobEmitter.emit('jobUpdate', id, queueId, type, JOB_COMPLETE_STATUS);\n        const deleteRequest = store.delete(id);\n        deleteRequest.onsuccess = function () {\n          localJobEmitter.emit('jobDelete', id, queueId);\n          jobEmitter.emit('jobDelete', id, queueId);\n          removeArgLookupsForJobAsMicrotask(id);\n          resolve();\n        };\n        deleteRequest.onerror = function (event) {\n          logger.error(`Delete request error while marking job ${id} in queue ${queueId} with type ${type} complete then removing from jobs database`);\n          logger.errorObject(event);\n          reject(new Error(`Delete request error while marking job ${id} in queue ${queueId} with type ${type} complete then removing from jobs database`));\n        };\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Get request error while marking job ${id} complete then removing from jobs database`);\n      logger.errorObject(event);\n      reject(new Error(`Get request error while marking job ${id} complete then removing from jobs database`));\n    };\n  });\n}\n\nexport function markJobCleanupAndRemoveInDatabase(id:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to mark job ${id} as status ${JOB_CLEANUP_AND_REMOVE_STATUS} in database, job does not exist`);\n    }\n    if (value.status === JOB_PENDING_STATUS) {\n      return false;\n    }\n    if (value.status === JOB_ABORTED_STATUS) {\n      return false;\n    }\n    value.status = JOB_CLEANUP_AND_REMOVE_STATUS; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport function markJobAsAbortedOrRemoveFromDatabase(id:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      return;\n    }\n    if (value.status === JOB_ERROR_STATUS) {\n      value.status = JOB_ABORTED_STATUS; // eslint-disable-line no-param-reassign\n      return value; // eslint-disable-line consistent-return\n    }\n    if (value.status === JOB_CLEANUP_STATUS) {\n      value.status = JOB_ABORTED_STATUS; // eslint-disable-line no-param-reassign\n      return value; // eslint-disable-line consistent-return\n    }\n    if (value.status === JOB_CLEANUP_AND_REMOVE_STATUS) {\n      return false; // eslint-disable-line consistent-return\n    }\n    throw new Error(`Unable to mark job ${id} as aborted or remove after cleanup, unable to handle status ${value.status}`);\n  });\n}\n\nexport function markJobStartAfterInDatabase(id:number, startAfter:number) {\n  return updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to mark job ${id} start-after time to ${new Date(startAfter).toLocaleString()} in database, job does not exist`);\n    }\n    if (startAfter < value.startAfter) {\n      return;\n    }\n    value.startAfter = startAfter; // eslint-disable-line no-param-reassign\n    return value; // eslint-disable-line consistent-return\n  });\n}\n\nexport function markCleanupStartAfterInDatabase(id:number, startAfter:number) {\n  return updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      throw new CleanupDoesNotExistError(`Unable to mark cleanup ${id} start-after time to ${new Date(startAfter).toLocaleString()} in database, cleanup does not exist`);\n    }\n    if (startAfter < value.startAfter) {\n      return;\n    }\n    value.startAfter = startAfter; // eslint-disable-line  no-param-reassign\n    return value; // eslint-disable-line consistent-return\n  });\n}\n\nexport async function markQueueForCleanupInDatabase(queueId:string) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        const value = Object.assign({}, cursor.value);\n        switch (value.status) {\n          case JOB_ERROR_STATUS:\n            value.status = JOB_CLEANUP_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_COMPLETE_STATUS:\n            value.status = JOB_CLEANUP_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_PENDING_STATUS:\n            value.status = JOB_ABORTED_STATUS;\n            break;\n          case JOB_CLEANUP_STATUS:\n            jobs.push(value);\n            cursor.continue();\n            return;\n          case JOB_CLEANUP_AND_REMOVE_STATUS:\n            jobs.push(value);\n            cursor.continue();\n            return;\n          case JOB_ABORTED_STATUS:\n            cursor.continue();\n            return;\n          default:\n            logger.warn(`Unhandled job status ${value.status} while marking queue ${queueId} for cleanup`);\n            cursor.continue();\n            return;\n        }\n        const updateRequest = cursor.update(value);\n        updateRequest.onsuccess = function () {\n          localJobEmitter.emit('jobUpdate', value.id, value.queueId, value.type, value.status);\n          jobEmitter.emit('jobUpdate', value.id, value.queueId, value.type, value.status);\n          cursor.continue();\n        };\n        updateRequest.onerror = function (event2) {\n          logger.error(`Update request error while marking queue ${queueId} for cleanup`);\n          logger.errorObject(event2);\n          cursor.continue();\n        };\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking queue ${queueId} for cleanup`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking queue ${queueId} for cleanup`));\n    };\n  });\n  return jobs;\n}\n\nexport async function markQueueJobsGreaterThanIdCleanupAndRemoveInDatabase(queueId:string, jobId:number) {\n  const store = await getReadWriteJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        const value = Object.assign({}, cursor.value);\n        if (value.id <= jobId) {\n          cursor.continue();\n          return;\n        }\n        let shouldRemove = false;\n        switch (value.status) {\n          case JOB_ERROR_STATUS:\n            value.status = JOB_CLEANUP_AND_REMOVE_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_COMPLETE_STATUS:\n            value.status = JOB_CLEANUP_AND_REMOVE_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_PENDING_STATUS:\n            shouldRemove = true;\n            break;\n          case JOB_CLEANUP_STATUS:\n            value.status = JOB_CLEANUP_AND_REMOVE_STATUS;\n            jobs.push(value);\n            break;\n          case JOB_CLEANUP_AND_REMOVE_STATUS:\n            jobs.push(value);\n            cursor.continue();\n            return;\n          case JOB_ABORTED_STATUS:\n            shouldRemove = true;\n            break;\n          default:\n            logger.warn(`Unhandled job status ${value.status} while marking queue ${queueId} for cleanup and removal`);\n            cursor.continue();\n            return;\n        }\n        const { id, type, status } = value;\n        if (shouldRemove) {\n          const deleteRequest = cursor.delete(id);\n          deleteRequest.onsuccess = function () {\n            localJobEmitter.emit('jobDelete', id, queueId);\n            jobEmitter.emit('jobDelete', id, queueId);\n            cursor.continue();\n          };\n          deleteRequest.onerror = function (event2) {\n            logger.error(`Update request error while marking queue ${queueId} for cleanup and removal`);\n            logger.errorObject(event2);\n            cursor.continue();\n          };\n        } else {\n          const updateRequest = cursor.update(value);\n          updateRequest.onsuccess = function () {\n            localJobEmitter.emit('jobUpdate', id, queueId, type, status);\n            jobEmitter.emit('jobUpdate', id, queueId, type, status);\n            cursor.continue();\n          };\n          updateRequest.onerror = function (event2) {\n            logger.error(`Update request error while marking queue ${queueId} for cleanup and removal`);\n            logger.errorObject(event2);\n            cursor.continue();\n          };\n        }\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while marking queue ${queueId} for cleanup and removal`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while marking queue ${queueId} for cleanup and removal`));\n    };\n  });\n  return jobs;\n}\n\n\nexport function markQueueForCleanupAndRemoveInDatabase(queueId:string) {\n  return markQueueJobsGreaterThanIdCleanupAndRemoveInDatabase(queueId, -1);\n}\n\nexport async function getGreatestJobIdFromQueueInDatabase(queueId:string) {\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only(queueId), 'prev');\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        resolve(cursor.value.id || 0);\n      } else {\n        resolve(0);\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting the greatest job ID in queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting the greatest job ID in queue ${queueId}`));\n    };\n  });\n}\n\nexport async function incrementJobAttemptInDatabase(id:number) {\n  await updateJobInDatabase(id, (value:Job | void) => {\n    if (typeof value === 'undefined') {\n      throw new JobDoesNotExistError(`Unable to increment attempts for job ${id} in database, job does not exist`);\n    }\n    value.attempt += 1; // eslint-disable-line no-param-reassign\n    return value;\n  });\n}\n\nexport async function incrementCleanupAttemptInDatabase(id:number, queueId:string) {\n  let attempt = 1;\n  await updateCleanupInDatabase(id, (value: Cleanup | void) => {\n    if (typeof value === 'undefined') {\n      return {\n        id,\n        queueId,\n        attempt: 1,\n        startAfter: Date.now(),\n        data: {},\n      };\n    }\n    attempt = value.attempt + 1;\n    value.attempt = attempt; // eslint-disable-line no-param-reassign\n    return value;\n  });\n  return attempt;\n}\n\nexport async function bulkEnqueueToDatabase(queueId: string, items:Array<[string, Array<any>]>, delay: number) { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to bulk enqueue in database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (!Array.isArray(items)) {\n    throw new TypeError(`Unable to bulk enqueue in database, received invalid \"items\" argument type \"${typeof items}\"`);\n  }\n  for (let i = 0; i < items.length; i += 1) {\n    const [type, args] = items[i];\n    if (typeof type !== 'string') {\n      throw new TypeError(`Unable to bulk enqueue in database, received invalid items[${i}] \"type\" argument type \"${typeof type}\"`);\n    }\n    if (!Array.isArray(args)) {\n      throw new TypeError(`Unable to bulk enqueue in database, received invalid items[${i}] \"args\" argument type \"${typeof args}\"`);\n    }\n  }\n  if (typeof delay !== 'number') {\n    throw new TypeError(`Unable to bulk enqueue in database, received invalid \"delay\" argument type \"${typeof delay}\"`);\n  }\n  const ids = [];\n  const store = await getReadWriteJobsObjectStore();\n  await new Promise((resolve, reject) => {\n    for (let i = 0; i < items.length; i += 1) {\n      const [type, args] = items[i];\n      const value = {\n        queueId,\n        type,\n        args,\n        attempt: 0,\n        created: Date.now(),\n        status: JOB_PENDING_STATUS,\n        startAfter: Date.now() + delay,\n      };\n      const request = store.put(value);\n      request.onsuccess = function () {\n        const id = request.result;\n        ids.push(request.result);\n        localJobEmitter.emit('jobAdd', id, queueId, type);\n        jobEmitter.emit('jobAdd', id, queueId, type);\n        resolve(request.result);\n      };\n      request.onerror = function (event) {\n        logger.error(`Request error while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`);\n        logger.errorObject(event);\n        reject(new Error(`Request error while bulk enqueueing ${items.length} ${items.length === 1 ? 'job' : 'jobs'} in queue ${queueId}`));\n      };\n    }\n  });\n  return ids;\n}\n\nexport async function enqueueToDatabase(queueId: string, type: string, args: Array<any>, delay: number) { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (typeof type !== 'string') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"type\" argument type \"${typeof type}\"`);\n  }\n  if (!Array.isArray(args)) {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"args\" argument type \"${typeof args}\"`);\n  }\n  if (typeof delay !== 'number') {\n    throw new TypeError(`Unable to enqueue in database, received invalid \"delay\" argument type \"${typeof delay}\"`);\n  }\n  const value = {\n    queueId,\n    type,\n    args,\n    attempt: 0,\n    created: Date.now(),\n    status: JOB_PENDING_STATUS,\n    startAfter: Date.now() + delay,\n  };\n  const store = await getReadWriteJobsObjectStore();\n\n  const request = store.put(value);\n  const id = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while enqueueing ${type} job`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while enqueueing ${type} job`));\n    };\n  });\n  localJobEmitter.emit('jobAdd', id, queueId, type);\n  jobEmitter.emit('jobAdd', id, queueId, type);\n  return id;\n}\n\nexport async function restoreJobToDatabaseForCleanupAndRemove(id:number, queueId: string, type: string, args: Array<any>) { // eslint-disable-line no-underscore-dangle\n  if (typeof id !== 'number') {\n    throw new TypeError(`Unable to restore to database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to restore to database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  if (typeof type !== 'string') {\n    throw new TypeError(`Unable to restore to database, received invalid \"type\" argument type \"${typeof type}\"`);\n  }\n  if (!Array.isArray(args)) {\n    throw new TypeError(`Unable to restore to database, received invalid \"args\" argument type \"${typeof args}\"`);\n  }\n  const value = {\n    id,\n    queueId,\n    type,\n    args,\n    attempt: 1,\n    created: Date.now(),\n    status: JOB_CLEANUP_AND_REMOVE_STATUS,\n    startAfter: Date.now(),\n  };\n  const store = await getReadWriteJobsObjectStore();\n  const request = store.put(value);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while enqueueing ${type} job`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while enqueueing ${type} job`));\n    };\n  });\n  localJobEmitter.emit('jobAdd', id, queueId, type);\n  jobEmitter.emit('jobAdd', id, queueId, type);\n  return id;\n}\n\nexport async function dequeueFromDatabase():Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.bound(JOB_CLEANUP_AND_REMOVE_STATUS, JOB_PENDING_STATUS));\n  const jobs = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error('Request error while dequeing');\n      logger.errorObject(event);\n      reject(new Error('Request error while dequeing'));\n    };\n  });\n  return jobs;\n}\n\nexport function getContiguousIds(ids:Array<number>) {\n  ids.sort((a, b) => a - b);\n  const points = [[0, ids[0] - 1]];\n  for (let i = 0; i < ids.length; i += 1) {\n    if (ids[i] + 1 !== ids[i + 1]) {\n      if (i + 1 >= ids.length) {\n        points.push([ids[i] + 1, Infinity]);\n      } else {\n        points.push([ids[i] + 1, ids[i + 1] - 1]);\n      }\n    }\n  }\n  return points;\n}\n\nexport async function dequeueFromDatabaseNotIn(ids:Array<number>):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (ids.length === 0) {\n    return dequeueFromDatabase();\n  }\n  const [store, promise] = await getReadOnlyJobsObjectStoreAndTransactionPromise();\n  const index = store.index('statusIndex');\n  const jobs = [];\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.bound(JOB_CLEANUP_AND_REMOVE_STATUS, JOB_PENDING_STATUS));\n  request.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      if (ids.includes(id)) {\n        continue;\n      }\n      const getRequest = store.get(id);\n      getRequest.onsuccess = function () {\n        jobs.push(getRequest.result);\n      };\n      getRequest.onerror = function (event2) {\n        logger.error(`Request error while getting job ${id}`);\n        logger.errorObject(event2);\n      };\n    }\n  };\n  request.onerror = function (event) {\n    logger.error('Request error while dequeing');\n    logger.errorObject(event);\n  };\n  await promise;\n  return jobs;\n}\n\nexport async function getJobsInQueueFromDatabase(queueId: string):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to get jobs in queue from database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('queueIdIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(queueId));\n  const jobs = await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      resolve(event.target.result);\n    };\n    request.onerror = function (event) {\n      logger.error('Request error while dequeing');\n      logger.errorObject(event);\n      reject(new Error('Request error while dequeing'));\n    };\n  });\n  return jobs;\n}\n\nexport async function getJobsInDatabase(jobIds: Array<number>):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (!Array.isArray(jobIds)) {\n    throw new TypeError(`Unable to get jobs from database, received invalid \"jobIds\" argument type \"${typeof jobIds}\"`);\n  }\n  const [store, promise] = await getReadOnlyJobsObjectStoreAndTransactionPromise();\n  const jobs = [];\n  for (const jobId of jobIds) {\n    const request = store.get(jobId);\n    request.onsuccess = function () {\n      if (typeof request.result !== 'undefined') {\n        jobs.push(request.result);\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting job ${jobId}`);\n      logger.errorObject(event);\n    };\n  }\n  await promise;\n  return jobs;\n}\n\nexport async function getCompletedJobsCountFromDatabase(queueId: string) { // eslint-disable-line no-underscore-dangle\n  const jobs = await getCompletedJobsFromDatabase(queueId);\n  return jobs.length;\n}\n\nexport async function getCompletedJobsFromDatabase(queueId: string):Promise<Array<Job>> { // eslint-disable-line no-underscore-dangle\n  if (typeof queueId !== 'string') {\n    throw new TypeError(`Unable to get completed jobs database, received invalid \"queueId\" argument type \"${typeof queueId}\"`);\n  }\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  // $FlowFixMe\n  const request = index.openCursor(IDBKeyRange.only([queueId, JOB_COMPLETE_STATUS]));\n  const jobs = [];\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const cursor = event.target.result;\n      if (cursor) {\n        jobs.push(cursor.value);\n        cursor.continue();\n      } else {\n        resolve();\n      }\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting completed jobs for queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting completed jobs for queue ${queueId}`));\n    };\n  });\n  return jobs;\n}\n\nexport async function storeAuthDataInDatabase(id:string, data: Object) { // eslint-disable-line no-underscore-dangle\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  if (typeof data !== 'object') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"data\" argument type \"${typeof data}\"`);\n  }\n  const store = await getReadWriteAuthObjectStore();\n  const request = store.put({ id, data });\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while storing auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while storing auth data for ${id}`));\n    };\n  });\n}\n\nexport async function getAuthDataFromDatabase(id:string) {\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  const store = await getReadOnlyAuthObjectStore();\n  const request = store.get(id);\n  const authData = await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error while getting auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting auth data for ${id}`));\n    };\n  });\n  return typeof authData !== 'undefined' ? authData.data : undefined;\n}\n\nexport async function removeAuthDataFromDatabase(id:string) {\n  if (typeof id !== 'string') {\n    throw new TypeError(`Unable to store auth data in database, received invalid \"id\" argument type \"${typeof id}\"`);\n  }\n  const store = await getReadWriteAuthObjectStore();\n  const request = store.delete(id);\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while removing auth data for ${id}`);\n      logger.errorObject(event);\n      reject(new Error(`Error while removing auth data for ${id}`));\n    };\n  });\n}\n\nexport async function getQueueStatus(queueId:string) {\n  const store = await getReadOnlyJobsObjectStore();\n  const index = store.index('statusQueueIdIndex');\n  // $FlowFixMe\n  const abortedRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_ABORTED_STATUS]));\n  // $FlowFixMe\n  const completeRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_COMPLETE_STATUS]));\n  // $FlowFixMe\n  const pendingRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_PENDING_STATUS]));\n  // $FlowFixMe\n  const errorRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_ERROR_STATUS]));\n  // $FlowFixMe\n  const cleanupRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_CLEANUP_STATUS]));\n  // $FlowFixMe\n  const cleanupAndRemoveRequest = index.getAllKeys(IDBKeyRange.only([queueId, JOB_CLEANUP_AND_REMOVE_STATUS]));\n  const abortedCountPromise = new Promise((resolve, reject) => {\n    abortedRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    abortedRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const completeCountPromise = new Promise((resolve, reject) => {\n    completeRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    completeRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const pendingCountPromise = new Promise((resolve, reject) => {\n    pendingRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    pendingRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const errorCountPromise = new Promise((resolve, reject) => {\n    errorRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    errorRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const cleanupCountPromise = new Promise((resolve, reject) => {\n    cleanupRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    cleanupRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const cleanupAndRemoveCountPromise = new Promise((resolve, reject) => {\n    cleanupAndRemoveRequest.onsuccess = function (event) {\n      resolve(event.target.result.length);\n    };\n    cleanupAndRemoveRequest.onerror = function (event) {\n      logger.error(`Request error while getting status of queue ${queueId}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error while getting status of queue ${queueId}`));\n    };\n  });\n  const [\n    abortedCount,\n    completeCount,\n    pendingCount,\n    errorCount,\n    cleanupCount,\n    cleanupAndRemoveCount,\n  ] = await Promise.all([\n    abortedCountPromise,\n    completeCountPromise,\n    pendingCountPromise,\n    errorCountPromise,\n    cleanupCountPromise,\n    cleanupAndRemoveCountPromise,\n  ]);\n  if (abortedCount > 0 || cleanupCount > 0) {\n    return QUEUE_ERROR_STATUS;\n  }\n  if (errorCount > 0 || pendingCount > 0 || cleanupAndRemoveCount > 0) {\n    return QUEUE_PENDING_STATUS;\n  }\n  if (completeCount > 0) {\n    return QUEUE_COMPLETE_STATUS;\n  }\n  return QUEUE_EMPTY_STATUS;\n}\n\nexport async function addArgLookup(jobId:number, key:string, jsonPath:string) {\n  if (typeof jobId !== 'number') {\n    throw new TypeError(`Unable add argument lookup, received invalid \"jobId\" argument type \"${typeof jobId}\"`);\n  }\n  if (typeof key !== 'string') {\n    throw new TypeError(`Unable add argument lookup, received invalid \"key\" argument type \"${typeof key}\"`);\n  }\n  if (typeof jsonPath !== 'string') {\n    throw new TypeError(`Unable add argument lookup, received invalid \"jsonPath\" argument type \"${typeof jsonPath}\"`);\n  }\n  const store = await getReadWriteArgLookupObjectStore();\n  const request = store.put({\n    jobId,\n    key,\n    jsonPath,\n  });\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      resolve();\n    };\n    request.onerror = function (event) {\n      logger.error(`Error while adding argument lookup for job ${jobId} with key \"${key}\" and JSON path \"${jsonPath}\"`);\n      logger.errorObject(event);\n      reject(new Error(`Error while adding argument lookup for job ${jobId} with key \"${key}\" and JSON path \"${jsonPath}\"`));\n    };\n  });\n}\n\nexport async function getArgLookupJobPathMap(key:string) {\n  if (typeof key !== 'string') {\n    throw new TypeError(`Unable to lookup arguments, received invalid \"key\" argument type \"${typeof key}\"`);\n  }\n  const store = await getReadOnlyArgLookupObjectStore();\n  const index = store.index('keyIndex');\n  // $FlowFixMe\n  const request = index.getAll(IDBKeyRange.only(key));\n  return new Promise((resolve, reject) => {\n    request.onsuccess = function (event) {\n      const map: Map<number, string> = new Map(event.target.result.map((x) => [x.jobId, x.jsonPath]));\n      resolve(map);\n    };\n    request.onerror = function (event) {\n      logger.error(`Request error looking up arguments for key ${key}`);\n      logger.errorObject(event);\n      reject(new Error(`Request error looking up arguments for key ${key}`));\n    };\n  });\n}\n\n\nexport async function markJobsWithArgLookupKeyCleanupAndRemoveInDatabase(key:string) {\n  const map = await getArgLookupJobPathMap(key);\n  for (const jobId of map.keys()) {\n    await markJobCleanupAndRemoveInDatabase(jobId);\n  }\n}\n\nexport async function lookupArgs(key:string) {\n  const map = await getArgLookupJobPathMap(key);\n  if (map.size === 0) {\n    return [];\n  }\n  const jobs = await getJobsInDatabase([...map.keys()]);\n  const results = [];\n  for (const { id, args } of jobs) {\n    const jsonPath = map.get(id);\n    if (typeof jsonPath !== 'string') {\n      continue;\n    }\n    for (const result of JSONPath({ path: jsonPath, json: args })) {\n      results.push(result);\n    }\n  }\n  return results;\n}\n\nexport async function lookupArg(key:string) {\n  const results = await lookupArgs(key);\n  return results[0];\n}\n\nfunction removeArgLookupsForJobAsMicrotask(jobId:number) {\n  self.queueMicrotask(() => removeArgLookupsForJob(jobId).catch((error) => {\n    logger.error(`Unable to remove argument lookups for job ${jobId} in microtask`);\n    logger.errorStack(error);\n  }));\n}\n\nexport async function removeArgLookupsForJob(jobId:number) {\n  const [store, promise] = await getReadWriteArgLookupObjectStoreAndTransactionPromise();\n  const index = store.index('jobIdIndex');\n  // $FlowFixMe\n  const request = index.getAllKeys(IDBKeyRange.only(jobId));\n  request.onsuccess = function (event) {\n    for (const id of event.target.result) {\n      const deleteRequest = store.delete(id);\n      deleteRequest.onerror = function (deleteEvent) {\n        logger.error(`Delete request error while removing argument lookups for job ${jobId}`);\n        logger.errorObject(deleteEvent);\n      };\n    }\n  };\n  request.onerror = function (event) {\n    logger.error(`Request error while removing argument lookups for job ${jobId}`);\n    logger.errorObject(event);\n  };\n  await promise;\n}\n\nconst UNLOAD_DATA_ID = '_UNLOAD_DATA';\n\nexport async function updateUnloadDataInDatabase(transform:(Object | void) => Object | void | false):Promise<Object | void> {\n  const store = await getReadWriteMetadataObjectStore();\n  const request = store.get(UNLOAD_DATA_ID);\n  await new Promise((resolve, reject) => {\n    request.onsuccess = function () {\n      let newValue;\n      const response = request.result;\n      const value = typeof response !== 'undefined' ? response.metadata : undefined;\n      try {\n        newValue = transform(value);\n      } catch (error) {\n        reject(error);\n        return;\n      }\n      if (typeof newValue === 'undefined') {\n        resolve();\n      } else if (newValue === false) {\n        if (typeof value !== 'undefined') {\n          const deleteRequest = store.delete(UNLOAD_DATA_ID);\n          deleteRequest.onsuccess = function () {\n            resolve();\n          };\n          deleteRequest.onerror = function (event) {\n            logger.error('Delete request error while updating unload data in metadata database');\n            logger.errorObject(event);\n            reject(new Error('Delete request error while updating unload data in metadata database'));\n          };\n        }\n      } else {\n        const putRequest = store.put({\n          id: UNLOAD_DATA_ID,\n          metadata: newValue,\n        });\n        putRequest.onsuccess = function () {\n          resolve();\n        };\n        putRequest.onerror = function (event) {\n          logger.error('Put request error while updating unload data in metadata database');\n          logger.errorObject(event);\n          reject(new Error('Put request error while updating unload data in metadata database'));\n        };\n      }\n    };\n    request.onerror = function (event) {\n      logger.error('Get request error while updating unload data in metadata database');\n      logger.errorObject(event);\n      reject(new Error('Get request error while updating unload data in metadata database'));\n    };\n  });\n}\n\nexport function getUnloadDataFromDatabase() {\n  return getMetadataFromDatabase(UNLOAD_DATA_ID);\n}\n\nexport function clearUnloadDataInDatabase() {\n  return clearMetadataInDatabase(UNLOAD_DATA_ID);\n}\n\n"],"file":"database.js"}